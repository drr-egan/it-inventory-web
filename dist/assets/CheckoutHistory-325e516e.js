var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var R=(o,c,r)=>c in o?Y(o,c,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[c]=r,d=(o,c)=>{for(var r in c||(c={}))te.call(c,r)&&R(o,r,c[r]);if(L)for(var r of L(c))se.call(c,r)&&R(o,r,c[r]);return o},h=(o,c)=>Z(o,ee(c));var E=(o,c,r)=>new Promise((C,g)=>{var i=u=>{try{b(r.next(u))}catch(f){g(f)}},w=u=>{try{b(r.throw(u))}catch(f){g(f)}},b=u=>u.done?C(u.value):Promise.resolve(u.value).then(i,w);b((r=r.apply(o,c)).next())});import{j as e,L as ae,d as v}from"./index-54119978.js";import{r as m}from"./react-vendor-3371026b.js";import{q as $,l as U,c as B,d as T,e as F,h as k,u as re,f as P,w as V}from"./firebase-vendor-fdbb15af.js";import{M as N}from"./MaterialButton-c8aebcba.js";import{M as j}from"./MaterialInput-d08ee327.js";const me=({user:o})=>{const[c,r]=m.useState([]),[C,g]=m.useState([]),[i,w]=m.useState("current"),[b,u]=m.useState(!0),[f,z]=m.useState(null),[y,D]=m.useState(""),[n,p]=m.useState(null),[O,I]=m.useState(!1),[Q,J]=m.useState("checkoutHistory");m.useEffect(()=>{const t=$(T(v,"checkoutHistory"),B("dateEntered","desc"),U(500)),s=F(t,a=>{const x=a.docs.map(l=>h(d({},l.data()),{id:l.id}));r(x),u(!1)},a=>{console.error("Error fetching checkout history:",a),z("Failed to load checkout history"),u(!1)});return()=>s()},[]),m.useEffect(()=>{const t=$(T(v,"archivedCheckouts"),B("archivedAt","desc"),U(500)),s=F(t,a=>{const x=a.docs.map(l=>h(d({},l.data()),{id:l.id}));g(x)},a=>{console.error("Error fetching archived checkouts:",a)});return()=>s()},[]);const A=i==="current"?c:C,q=A.filter(t=>{var a;if(!y)return!0;const s=y.toLowerCase();return(t.itemName||t.item||"").toLowerCase().includes(s)||(t.userName||t.user||"").toLowerCase().includes(s)||(t.departmentId||t.costCode||"").toLowerCase().includes(s)||(((a=t.quantity)==null?void 0:a.toString())||"").includes(s)}),M=t=>t?t.toDate?t.toDate().toLocaleDateString():typeof t=="string"?new Date(t).toLocaleDateString():"Unknown":"Unknown",_=t=>{if(!t)return"";const s=t.split("-");if(s.length>=3){const[a,x,l]=s,X=l.padStart(3,"0");return`${a}-${x}-${X}-5770`}return t},H=(t,s="checkoutHistory")=>{p({id:t.id,itemName:t.itemName,userName:t.userName,quantity:t.quantity,departmentId:t.departmentId||t.costCode||"",jobNumber:t.jobNumber||"",notes:t.notes||""}),J(s),I(!0)},S=()=>{p(null),I(!1)},G=()=>E(void 0,null,function*(){if(!(!n||!n.id))try{const s=k(v,Q==="archivedCheckouts"?"archivedCheckouts":"checkoutHistory",n.id);yield re(s,{itemName:n.itemName,userName:n.userName,quantity:parseInt(n.quantity),departmentId:_(n.departmentId),jobNumber:n.jobNumber,notes:n.notes,lastUpdated:P()}),S(),alert("Checkout record updated successfully")}catch(t){console.error("Error updating checkout record:",t),alert("Failed to update checkout record")}}),K=t=>E(void 0,null,function*(){try{const s=h(d({},t),{archivedAt:P(),manuallyArchived:!0,archivedBy:(o==null?void 0:o.email)||"unknown"});delete s.id;const a=V(v);a.set(k(v,"archivedCheckouts",t.id),s),a.delete(k(v,"checkoutHistory",t.id)),yield a.commit(),r(x=>x.filter(l=>l.id!==t.id)),console.log(`Manually archived checkout record for ${t.itemName}`)}catch(s){console.error("Error manually archiving record:",s),alert("Failed to archive record. Please try again.")}}),W=t=>E(void 0,null,function*(){try{const s=d({},t);delete s.archivedAt,delete s.manuallyArchived,delete s.shipmentDetails,delete s.id;const a=V(v);a.set(k(v,"checkoutHistory",t.id),s),a.delete(k(v,"archivedCheckouts",t.id)),yield a.commit(),g(x=>x.filter(l=>l.id!==t.id)),console.log(`Unarchived checkout record for ${t.itemName}`)}catch(s){console.error("Error unarchiving record:",s),alert("Failed to unarchive record. Please try again.")}});return b?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(ae,{size:"large"}),e.jsx("span",{className:"ml-4 text-[var(--md-sys-color-on-surface)]",children:"Loading history..."})]}):f?e.jsx("div",{className:"bg-[var(--md-sys-color-error-container)] border border-[var(--md-sys-color-error)] rounded-md p-4",children:e.jsx("p",{className:"text-[var(--md-sys-color-on-error-container)]",children:f})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-[var(--md-sys-color-surface-container)] rounded-lg p-6 md-elevation-1",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-[var(--md-sys-color-on-surface)] flex items-center",children:[e.jsx("span",{className:"material-icons mr-2",children:"history"}),"Checkout History"]}),e.jsx("p",{className:"text-sm text-[var(--md-sys-color-on-surface-variant)] mt-1",children:i==="current"?"View active checkout records awaiting processing":"View processed and archived checkout records"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>w("current"),className:`px-4 py-2 rounded-full flex items-center gap-2 transition-all ${i==="current"?"bg-[var(--md-sys-color-primary)] text-[var(--md-sys-color-on-primary)] md-elevation-2":"bg-[var(--md-sys-color-surface-container-high)] text-[var(--md-sys-color-on-surface-variant)]"}`,children:[e.jsx("span",{className:"material-icons text-sm",children:"pending_actions"}),"Current",e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs font-bold",children:c.length})]}),e.jsxs("button",{onClick:()=>w("archive"),className:`px-4 py-2 rounded-full flex items-center gap-2 transition-all ${i==="archive"?"bg-[var(--md-sys-color-primary)] text-[var(--md-sys-color-on-primary)] md-elevation-2":"bg-[var(--md-sys-color-surface-container-high)] text-[var(--md-sys-color-on-surface-variant)]"}`,children:[e.jsx("span",{className:"material-icons text-sm",children:"inventory"}),"Archive",e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs font-bold",children:C.length})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"material-icons absolute left-3 top-1/2 -translate-y-1/2 text-[var(--md-sys-color-on-surface-variant)]",children:"search"}),e.jsx("input",{type:"text",placeholder:"Search by item, user, department, or quantity...",value:y,onChange:t=>D(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-[var(--md-sys-color-surface-container-high)] text-[var(--md-sys-color-on-surface)] rounded-lg border border-[var(--md-sys-color-outline-variant)] focus:outline-none focus:ring-2 focus:ring-[var(--md-sys-color-primary)]"}),y&&e.jsx("button",{onClick:()=>D(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--md-sys-color-on-surface-variant)] hover:text-[var(--md-sys-color-on-surface)]",children:e.jsx("span",{className:"material-icons text-sm",children:"close"})})]}),y&&e.jsxs("p",{className:"text-sm text-[var(--md-sys-color-on-surface-variant)]",children:["Found ",q.length," of ",A.length," records"]})]})}),e.jsx("div",{className:"bg-[var(--md-sys-color-surface-container)] rounded-lg md-elevation-1 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-[var(--md-sys-color-surface-container-high)]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Item"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Date"}),i==="archive"&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Archived Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"material-icons mr-1 text-sm",children:"settings"}),"Actions"]})})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--md-sys-color-outline-variant)]",children:q.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:i==="archive"?7:6,className:"px-6 py-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"material-icons text-4xl text-[var(--md-sys-color-on-surface-variant)]",children:"inbox"}),e.jsx("p",{className:"text-[var(--md-sys-color-on-surface-variant)]",children:y?`No records matching "${y}"`:`No ${i==="archive"?"archived":"current"} records found`})]})})}):q.map(t=>e.jsxs("tr",{className:"hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-[var(--md-sys-color-on-surface)]",children:t.itemName||t.item}),e.jsx("td",{className:"px-6 py-4 text-[var(--md-sys-color-on-surface-variant)]",children:t.userName||t.user}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"quantity-badge adequate-stock",children:t.quantity})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"pill-badge",children:t.departmentId||t.costCode||"-"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-[var(--md-sys-color-on-surface-variant)]",children:M(t.dateEntered||t.date)}),i==="archive"&&e.jsx("td",{className:"px-6 py-4 text-sm text-[var(--md-sys-color-on-surface-variant)]",children:M(t.archivedAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:i==="current"?e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"text",color:"primary",className:"!p-2 !min-w-0",onClick:()=>H(t),children:e.jsx("span",{className:"material-icons text-sm",children:"edit"})}),e.jsx(N,{variant:"text",color:"secondary",className:"!p-2 !min-w-0",onClick:()=>K(t),children:e.jsx("span",{className:"material-icons text-sm",children:"archive"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"text",color:"primary",className:"!p-2 !min-w-0",onClick:()=>H(t,"archivedCheckouts"),children:e.jsx("span",{className:"material-icons text-sm",children:"edit"})}),e.jsx(N,{variant:"text",color:"secondary",className:"!p-2 !min-w-0",onClick:()=>W(t),children:e.jsx("span",{className:"material-icons text-sm",children:"unarchive"})})]})})})]},t.id))})]})})}),O&&n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:S,children:e.jsxs("div",{className:"bg-[var(--md-sys-color-surface-container)] rounded-lg p-6 max-w-2xl w-full mx-4 md-elevation-3",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-[var(--md-sys-color-on-surface)] flex items-center",children:[e.jsx("span",{className:"material-icons mr-2 text-[var(--md-sys-color-primary)]",children:"edit"}),"Edit Checkout Record"]}),e.jsx("button",{onClick:S,className:"text-[var(--md-sys-color-on-surface-variant)] hover:text-[var(--md-sys-color-on-surface)]",children:e.jsx("span",{className:"material-icons",children:"close"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{label:"Item Name",value:n.itemName,onChange:t=>p(s=>h(d({},s),{itemName:t.target.value})),required:!0}),e.jsx(j,{label:"User Name",value:n.userName,onChange:t=>p(s=>h(d({},s),{userName:t.target.value})),required:!0}),e.jsx(j,{label:"Quantity",type:"number",value:n.quantity,onChange:t=>p(s=>h(d({},s),{quantity:t.target.value})),required:!0,min:"1"}),e.jsx(j,{label:"Department ID",value:n.departmentId,onChange:t=>p(s=>h(d({},s),{departmentId:t.target.value})),placeholder:"e.g., 2-20-060"}),e.jsx(j,{label:"Job Number",value:n.jobNumber,onChange:t=>p(s=>h(d({},s),{jobNumber:t.target.value})),placeholder:"Optional job number"}),e.jsx(j,{label:"Notes",value:n.notes,onChange:t=>p(s=>h(d({},s),{notes:t.target.value})),placeholder:"Optional notes"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(N,{variant:"outlined",onClick:S,children:"Cancel"}),e.jsxs(N,{variant:"contained",color:"primary",onClick:G,children:[e.jsx("span",{className:"material-icons mr-2",children:"save"}),"Save Changes"]})]})]})})]})};export{me as default};
