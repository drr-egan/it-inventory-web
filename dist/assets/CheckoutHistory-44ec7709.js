var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var L=(n,a,r)=>a in n?Z(n,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[a]=r,l=(n,a)=>{for(var r in a||(a={}))se.call(a,r)&&L(n,r,a[r]);if(H)for(var r of H(a))ae.call(a,r)&&L(n,r,a[r]);return n},h=(n,a)=>ee(n,te(a));var D=(n,a,r)=>new Promise((k,C)=>{var i=m=>{try{j(r.next(m))}catch(y){C(y)}},w=m=>{try{j(r.throw(m))}catch(y){C(y)}},j=m=>m.done?k(m.value):Promise.resolve(m.value).then(i,w);j((r=r.apply(n,a)).next())});import{j as e,L as re,d as p}from"./index-64a8bf0b.js";import{r as d}from"./react-vendor-3371026b.js";import{q as R,l as U,c as T,d as B,e as F,h as b,u as ce,f as P,m as V,k as z}from"./firebase-vendor-e2f55cd7.js";import{M as f}from"./MaterialButton-5d1f6a05.js";import{M as N}from"./MaterialInput-7c1e361c.js";const ue=({user:n})=>{const[a,r]=d.useState([]),[k,C]=d.useState([]),[i,w]=d.useState("current"),[j,m]=d.useState(!0),[y,O]=d.useState(null),[x,q]=d.useState(""),[c,u]=d.useState(null),[Q,A]=d.useState(!1),[J,_]=d.useState("checkoutHistory");d.useEffect(()=>{const t=R(B(p,"checkoutHistory"),T("dateEntered","desc"),U(500)),s=F(t,o=>{const g=o.docs.map(v=>l({id:v.id},v.data()));r(g),m(!1)},o=>{console.error("Error fetching checkout history:",o),O("Failed to load checkout history"),m(!1)});return()=>s()},[]),d.useEffect(()=>{const t=R(B(p,"archivedCheckouts"),T("archivedAt","desc"),U(500)),s=F(t,o=>{const g=o.docs.map(v=>l({id:v.id},v.data()));C(g)},o=>{console.error("Error fetching archived checkouts:",o)});return()=>s()},[]);const I=i==="current"?a:k,E=I.filter(t=>{var o;if(!x)return!0;const s=x.toLowerCase();return(t.itemName||t.item||"").toLowerCase().includes(s)||(t.userName||t.user||"").toLowerCase().includes(s)||(t.departmentId||t.costCode||"").toLowerCase().includes(s)||(((o=t.quantity)==null?void 0:o.toString())||"").includes(s)}),M=t=>t?t.toDate?t.toDate().toLocaleDateString():typeof t=="string"?new Date(t).toLocaleDateString():"Unknown":"Unknown",G=t=>{if(!t)return"";const s=t.split("-");if(s.length>=3){const[o,g,v]=s,Y=v.padStart(3,"0");return`${o}-${g}-${Y}-5770`}return t},$=(t,s="checkoutHistory")=>{u({id:t.id,itemName:t.itemName,userName:t.userName,quantity:t.quantity,departmentId:t.departmentId||t.costCode||"",jobNumber:t.jobNumber||"",notes:t.notes||""}),_(s),A(!0)},S=()=>{u(null),A(!1)},K=()=>D(void 0,null,function*(){if(!(!c||!c.id))try{const s=b(p,J==="archivedCheckouts"?"archivedCheckouts":"checkoutHistory",c.id);yield ce(s,{itemName:c.itemName,userName:c.userName,quantity:parseInt(c.quantity),departmentId:G(c.departmentId),jobNumber:c.jobNumber,notes:c.notes,lastUpdated:P()}),S(),alert("Checkout record updated successfully")}catch(t){console.error("Error updating checkout record:",t),alert("Failed to update checkout record")}}),W=t=>D(void 0,null,function*(){if(confirm(`Archive checkout record for ${t.itemName}?`))try{const s=h(l({},t),{archivedAt:P(),manuallyArchived:!0,archivedBy:(n==null?void 0:n.email)||"unknown"});delete s.id,yield V(b(p,"archivedCheckouts",t.id),s),yield z(b(p,"checkoutHistory",t.id)),console.log(`Manually archived checkout record for ${t.itemName}`)}catch(s){console.error("Error manually archiving record:",s),alert("Failed to archive record. Please try again.")}}),X=t=>D(void 0,null,function*(){if(confirm(`Move ${t.itemName} back to current checkout history?`))try{const s=l({},t);delete s.archivedAt,delete s.manuallyArchived,delete s.shipmentDetails,delete s.id,yield V(b(p,"checkoutHistory",t.id),s),yield z(b(p,"archivedCheckouts",t.id)),console.log(`Unarchived checkout record for ${t.itemName}`)}catch(s){console.error("Error unarchiving record:",s),alert("Failed to unarchive record. Please try again.")}});return j?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(re,{size:"large"}),e.jsx("span",{className:"ml-4 text-[var(--md-sys-color-on-surface)]",children:"Loading history..."})]}):y?e.jsx("div",{className:"bg-[var(--md-sys-color-error-container)] border border-[var(--md-sys-color-error)] rounded-md p-4",children:e.jsx("p",{className:"text-[var(--md-sys-color-on-error-container)]",children:y})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-[var(--md-sys-color-surface-container)] rounded-lg p-6 md-elevation-1",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-[var(--md-sys-color-on-surface)] flex items-center",children:[e.jsx("span",{className:"material-icons mr-2",children:"history"}),"Checkout History"]}),e.jsx("p",{className:"text-sm text-[var(--md-sys-color-on-surface-variant)] mt-1",children:i==="current"?"View active checkout records awaiting processing":"View processed and archived checkout records"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>w("current"),className:`px-4 py-2 rounded-full flex items-center gap-2 transition-all ${i==="current"?"bg-[var(--md-sys-color-primary)] text-[var(--md-sys-color-on-primary)] md-elevation-2":"bg-[var(--md-sys-color-surface-container-high)] text-[var(--md-sys-color-on-surface-variant)]"}`,children:[e.jsx("span",{className:"material-icons text-sm",children:"pending_actions"}),"Current",e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs font-bold",children:a.length})]}),e.jsxs("button",{onClick:()=>w("archive"),className:`px-4 py-2 rounded-full flex items-center gap-2 transition-all ${i==="archive"?"bg-[var(--md-sys-color-primary)] text-[var(--md-sys-color-on-primary)] md-elevation-2":"bg-[var(--md-sys-color-surface-container-high)] text-[var(--md-sys-color-on-surface-variant)]"}`,children:[e.jsx("span",{className:"material-icons text-sm",children:"inventory"}),"Archive",e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs font-bold",children:k.length})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"material-icons absolute left-3 top-1/2 -translate-y-1/2 text-[var(--md-sys-color-on-surface-variant)]",children:"search"}),e.jsx("input",{type:"text",placeholder:"Search by item, user, department, or quantity...",value:x,onChange:t=>q(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-[var(--md-sys-color-surface-container-high)] text-[var(--md-sys-color-on-surface)] rounded-lg border border-[var(--md-sys-color-outline-variant)] focus:outline-none focus:ring-2 focus:ring-[var(--md-sys-color-primary)]"}),x&&e.jsx("button",{onClick:()=>q(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--md-sys-color-on-surface-variant)] hover:text-[var(--md-sys-color-on-surface)]",children:e.jsx("span",{className:"material-icons text-sm",children:"close"})})]}),x&&e.jsxs("p",{className:"text-sm text-[var(--md-sys-color-on-surface-variant)]",children:["Found ",E.length," of ",I.length," records"]})]})}),e.jsx("div",{className:"bg-[var(--md-sys-color-surface-container)] rounded-lg md-elevation-1 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-[var(--md-sys-color-surface-container-high)]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Item"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Date"}),i==="archive"&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:"Archived Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-[var(--md-sys-color-on-surface-variant)] uppercase",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"material-icons mr-1 text-sm",children:"settings"}),"Actions"]})})]})}),e.jsx("tbody",{className:"divide-y divide-[var(--md-sys-color-outline-variant)]",children:E.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:i==="archive"?7:6,className:"px-6 py-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"material-icons text-4xl text-[var(--md-sys-color-on-surface-variant)]",children:"inbox"}),e.jsx("p",{className:"text-[var(--md-sys-color-on-surface-variant)]",children:x?`No records matching "${x}"`:`No ${i==="archive"?"archived":"current"} records found`})]})})}):E.map(t=>e.jsxs("tr",{className:"hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-[var(--md-sys-color-on-surface)]",children:t.itemName||t.item}),e.jsx("td",{className:"px-6 py-4 text-[var(--md-sys-color-on-surface-variant)]",children:t.userName||t.user}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"quantity-badge adequate-stock",children:t.quantity})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"pill-badge",children:t.departmentId||t.costCode||"-"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-[var(--md-sys-color-on-surface-variant)]",children:M(t.dateEntered||t.date)}),i==="archive"&&e.jsx("td",{className:"px-6 py-4 text-sm text-[var(--md-sys-color-on-surface-variant)]",children:M(t.archivedAt)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:i==="current"?e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"text",color:"primary",className:"!p-2 !min-w-0",onClick:()=>$(t),children:e.jsx("span",{className:"material-icons text-sm",children:"edit"})}),e.jsx(f,{variant:"text",color:"secondary",className:"!p-2 !min-w-0",onClick:()=>W(t),children:e.jsx("span",{className:"material-icons text-sm",children:"archive"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"text",color:"primary",className:"!p-2 !min-w-0",onClick:()=>$(t,"archivedCheckouts"),children:e.jsx("span",{className:"material-icons text-sm",children:"edit"})}),e.jsx(f,{variant:"text",color:"secondary",className:"!p-2 !min-w-0",onClick:()=>X(t),children:e.jsx("span",{className:"material-icons text-sm",children:"unarchive"})})]})})})]},t.id))})]})})}),Q&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:S,children:e.jsxs("div",{className:"bg-[var(--md-sys-color-surface-container)] rounded-lg p-6 max-w-2xl w-full mx-4 md-elevation-3",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-[var(--md-sys-color-on-surface)] flex items-center",children:[e.jsx("span",{className:"material-icons mr-2 text-[var(--md-sys-color-primary)]",children:"edit"}),"Edit Checkout Record"]}),e.jsx("button",{onClick:S,className:"text-[var(--md-sys-color-on-surface-variant)] hover:text-[var(--md-sys-color-on-surface)]",children:e.jsx("span",{className:"material-icons",children:"close"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(N,{label:"Item Name",value:c.itemName,onChange:t=>u(s=>h(l({},s),{itemName:t.target.value})),required:!0}),e.jsx(N,{label:"User Name",value:c.userName,onChange:t=>u(s=>h(l({},s),{userName:t.target.value})),required:!0}),e.jsx(N,{label:"Quantity",type:"number",value:c.quantity,onChange:t=>u(s=>h(l({},s),{quantity:t.target.value})),required:!0,min:"1"}),e.jsx(N,{label:"Department ID",value:c.departmentId,onChange:t=>u(s=>h(l({},s),{departmentId:t.target.value})),placeholder:"e.g., 2-20-060"}),e.jsx(N,{label:"Job Number",value:c.jobNumber,onChange:t=>u(s=>h(l({},s),{jobNumber:t.target.value})),placeholder:"Optional job number"}),e.jsx(N,{label:"Notes",value:c.notes,onChange:t=>u(s=>h(l({},s),{notes:t.target.value})),placeholder:"Optional notes"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(f,{variant:"outlined",onClick:S,children:"Cancel"}),e.jsxs(f,{variant:"contained",color:"primary",onClick:K,children:[e.jsx("span",{className:"material-icons mr-2",children:"save"}),"Save Changes"]})]})]})})]})};export{ue as default};
