var ne=Object.defineProperty,ie=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var Q=(i,s,n)=>s in i?ne(i,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[s]=n,d=(i,s)=>{for(var n in s||(s={}))K.call(s,n)&&Q(i,n,s[n]);if(q)for(var n of q(s))O.call(s,n)&&Q(i,n,s[n]);return i},p=(i,s)=>ie(i,ce(s));var V=(i,s)=>{var n={};for(var o in i)K.call(i,o)&&s.indexOf(o)<0&&(n[o]=i[o]);if(i!=null&&q)for(var o of q(i))s.indexOf(o)<0&&O.call(i,o)&&(n[o]=i[o]);return n};var L=(i,s,n)=>new Promise((o,f)=>{var g=u=>{try{h(n.next(u))}catch(v){f(v)}},C=u=>{try{h(n.throw(u))}catch(v){f(v)}},h=u=>u.done?o(u.value):Promise.resolve(u.value).then(g,C);h((n=n.apply(i,s)).next())});import{j as t,L as le,d as E}from"./index-1147e9d1.js";import{r as x}from"./react-vendor-3371026b.js";import{q as de,c as oe,d as H,e as me,f as $,u as G,h as J,j as xe}from"./firebase-vendor-aa9b84e9.js";import{M as I,a as j,b as ge}from"./MaterialPagination-57c56473.js";const b=x.forwardRef((h,C)=>{var u=h,{label:i,type:s="text",value:n,onChange:o,placeholder:f=" "}=u,g=V(u,["label","type","value","onChange","placeholder"]);return t.jsxs("div",{className:"mat-input",children:[t.jsx("input",d({ref:C,type:s,value:n,onChange:o,placeholder:f},g)),t.jsx("label",{children:i})]})});b.displayName="MaterialInput";const fe=({user:i})=>{const[s,n]=x.useState([]),[o,f]=x.useState(!0),[g,C]=x.useState("edit"),[h,u]=x.useState(""),[v,W]=x.useState("all"),[N,P]=x.useState({}),[y,T]=x.useState(""),[A,X]=x.useState([]),[w,D]=x.useState({currentPage:1,itemsPerPage:50,totalItems:0}),[c,k]=x.useState({name:"",price:"",quantity:"",category:"",asin:""}),[U,F]=x.useState(!1),M=x.useRef(null);x.useEffect(()=>{const e=de(H(E,"items"),oe("name")),a=me(e,r=>{const l=r.docs.map(m=>d({id:m.id},m.data()));n(l),f(!1)},r=>{console.error("Error fetching items:",r),f(!1)});return()=>a()},[]);const _=["all",...new Set(s.map(e=>e.category||"Uncategorized").filter(Boolean))],R=s.filter(e=>{var l,m;const a=((l=e.name)==null?void 0:l.toLowerCase().includes(h.toLowerCase()))||((m=e.asin)==null?void 0:m.toLowerCase().includes(h.toLowerCase())),r=v==="all"||e.category===v;return a&&r});x.useEffect(()=>{D(e=>p(d({},e),{totalItems:R.length}))},[R.length]);const Y=()=>{const e=(w.currentPage-1)*w.itemsPerPage,a=e+w.itemsPerPage;return R.slice(e,a)},Z=e=>{D(a=>p(d({},a),{currentPage:e}))},ee=e=>{D(a=>p(d({},a),{itemsPerPage:e,currentPage:1}))},B=(e,a,r)=>{P(l=>p(d({},l),{[e]:p(d({},l[e]),{[a]:r})}))},te=e=>L(void 0,null,function*(){const a=N[e];if(a)try{const r={};a.quantity!==void 0&&(r.quantity=parseInt(a.quantity)),a.price!==void 0&&(r.price=parseFloat(a.price)),r.lastUpdated=$(),yield G(J(E,"items",e),r),P(l=>{const m=d({},l);return delete m[e],m})}catch(r){console.error("Error updating item:",r),alert(`Failed to update item: ${r.message}`)}}),z=()=>L(void 0,null,function*(){if(y.trim())try{const e=y.toLowerCase().trim(),a=s.find(r=>r.asin===y||r.id===y||r.name.toLowerCase()===e||r.name.toLowerCase().includes(e));if(!a){alert(`Item not found: ${y}`);return}yield G(J(E,"items",a.id),{quantity:(a.quantity||0)+1,lastUpdated:$()}),X(r=>[{id:Date.now(),item:a,timestamp:new Date},...r.slice(0,4)]),T(""),M.current&&M.current.focus()}catch(e){console.error("Scan error:",e),alert(`Scan failed: ${e.message}`)}}),ae=e=>{e.key==="Enter"&&y.trim()&&(e.preventDefault(),z())},re=()=>L(void 0,null,function*(){if(!c.name.trim()){alert("Item name is required");return}F(!0);try{yield xe(H(E,"items"),{name:c.name.trim(),price:c.price?parseFloat(c.price):0,quantity:c.quantity?parseInt(c.quantity):0,category:c.category||"Uncategorized",asin:c.asin||"",minThreshold:5,createdAt:$(),lastUpdated:$()}),k({name:"",price:"",quantity:"",category:"",asin:""}),alert("Item created successfully!")}catch(e){console.error("Error creating item:",e),alert(`Failed to create item: ${e.message}`)}finally{F(!1)}}),se=()=>{const e=`Item,Current Quantity,New Quantity,Price,ASIN,Category
`,a=s.map(S=>`"${S.name}",${S.quantity||0},,${S.price||""},${S.asin||""},${S.category||""}`).join(`
`),r=new Blob([e+a],{type:"text/csv"}),l=window.URL.createObjectURL(r),m=document.createElement("a");m.href=l,m.download=`inventory-export-${new Date().toISOString().split("T")[0]}.csv`,m.click()};return o?t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx(le,{size:"large"}),t.jsx("span",{className:"ml-4 dark:text-gray-300",children:"Loading inventory..."})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs(I,{elevation:2,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[t.jsx("span",{className:"material-icons mr-2",children:"inventory_2"}),"Inventory Management"]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:g==="edit"?"Direct editing and bulk operations":"Rapid inventory counting"})]}),t.jsxs(j,{variant:"contained",color:g==="scan"?"success":"primary",onClick:()=>C(g==="edit"?"scan":"edit"),children:[t.jsx("span",{className:"material-icons mr-2",children:g==="scan"?"edit":"qr_code_scanner"}),"Switch to ",g==="edit"?"Scan":"Edit"," Mode"]})]}),g==="edit"&&t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(j,{variant:"outlined",color:"primary",onClick:se,children:[t.jsx("span",{className:"material-icons mr-2",children:"download"}),"Export Template"]}),t.jsxs(j,{variant:"outlined",color:"primary",children:[t.jsx("span",{className:"material-icons mr-2",children:"upload"}),"Import CSV"]})]})]}),g==="scan"&&t.jsxs(I,{elevation:1,children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx("span",{className:"material-icons mr-2 text-green-600",children:"qr_code_scanner"}),"Barcode Scanner"]}),t.jsxs("div",{className:"flex gap-4 mb-4",children:[t.jsx(b,{ref:M,label:"Scan barcode or type item name",value:y,onChange:e=>T(e.target.value),onKeyDown:ae,autoFocus:!0,placeholder:"Enter item name, ASIN, or scan barcode..."}),t.jsxs(j,{onClick:z,disabled:!y.trim(),variant:"contained",color:"success",className:"!px-8",children:[t.jsx("span",{className:"material-icons mr-2",children:"search"}),"Scan"]})]}),A.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Recent Scans"}),t.jsx("div",{className:"space-y-2",children:A.map(e=>t.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.item.name}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.timestamp.toLocaleTimeString()})]}),t.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold",children:"âœ¨ +1"})]},e.id))})]})]}),g==="edit"&&t.jsxs(t.Fragment,{children:[t.jsxs(I,{elevation:1,children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx("span",{className:"material-icons mr-2 text-blue-600",children:"add_box"}),"Add New Item"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(b,{label:"Item Name *",value:c.name,onChange:e=>k(p(d({},c),{name:e.target.value}))}),t.jsx(b,{label:"Price",type:"number",value:c.price,onChange:e=>k(p(d({},c),{price:e.target.value}))}),t.jsx(b,{label:"Initial Quantity",type:"number",value:c.quantity,onChange:e=>k(p(d({},c),{quantity:e.target.value}))}),t.jsx(b,{label:"ASIN",value:c.asin,onChange:e=>k(p(d({},c),{asin:e.target.value}))}),t.jsxs("select",{value:c.category,onChange:e=>k(p(d({},c),{category:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:"Select Category"}),_.filter(e=>e!=="all").map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs(j,{onClick:re,disabled:U||!c.name.trim(),variant:"contained",color:"success",children:[t.jsx("span",{className:"material-icons mr-2",children:"add"}),U?"Creating...":"Create Item"]})]})]}),t.jsx(I,{elevation:1,children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx(b,{label:"Search items",value:h,onChange:e=>u(e.target.value),placeholder:"Search by name or ASIN..."}),t.jsx("select",{value:v,onChange:e=>W(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:_.map(e=>t.jsx("option",{value:e,children:e==="all"?"All Categories":e},e))})]})}),t.jsxs(I,{elevation:1,children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Item"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Quantity"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Price"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Category"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:Y().map(e=>{var a,r;return t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[t.jsxs("td",{className:"px-6 py-4",children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),e.asin&&t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.asin})]}),t.jsx("td",{className:"px-6 py-4",children:N[e.id]?t.jsx("input",{type:"number",value:(a=N[e.id].quantity)!=null?a:e.quantity,onChange:l=>B(e.id,"quantity",l.target.value),className:"w-20 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):t.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${e.quantity<=(e.minThreshold||5)?"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300":"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300"}`,children:e.quantity||0})}),t.jsx("td",{className:"px-6 py-4",children:N[e.id]?t.jsx("input",{type:"number",step:"0.01",value:(r=N[e.id].price)!=null?r:e.price,onChange:l=>B(e.id,"price",l.target.value),className:"w-24 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):e.price>0?t.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium",children:["$",e.price]}):t.jsx("span",{className:"text-gray-400",children:"-"})}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 dark:text-gray-400",children:e.category||"Uncategorized"}),t.jsx("td",{className:"px-6 py-4",children:N[e.id]?t.jsxs("div",{className:"flex gap-2",children:[t.jsx(j,{onClick:()=>te(e.id),variant:"text",color:"success",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"save"})}),t.jsx(j,{onClick:()=>P(l=>{const m=d({},l);return delete m[e.id],m}),variant:"text",color:"error",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"close"})})]}):t.jsx(j,{onClick:()=>P(l=>p(d({},l),{[e.id]:{quantity:e.quantity,price:e.price}})),variant:"text",color:"primary",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"edit"})})})]},e.id)})})]})}),t.jsx(ge,{currentPage:w.currentPage,totalItems:w.totalItems,itemsPerPage:w.itemsPerPage,onPageChange:Z,onItemsPerPageChange:ee})]})]})]})};export{fe as default};
