var ye=Object.defineProperty,je=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var re=(m,r,o)=>r in m?ye(m,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[r]=o,d=(m,r)=>{for(var o in r||(r={}))fe.call(r,o)&&re(m,o,r[o]);if(se)for(var o of se(r))ve.call(r,o)&&re(m,o,r[o]);return m},x=(m,r)=>je(m,be(r));var B=(m,r,o)=>new Promise((M,P)=>{var h=j=>{try{f(o.next(j))}catch(v){P(v)}},D=j=>{try{f(o.throw(j))}catch(v){P(v)}},f=j=>j.done?M(j.value):Promise.resolve(j.value).then(h,D);f((o=o.apply(m,r)).next())});import{j as t,L as ke,d as E}from"./index-f1da842b.js";import{r as l}from"./react-vendor-3371026b.js";import{q as Ne,c as we,d as ne,e as Se,f as Q,u as R,h as _,j as Ce}from"./firebase-vendor-fdbb15af.js";import{M as I}from"./MaterialCard-8fc81c93.js";import{M as y}from"./MaterialButton-f2cb0050.js";import{M as N}from"./MaterialInput-1fa89727.js";import{M as Ie}from"./MaterialPagination-be0712a2.js";const ze=({user:m})=>{const[r,o]=l.useState([]),[M,P]=l.useState(!0),[h,D]=l.useState("edit"),[f,j]=l.useState(""),[v,ie]=l.useState("all"),[w,z]=l.useState({}),[b,V]=l.useState(""),[Z,ce]=l.useState([]),[S,F]=l.useState({currentPage:1,itemsPerPage:50,totalItems:0}),[i,C]=l.useState({name:"",price:"",quantity:"",category:"",asin:""}),[K,O]=l.useState(!1),[g,q]=l.useState(new Set),[u,H]=l.useState(""),[A,W]=l.useState(""),[G,J]=l.useState(!1),T=l.useRef(null);l.useEffect(()=>{const e=Ne(ne(E,"items"),we("name")),a=Se(e,s=>{const n=s.docs.map(c=>d({id:c.id},c.data()));o(n),P(!1)},s=>{console.error("Error fetching items:",s),P(!1)});return()=>a()},[]);const X=["all",...new Set(r.map(e=>e.category||"Uncategorized").filter(Boolean))],U=r.filter(e=>{var n,c;const a=((n=e.name)==null?void 0:n.toLowerCase().includes(f.toLowerCase()))||((c=e.asin)==null?void 0:c.toLowerCase().includes(f.toLowerCase())),s=v==="all"||e.category===v;return a&&s});l.useEffect(()=>{F(e=>x(d({},e),{totalItems:U.length}))},[U.length]);const $=()=>{const e=(S.currentPage-1)*S.itemsPerPage,a=e+S.itemsPerPage;return U.slice(e,a)},le=e=>{F(a=>x(d({},a),{currentPage:e}))},oe=e=>{F(a=>x(d({},a),{itemsPerPage:e,currentPage:1}))},Y=(e,a,s)=>{z(n=>x(d({},n),{[e]:x(d({},n[e]),{[a]:s})}))},de=e=>B(void 0,null,function*(){const a=w[e];if(a)try{const s={};a.quantity!==void 0&&(s.quantity=parseInt(a.quantity)),a.price!==void 0&&(s.price=parseFloat(a.price)),s.lastUpdated=Q(),yield R(_(E,"items",e),s),z(n=>{const c=d({},n);return delete c[e],c})}catch(s){console.error("Error updating item:",s),alert(`Failed to update item: ${s.message}`)}}),ee=()=>B(void 0,null,function*(){if(b.trim())try{const e=b.toLowerCase().trim(),a=r.find(s=>s.asin===b||s.id===b||s.name.toLowerCase()===e||s.name.toLowerCase().includes(e));if(!a){alert(`Item not found: ${b}`);return}yield R(_(E,"items",a.id),{quantity:(a.quantity||0)+1,lastUpdated:Q()}),ce(s=>[{id:Date.now(),item:a,timestamp:new Date},...s.slice(0,4)]),V(""),T.current&&T.current.focus()}catch(e){console.error("Scan error:",e),alert(`Scan failed: ${e.message}`)}}),me=e=>{e.key==="Enter"&&b.trim()&&(e.preventDefault(),ee())},ue=()=>B(void 0,null,function*(){if(!i.name.trim()){alert("Item name is required");return}O(!0);try{yield Ce(ne(E,"items"),{name:i.name.trim(),price:i.price?parseFloat(i.price):0,quantity:i.quantity?parseInt(i.quantity):0,category:i.category||"Uncategorized",asin:i.asin||"",minThreshold:5,createdAt:Q(),lastUpdated:Q()}),C({name:"",price:"",quantity:"",category:"",asin:""}),alert("Item created successfully!")}catch(e){console.error("Error creating item:",e),alert(`Failed to create item: ${e.message}`)}finally{O(!1)}}),xe=()=>{const e=`Item,Current Quantity,New Quantity,Price,ASIN,Category
`,a=r.map(p=>`"${p.name}",${p.quantity||0},,${p.price||""},${p.asin||""},${p.category||""}`).join(`
`),s=new Blob([e+a],{type:"text/csv"}),n=window.URL.createObjectURL(s),c=document.createElement("a");c.href=n,c.download=`inventory-export-${new Date().toISOString().split("T")[0]}.csv`,c.click()},ge=e=>{q(a=>{const s=new Set(a);return s.has(e)?s.delete(e):s.add(e),s})},he=()=>{g.size===$().length?q(new Set):q(new Set($().map(e=>e.id)))},pe=()=>B(void 0,null,function*(){if(g.size===0){alert("Please select items to perform bulk action");return}if(!u){alert("Please select a bulk action");return}if((u==="setQuantity"||u==="setPrice")&&!A){alert("Please enter a value");return}const e=`Are you sure you want to ${u} for ${g.size} items?`;if(confirm(e)){J(!0);try{const a=[];for(const s of g){const n={lastUpdated:Q()};switch(u){case"setQuantity":n.quantity=parseInt(A);break;case"setPrice":n.price=parseFloat(A);break;case"setZero":n.quantity=0;break;case"incrementQuantity":const c=r.find(p=>p.id===s);n.quantity=((c==null?void 0:c.quantity)||0)+(parseInt(A)||1);break}a.push(R(_(E,"items",s),n))}yield Promise.all(a),q(new Set),H(""),W(""),alert(`Bulk action completed for ${g.size} items!`)}catch(a){console.error("Bulk action error:",a),alert(`Bulk action failed: ${a.message}`)}finally{J(!1)}}});return M?t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx(ke,{size:"large"}),t.jsx("span",{className:"ml-4 dark:text-gray-300",children:"Loading inventory..."})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs(I,{elevation:2,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[t.jsx("span",{className:"material-icons mr-2",children:"inventory_2"}),"Inventory Management"]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:h==="edit"?"Direct editing and bulk operations":"Rapid inventory counting"})]}),t.jsxs(y,{variant:"contained",color:h==="scan"?"success":"primary",onClick:()=>D(h==="edit"?"scan":"edit"),children:[t.jsx("span",{className:"material-icons mr-2",children:h==="scan"?"edit":"qr_code_scanner"}),"Switch to ",h==="edit"?"Scan":"Edit"," Mode"]})]}),h==="edit"&&t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(y,{variant:"outlined",color:"primary",onClick:xe,children:[t.jsx("span",{className:"material-icons mr-2",children:"download"}),"Export Template"]}),t.jsxs(y,{variant:"outlined",color:"primary",children:[t.jsx("span",{className:"material-icons mr-2",children:"upload"}),"Import CSV"]})]})]}),h==="scan"&&t.jsxs(I,{elevation:1,children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx("span",{className:"material-icons mr-2 text-green-600",children:"qr_code_scanner"}),"Barcode Scanner"]}),t.jsxs("div",{className:"flex gap-4 mb-4",children:[t.jsx(N,{ref:T,label:"Scan barcode or type item name",value:b,onChange:e=>V(e.target.value),onKeyDown:me,autoFocus:!0,placeholder:"Enter item name, ASIN, or scan barcode..."}),t.jsxs(y,{onClick:ee,disabled:!b.trim(),variant:"contained",color:"success",className:"!px-8",children:[t.jsx("span",{className:"material-icons mr-2",children:"search"}),"Scan"]})]}),Z.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Recent Scans"}),t.jsx("div",{className:"space-y-2",children:Z.map(e=>t.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.item.name}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.timestamp.toLocaleTimeString()})]}),t.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold",children:"âœ¨ +1"})]},e.id))})]})]}),h==="edit"&&t.jsxs(t.Fragment,{children:[t.jsxs(I,{elevation:1,children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx("span",{className:"material-icons mr-2 text-blue-600",children:"add_box"}),"Add New Item"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(N,{label:"Item Name *",value:i.name,onChange:e=>C(x(d({},i),{name:e.target.value}))}),t.jsx(N,{label:"Price",type:"number",value:i.price,onChange:e=>C(x(d({},i),{price:e.target.value}))}),t.jsx(N,{label:"Initial Quantity",type:"number",value:i.quantity,onChange:e=>C(x(d({},i),{quantity:e.target.value}))}),t.jsx(N,{label:"ASIN",value:i.asin,onChange:e=>C(x(d({},i),{asin:e.target.value}))}),t.jsxs("select",{value:i.category,onChange:e=>C(x(d({},i),{category:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:"Select Category"}),X.filter(e=>e!=="all").map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs(y,{onClick:ue,disabled:K||!i.name.trim(),variant:"contained",color:"success",children:[t.jsx("span",{className:"material-icons mr-2",children:"add"}),K?"Creating...":"Create Item"]})]})]}),t.jsx(I,{elevation:1,children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx(N,{label:"Search items",value:f,onChange:e=>j(e.target.value),placeholder:"Search by name or ASIN..."}),t.jsx("select",{value:v,onChange:e=>ie(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:X.map(e=>t.jsx("option",{value:e,children:e==="all"?"All Categories":e},e))})]})}),g.size>0&&t.jsxs(I,{elevation:2,className:"!bg-blue-50 dark:!bg-blue-900/20 !border !border-blue-200 dark:!border-blue-800",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[t.jsx("span",{className:"material-icons mr-2 text-blue-600",children:"check_circle"}),"Bulk Actions"]}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[g.size," item",g.size!==1?"s":""," selected"]})]}),t.jsx(y,{onClick:()=>q(new Set),variant:"text",color:"secondary",children:"Clear Selection"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("select",{value:u,onChange:e=>H(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:"Select Action"}),t.jsx("option",{value:"setQuantity",children:"Set Quantity"}),t.jsx("option",{value:"setPrice",children:"Set Price"}),t.jsx("option",{value:"incrementQuantity",children:"Increment Quantity"}),t.jsx("option",{value:"setZero",children:"Set All to Zero"})]}),(u==="setQuantity"||u==="setPrice"||u==="incrementQuantity")&&t.jsx(N,{label:u==="setPrice"?"Price":"Quantity",type:"number",step:u==="setPrice"?"0.01":"1",value:A,onChange:e=>W(e.target.value)}),t.jsxs(y,{onClick:pe,disabled:G||!u,variant:"contained",color:"primary",className:"md:col-span-2",children:[t.jsx("span",{className:"material-icons mr-2",children:"done_all"}),G?"Processing...":"Apply to Selected"]})]})]}),t.jsxs(I,{elevation:1,children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:g.size===$().length&&$().length>0,onChange:he,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Item"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Quantity"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Price"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Category"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:$().map(e=>{var a,s,n,c,p,te;return t.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700 ${g.has(e.id)?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("input",{type:"checkbox",checked:g.has(e.id),onChange:()=>ge(e.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"})}),t.jsxs("td",{className:"px-6 py-4",children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),e.asin&&t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.asin})]}),t.jsx("td",{className:"px-6 py-4",children:w[e.id]?t.jsx("input",{type:"number",value:(n=(s=(a=w[e.id])==null?void 0:a.quantity)!=null?s:e.quantity)!=null?n:0,onChange:k=>Y(e.id,"quantity",k.target.value),className:"w-20 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):t.jsx("span",{className:`quantity-badge ${e.quantity===0?"out-of-stock":e.quantity<=(e.minThreshold||5)?"low-stock":"adequate-stock"}`,children:e.quantity||0})}),t.jsx("td",{className:"px-6 py-4",children:w[e.id]?t.jsx("input",{type:"number",step:"0.01",value:(te=(p=(c=w[e.id])==null?void 0:c.price)!=null?p:e.price)!=null?te:0,onChange:k=>Y(e.id,"price",k.target.value),className:"w-24 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):e.price>0?t.jsxs("span",{style:{color:"var(--color-success-green)",fontSize:"14px",fontWeight:"600"},children:["$",parseFloat(e.price).toFixed(2)]}):t.jsx("span",{className:"text-gray-400",children:"-"})}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 dark:text-gray-400",children:e.category||"Uncategorized"}),t.jsx("td",{className:"px-6 py-4",children:w[e.id]?t.jsxs("div",{className:"flex gap-2",children:[t.jsx(y,{onClick:()=>de(e.id),variant:"text",color:"success",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"save"})}),t.jsx(y,{onClick:()=>z(k=>{const L=d({},k);return delete L[e.id],L}),variant:"text",color:"error",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"close"})})]}):t.jsx(y,{onClick:()=>z(k=>{var L,ae;return x(d({},k),{[e.id]:{quantity:(L=e.quantity)!=null?L:0,price:(ae=e.price)!=null?ae:0}})}),variant:"text",color:"primary",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"edit"})})})]},e.id)})})]})}),t.jsx(Ie,{currentPage:S.currentPage,totalItems:S.totalItems,itemsPerPage:S.itemsPerPage,onPageChange:le,onItemsPerPageChange:oe})]})]})]})};export{ze as default};
