var xe=Object.defineProperty,ge=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var ee=(m,n,o)=>n in m?xe(m,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[n]=o,d=(m,n)=>{for(var o in n||(n={}))pe.call(n,o)&&ee(m,o,n[o]);if(Y)for(var o of Y(n))ye.call(n,o)&&ee(m,o,n[o]);return m},x=(m,n)=>ge(m,he(n));var $=(m,n,o)=>new Promise((Q,I)=>{var h=y=>{try{b(o.next(y))}catch(f){I(f)}},z=y=>{try{b(o.throw(y))}catch(f){I(f)}},b=y=>y.done?Q(y.value):Promise.resolve(y.value).then(h,z);b((o=o.apply(m,n)).next())});import{j as t,L as je,d as L}from"./index-bf03f64d.js";import{r as l}from"./react-vendor-3371026b.js";import{q as be,c as fe,d as te,e as ve,f as B,u as T,h as U,j as ke}from"./firebase-vendor-3599879c.js";import{M as C,a as p}from"./MaterialButton-ca0e42f1.js";import{M as k}from"./MaterialInput-ee1c89d5.js";import{M as Ne}from"./MaterialPagination-e7729cb7.js";const $e=({user:m})=>{const[n,o]=l.useState([]),[Q,I]=l.useState(!0),[h,z]=l.useState("edit"),[b,y]=l.useState(""),[f,ae]=l.useState("all"),[N,E]=l.useState({}),[j,R]=l.useState(""),[_,se]=l.useState([]),[w,M]=l.useState({currentPage:1,itemsPerPage:50,totalItems:0}),[i,S]=l.useState({name:"",price:"",quantity:"",category:"",asin:""}),[V,Z]=l.useState(!1),[g,P]=l.useState(new Set),[u,K]=l.useState(""),[q,O]=l.useState(""),[H,W]=l.useState(!1),D=l.useRef(null);l.useEffect(()=>{const e=be(te(L,"items"),fe("name")),a=ve(e,s=>{const r=s.docs.map(c=>d({id:c.id},c.data()));o(r),I(!1)},s=>{console.error("Error fetching items:",s),I(!1)});return()=>a()},[]);const G=["all",...new Set(n.map(e=>e.category||"Uncategorized").filter(Boolean))],F=n.filter(e=>{var r,c;const a=((r=e.name)==null?void 0:r.toLowerCase().includes(b.toLowerCase()))||((c=e.asin)==null?void 0:c.toLowerCase().includes(b.toLowerCase())),s=f==="all"||e.category===f;return a&&s});l.useEffect(()=>{M(e=>x(d({},e),{totalItems:F.length}))},[F.length]);const A=()=>{const e=(w.currentPage-1)*w.itemsPerPage,a=e+w.itemsPerPage;return F.slice(e,a)},re=e=>{M(a=>x(d({},a),{currentPage:e}))},ne=e=>{M(a=>x(d({},a),{itemsPerPage:e,currentPage:1}))},J=(e,a,s)=>{E(r=>x(d({},r),{[e]:x(d({},r[e]),{[a]:s})}))},ie=e=>$(void 0,null,function*(){const a=N[e];if(a)try{const s={};a.quantity!==void 0&&(s.quantity=parseInt(a.quantity)),a.price!==void 0&&(s.price=parseFloat(a.price)),s.lastUpdated=B(),yield T(U(L,"items",e),s),E(r=>{const c=d({},r);return delete c[e],c})}catch(s){console.error("Error updating item:",s),alert(`Failed to update item: ${s.message}`)}}),X=()=>$(void 0,null,function*(){if(j.trim())try{const e=j.toLowerCase().trim(),a=n.find(s=>s.asin===j||s.id===j||s.name.toLowerCase()===e||s.name.toLowerCase().includes(e));if(!a){alert(`Item not found: ${j}`);return}yield T(U(L,"items",a.id),{quantity:(a.quantity||0)+1,lastUpdated:B()}),se(s=>[{id:Date.now(),item:a,timestamp:new Date},...s.slice(0,4)]),R(""),D.current&&D.current.focus()}catch(e){console.error("Scan error:",e),alert(`Scan failed: ${e.message}`)}}),ce=e=>{e.key==="Enter"&&j.trim()&&(e.preventDefault(),X())},le=()=>$(void 0,null,function*(){if(!i.name.trim()){alert("Item name is required");return}Z(!0);try{yield ke(te(L,"items"),{name:i.name.trim(),price:i.price?parseFloat(i.price):0,quantity:i.quantity?parseInt(i.quantity):0,category:i.category||"Uncategorized",asin:i.asin||"",minThreshold:5,createdAt:B(),lastUpdated:B()}),S({name:"",price:"",quantity:"",category:"",asin:""}),alert("Item created successfully!")}catch(e){console.error("Error creating item:",e),alert(`Failed to create item: ${e.message}`)}finally{Z(!1)}}),oe=()=>{const e=`Item,Current Quantity,New Quantity,Price,ASIN,Category
`,a=n.map(v=>`"${v.name}",${v.quantity||0},,${v.price||""},${v.asin||""},${v.category||""}`).join(`
`),s=new Blob([e+a],{type:"text/csv"}),r=window.URL.createObjectURL(s),c=document.createElement("a");c.href=r,c.download=`inventory-export-${new Date().toISOString().split("T")[0]}.csv`,c.click()},de=e=>{P(a=>{const s=new Set(a);return s.has(e)?s.delete(e):s.add(e),s})},me=()=>{g.size===A().length?P(new Set):P(new Set(A().map(e=>e.id)))},ue=()=>$(void 0,null,function*(){if(g.size===0){alert("Please select items to perform bulk action");return}if(!u){alert("Please select a bulk action");return}if((u==="setQuantity"||u==="setPrice")&&!q){alert("Please enter a value");return}const e=`Are you sure you want to ${u} for ${g.size} items?`;if(confirm(e)){W(!0);try{const a=[];for(const s of g){const r={lastUpdated:B()};switch(u){case"setQuantity":r.quantity=parseInt(q);break;case"setPrice":r.price=parseFloat(q);break;case"setZero":r.quantity=0;break;case"incrementQuantity":const c=n.find(v=>v.id===s);r.quantity=((c==null?void 0:c.quantity)||0)+(parseInt(q)||1);break}a.push(T(U(L,"items",s),r))}yield Promise.all(a),P(new Set),K(""),O(""),alert(`Bulk action completed for ${g.size} items!`)}catch(a){console.error("Bulk action error:",a),alert(`Bulk action failed: ${a.message}`)}finally{W(!1)}}});return Q?t.jsxs("div",{className:"flex items-center justify-center h-64",children:[t.jsx(je,{size:"large"}),t.jsx("span",{className:"ml-4 dark:text-gray-300",children:"Loading inventory..."})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs(C,{elevation:2,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[t.jsx("span",{className:"material-icons mr-2",children:"inventory_2"}),"Inventory Management"]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:h==="edit"?"Direct editing and bulk operations":"Rapid inventory counting"})]}),t.jsxs(p,{variant:"contained",color:h==="scan"?"success":"primary",onClick:()=>z(h==="edit"?"scan":"edit"),children:[t.jsx("span",{className:"material-icons mr-2",children:h==="scan"?"edit":"qr_code_scanner"}),"Switch to ",h==="edit"?"Scan":"Edit"," Mode"]})]}),h==="edit"&&t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(p,{variant:"outlined",color:"primary",onClick:oe,children:[t.jsx("span",{className:"material-icons mr-2",children:"download"}),"Export Template"]}),t.jsxs(p,{variant:"outlined",color:"primary",children:[t.jsx("span",{className:"material-icons mr-2",children:"upload"}),"Import CSV"]})]})]}),h==="scan"&&t.jsxs(C,{elevation:1,children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx("span",{className:"material-icons mr-2 text-green-600",children:"qr_code_scanner"}),"Barcode Scanner"]}),t.jsxs("div",{className:"flex gap-4 mb-4",children:[t.jsx(k,{ref:D,label:"Scan barcode or type item name",value:j,onChange:e=>R(e.target.value),onKeyDown:ce,autoFocus:!0,placeholder:"Enter item name, ASIN, or scan barcode..."}),t.jsxs(p,{onClick:X,disabled:!j.trim(),variant:"contained",color:"success",className:"!px-8",children:[t.jsx("span",{className:"material-icons mr-2",children:"search"}),"Scan"]})]}),_.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Recent Scans"}),t.jsx("div",{className:"space-y-2",children:_.map(e=>t.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.item.name}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.timestamp.toLocaleTimeString()})]}),t.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold",children:"âœ¨ +1"})]},e.id))})]})]}),h==="edit"&&t.jsxs(t.Fragment,{children:[t.jsxs(C,{elevation:1,children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx("span",{className:"material-icons mr-2 text-blue-600",children:"add_box"}),"Add New Item"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(k,{label:"Item Name *",value:i.name,onChange:e=>S(x(d({},i),{name:e.target.value}))}),t.jsx(k,{label:"Price",type:"number",value:i.price,onChange:e=>S(x(d({},i),{price:e.target.value}))}),t.jsx(k,{label:"Initial Quantity",type:"number",value:i.quantity,onChange:e=>S(x(d({},i),{quantity:e.target.value}))}),t.jsx(k,{label:"ASIN",value:i.asin,onChange:e=>S(x(d({},i),{asin:e.target.value}))}),t.jsxs("select",{value:i.category,onChange:e=>S(x(d({},i),{category:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:"Select Category"}),G.filter(e=>e!=="all").map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs(p,{onClick:le,disabled:V||!i.name.trim(),variant:"contained",color:"success",children:[t.jsx("span",{className:"material-icons mr-2",children:"add"}),V?"Creating...":"Create Item"]})]})]}),t.jsx(C,{elevation:1,children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx(k,{label:"Search items",value:b,onChange:e=>y(e.target.value),placeholder:"Search by name or ASIN..."}),t.jsx("select",{value:f,onChange:e=>ae(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:G.map(e=>t.jsx("option",{value:e,children:e==="all"?"All Categories":e},e))})]})}),g.size>0&&t.jsxs(C,{elevation:2,className:"!bg-blue-50 dark:!bg-blue-900/20 !border !border-blue-200 dark:!border-blue-800",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[t.jsx("span",{className:"material-icons mr-2 text-blue-600",children:"check_circle"}),"Bulk Actions"]}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[g.size," item",g.size!==1?"s":""," selected"]})]}),t.jsx(p,{onClick:()=>P(new Set),variant:"text",color:"secondary",children:"Clear Selection"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("select",{value:u,onChange:e=>K(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:"Select Action"}),t.jsx("option",{value:"setQuantity",children:"Set Quantity"}),t.jsx("option",{value:"setPrice",children:"Set Price"}),t.jsx("option",{value:"incrementQuantity",children:"Increment Quantity"}),t.jsx("option",{value:"setZero",children:"Set All to Zero"})]}),(u==="setQuantity"||u==="setPrice"||u==="incrementQuantity")&&t.jsx(k,{label:u==="setPrice"?"Price":"Quantity",type:"number",step:u==="setPrice"?"0.01":"1",value:q,onChange:e=>O(e.target.value)}),t.jsxs(p,{onClick:ue,disabled:H||!u,variant:"contained",color:"primary",className:"md:col-span-2",children:[t.jsx("span",{className:"material-icons mr-2",children:"done_all"}),H?"Processing...":"Apply to Selected"]})]})]}),t.jsxs(C,{elevation:1,children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left",children:t.jsx("input",{type:"checkbox",checked:g.size===A().length&&A().length>0,onChange:me,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"})}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Item"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Quantity"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Price"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Category"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:A().map(e=>{var a,s;return t.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700 ${g.has(e.id)?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[t.jsx("td",{className:"px-6 py-4",children:t.jsx("input",{type:"checkbox",checked:g.has(e.id),onChange:()=>de(e.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"})}),t.jsxs("td",{className:"px-6 py-4",children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),e.asin&&t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.asin})]}),t.jsx("td",{className:"px-6 py-4",children:N[e.id]?t.jsx("input",{type:"number",value:(a=N[e.id].quantity)!=null?a:e.quantity,onChange:r=>J(e.id,"quantity",r.target.value),className:"w-20 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):t.jsx("span",{className:`quantity-badge ${e.quantity===0?"out-of-stock":e.quantity<=(e.minThreshold||5)?"low-stock":"adequate-stock"}`,children:e.quantity||0})}),t.jsx("td",{className:"px-6 py-4",children:N[e.id]?t.jsx("input",{type:"number",step:"0.01",value:(s=N[e.id].price)!=null?s:e.price,onChange:r=>J(e.id,"price",r.target.value),className:"w-24 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):e.price>0?t.jsxs("span",{style:{color:"var(--color-success-green)",fontSize:"14px",fontWeight:"600"},children:["$",parseFloat(e.price).toFixed(2)]}):t.jsx("span",{className:"text-gray-400",children:"-"})}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 dark:text-gray-400",children:e.category||"Uncategorized"}),t.jsx("td",{className:"px-6 py-4",children:N[e.id]?t.jsxs("div",{className:"flex gap-2",children:[t.jsx(p,{onClick:()=>ie(e.id),variant:"text",color:"success",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"save"})}),t.jsx(p,{onClick:()=>E(r=>{const c=d({},r);return delete c[e.id],c}),variant:"text",color:"error",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"close"})})]}):t.jsx(p,{onClick:()=>E(r=>x(d({},r),{[e.id]:{quantity:e.quantity,price:e.price}})),variant:"text",color:"primary",className:"!p-2 !min-w-0",children:t.jsx("span",{className:"material-icons text-sm",children:"edit"})})})]},e.id)})})]})}),t.jsx(Ne,{currentPage:w.currentPage,totalItems:w.totalItems,itemsPerPage:w.itemsPerPage,onPageChange:re,onItemsPerPageChange:ne})]})]})]})};export{$e as default};
