var Pe=Object.defineProperty,Ie=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var me=(j,g,x)=>g in j?Pe(j,g,{enumerable:!0,configurable:!0,writable:!0,value:x}):j[g]=x,M=(j,g)=>{for(var x in g||(g={}))$e.call(g,x)&&me(j,x,g[x]);if(de)for(var x of de(g))ke.call(g,x)&&me(j,x,g[x]);return j},G=(j,g)=>Ie(j,Ce(g));var Y=(j,g,x)=>new Promise((B,q)=>{var O=w=>{try{y(x.next(w))}catch(U){q(U)}},K=w=>{try{y(x.throw(w))}catch(U){q(U)}},y=w=>w.done?B(w.value):Promise.resolve(w.value).then(O,K);y((x=x.apply(j,g)).next())});import{j as e,d as I}from"./index-fffaf7ab.js";import{r as k}from"./react-vendor-3371026b.js";import{w as xe,h as Q,l as Fe,d as ue,T as ye}from"./firebase-vendor-7a1907cd.js";import{M as he}from"./MaterialButton-ca44b973.js";import{M as fe}from"./MaterialInput-3a36dd41.js";const qe=({items:j,checkoutHistory:g,user:x})=>{const[B,q]=k.useState([]),[O,K]=k.useState(""),[y,w]=k.useState([]),[U,V]=k.useState(!1),[Z,se]=k.useState(""),[ee,oe]=k.useState(""),[H,re]=k.useState(null),[J,F]=k.useState(""),[ae,ne]=k.useState([]),[S,ce]=k.useState(null),pe=s=>{B.findIndex(n=>n.id===s.id)>=0?(q(n=>n.filter(c=>c.id!==s.id)),w(n=>n.filter(c=>c.inventoryItem.id!==s.id))):(q(n=>[...n,s]),ve(s))},ve=s=>{const a=g.filter(n=>{var c,i,d,u;return((c=n.itemName)==null?void 0:c.toLowerCase())===((i=s.name)==null?void 0:i.toLowerCase())||((d=n.item)==null?void 0:d.toLowerCase())===((u=s.name)==null?void 0:u.toLowerCase())});if(a.length>0){const n={inventoryItem:s,checkoutRecords:a,confirmedQuantity:a.reduce((c,i)=>c+(i.quantity||1),0),confirmedPrice:s.price||0};w(c=>[...c,n])}else{const n={inventoryItem:s,checkoutRecords:[],confirmedQuantity:1,confirmedPrice:s.price||0};w(c=>[...c,n])}},le=(s,a,n)=>{w(c=>c.map(i=>i.inventoryItem.id===s?G(M({},i),{[a]:parseFloat(n)||0}):i))},ge=s=>{const a=s.target.files[0];a&&a.type==="application/pdf"?re(a):alert("Please select a valid PDF file.")},be=()=>Y(void 0,null,function*(){if(!S){alert("No transaction to undo");return}const s=`This will undo the last processing of ${S.itemsProcessed} items.

This will:
• Restore checkout records from archive
• Revert inventory quantity changes
• Remove cost allocation records

Continue?`;if(confirm(s))try{F("⏳ Undoing last transaction...");const a=xe(I);for(const d of S.checkoutRecords){if(d.id.startsWith("synthetic-"))continue;const u=Q(I,"checkoutHistory",d.id),v=M({},d);delete v.id,delete v.inventoryItem,delete v.confirmedPrice,a.set(u,v);const N=Q(I,"archivedCheckouts",d.id);a.delete(N)}for(const d of S.inventoryUpdates){const u=j.find(v=>v.id===d.itemId);if(u){const v=Q(I,"items",d.itemId),N=Math.max(0,u.quantity-d.quantityAdded);a.update(v,{quantity:N})}}const n=yield Fe(ue(I,"costAllocation")),c=new Date(S.timestamp).getTime(),i=5e3;n.docs.forEach(d=>{var N,E,A;const v=(A=(E=(N=d.data().processedAt)==null?void 0:N.toDate)==null?void 0:E.call(N))==null?void 0:A.getTime();v&&Math.abs(v-c)<i&&a.delete(Q(I,"costAllocation",d.id))}),yield a.commit(),ce(null),ne(d=>d.slice(0,-1)),F("✅ Transaction successfully undone. Checkout records restored and inventory reverted.")}catch(a){console.error("Error undoing transaction:",a),F(`❌ Error undoing transaction: ${a.message}`)}}),je=()=>Y(void 0,null,function*(){if(!H){F("❌ Please upload a receipt PDF first");return}if(y.length===0){F("❌ Please select at least one item from inventory");return}console.log("=== SHIPMENT PROCESSING DEBUG ==="),console.log("Matched checkouts:",y.length),y.forEach((c,i)=>{console.log(`Item ${i+1}: ${c.inventoryItem.name}`),console.log(`  - Confirmed Quantity: ${c.confirmedQuantity}`),console.log(`  - Confirmed Price: $${c.confirmedPrice}`),console.log(`  - Checkout Records: ${c.checkoutRecords.length}`)});const s=y.reduce((c,i)=>c+i.confirmedQuantity,0);console.log(`Total Expected Items: ${s}`),console.log("=================================");const a=y.map(c=>`  • ${c.inventoryItem.name}: ${c.confirmedQuantity} items @ $${c.confirmedPrice.toFixed(2)}`).join(`
`),n=`You are about to process ${y.length} item type(s) with a total of ${s} items:

${a}

Do you want to proceed?`;if(!confirm(n)){F("❌ Processing cancelled by user");return}V(!0),F("⏳ Processing receipt and generating cost allocation...");try{const c=parseFloat(Z)||0,i=parseFloat(ee)||0,d=y.flatMap(r=>{const t=r.confirmedQuantity,T=[...r.checkoutRecords].sort((f,l)=>{var L,_,R,X;const P=((_=(L=f.dateEntered)==null?void 0:L.toDate)==null?void 0:_.call(L))||f.dateEntered||new Date(0),te=((X=(R=l.dateEntered)==null?void 0:R.toDate)==null?void 0:X.call(R))||l.dateEntered||new Date(0);return P-te}),b=[];let p=0;for(const f of T){if(p>=t)break;const l=f.quantity||1,P=t-p;P<l?(b.push(G(M({},f),{quantity:P})),p+=P):(b.push(f),p+=l)}const $=t-p,z=[];if($>0)for(let f=0;f<$;f++)z.push({id:`synthetic-${r.inventoryItem.id}-${Date.now()}-${f}`,itemName:r.inventoryItem.name,userName:"IT Stock",quantity:1,departmentId:"1-20-000-5770",dateEntered:new Date,inventoryItem:r.inventoryItem,confirmedPrice:r.confirmedPrice});return[...b.map(f=>G(M({},f),{inventoryItem:r.inventoryItem,confirmedPrice:r.confirmedPrice})),...z]}),u=d.reduce((r,t)=>r+(t.quantity||1),0);console.log("=== ALLOCATION RESULT ==="),console.log(`Total checkout records allocated: ${d.length}`),console.log(`Total item quantity: ${u}`),u!==s?console.warn(`⚠️ MISMATCH: Expected ${s} items but allocated ${u}!`):console.log("✓ Quantities match!"),console.log("========================");const v=u>0?c/u:0,N=u>0?i/u:0,E=d.reduce((r,t)=>{const T=t.departmentId||t.costCode||"IT Stock 1-20-000-5770",p=`${t.inventoryItem.name}|${T}`;return r[p]||(r[p]=[]),r[p].push(t),r},{}),A=Object.entries(E).map(([r,t])=>{const[T,b]=r.split("|"),p=t.reduce((f,l)=>f+(l.quantity||1),0),$=t[0].confirmedPrice,z=v*p,D=N*p;return{itemName:T,quantity:p,unitPrice:$,totalCost:$*p+z+D,taxAllocation:z,feeAllocation:D,costCode:b}}),C=A.reduce((r,t)=>r+t.unitPrice*t.quantity,0),o=C+c+i;yield Ne(A,{subtotal:C,tax:c,fees:i,total:o,taxPerItem:v,feePerItem:N},H,d);const h=xe(I);for(const r of d){const t=r.departmentId||r.costCode||"IT Stock 1-20-000-5770",T=r.quantity||1,b=r.confirmedPrice,p=v*T,$=N*T,z=Q(ue(I,"costAllocation"));if(h.set(z,{itemId:r.inventoryItem.id,itemName:r.inventoryItem.name,quantity:T,unitPrice:b,totalCost:b*T+p+$,taxAllocation:p,feeAllocation:$,costCode:t,userName:r.userName||r.user||"Unknown",processedAt:ye.now(),processedBy:(x==null?void 0:x.employeeID)||(x==null?void 0:x.email)||"Unknown",type:t.includes("Job")?"job":"it_stock"}),!r.id.startsWith("synthetic-")){const D=G(M({},r),{archivedAt:ye.now(),archivedBy:(x==null?void 0:x.employeeID)||(x==null?void 0:x.email)||"Unknown",archiveReason:"Processed receipt"});delete D.id;const f=Q(I,"archivedCheckouts",r.id);h.set(f,D);const l=Q(I,"checkoutHistory",r.id);h.delete(l)}}for(const r of y){const t=Q(I,"items",r.inventoryItem.id),b=(r.inventoryItem.quantity||0)+r.confirmedQuantity;h.update(t,{quantity:b})}yield h.commit();const m={timestamp:new Date().toISOString(),itemsProcessed:d.length,totalAmount:o,checkoutRecords:d,inventoryUpdates:y.map(r=>({itemId:r.inventoryItem.id,quantityAdded:r.confirmedQuantity}))};ce(m);const ie={timestamp:new Date().toISOString(),itemsProcessed:d.length,totalAmount:o};ne(r=>[...r,ie]),q([]),w([]),se(""),oe(""),re(null),F(`✅ Shipment processed successfully! ${u} items from ${y.length} product type(s) included in report. PDF downloaded and items archived.`),V(!1)}catch(c){console.error("Error processing shipment:",c),F(`❌ Error: ${c.message}`),V(!1)}}),Ne=(s,a,n,c)=>Y(void 0,null,function*(){try{const i=window.PDFLib,{PDFDocument:d,rgb:u,StandardFonts:v}=i,N=a.taxPerItem||0,E=a.feePerItem||0,A=yield n.arrayBuffer(),C=yield d.load(A);let o=C.addPage([612,792]);const h=yield C.embedFont(v.Helvetica),m=yield C.embedFont(v.HelveticaBold),{width:ie,height:r}=o.getSize();let t=r-50;if(o.drawText("Shipment Cost Allocation Report",{x:50,y:t,size:16,font:m,color:u(0,0,0)}),t-=30,a.tax>0||a.fees>0){const l=`Tax ($${a.tax.toFixed(2)}) and Fees ($${a.fees.toFixed(2)}) distributed evenly per item`;o.drawText(l,{x:50,y:t,size:10,font:h,color:u(0,0,0)}),t-=30}o.drawText("Cost Allocation Summary",{x:50,y:t,size:14,font:m,color:u(0,0,0)}),t-=25,o.drawText("Item Description",{x:50,y:t,size:9,font:m}),o.drawText("Qty",{x:280,y:t,size:9,font:m}),o.drawText("Job/Cost Code",{x:320,y:t,size:9,font:m}),o.drawText("Unit Price",{x:440,y:t,size:9,font:m}),o.drawText("Total Cost",{x:510,y:t,size:9,font:m}),t-=15;for(const l of s){t<150&&(o=C.addPage([612,792]),t=r-50,o.drawText("Item Description",{x:50,y:t,size:9,font:m}),o.drawText("Qty",{x:280,y:t,size:9,font:m}),o.drawText("Job/Cost Code",{x:320,y:t,size:9,font:m}),o.drawText("Unit Price",{x:440,y:t,size:9,font:m}),o.drawText("Total Cost",{x:510,y:t,size:9,font:m}),t-=15);const P=l.itemName.length>45?l.itemName.substring(0,45)+"...":l.itemName;o.drawText(P,{x:50,y:t,size:9,font:h}),o.drawText(String(l.quantity),{x:280,y:t,size:9,font:h}),o.drawText(l.costCode||"-",{x:320,y:t,size:9,font:h}),o.drawText(`$${l.unitPrice.toFixed(2)}`,{x:440,y:t,size:9,font:h}),o.drawText(`$${l.totalCost.toFixed(2)}`,{x:510,y:t,size:9,font:h}),t-=15}t-=10;const T=s.reduce((l,P)=>l+P.quantity,0);o.drawText(`Total Items: ${T}`,{x:50,y:t,size:9,font:m}),t-=20;const b=420;o.drawText(`Subtotal (Items): $${a.subtotal.toFixed(2)}`,{x:b,y:t,size:9,font:h}),t-=12,o.drawText(`Tax: $${a.tax.toFixed(2)}`,{x:b,y:t,size:9,font:h}),t-=12,o.drawText(`Fees: $${a.fees.toFixed(2)}`,{x:b,y:t,size:9,font:h}),t-=15,o.drawText(`Grand Total: $${a.total.toFixed(2)}`,{x:b,y:t,size:10,font:m}),t-=30,t<150&&(o=C.addPage([612,792]),t=r-50),o.drawText("Individual Checkout Details",{x:50,y:t,size:14,font:m,color:u(0,0,0)}),t-=25,o.drawText("Item Description",{x:50,y:t,size:9,font:m}),o.drawText("User",{x:210,y:t,size:9,font:m}),o.drawText("Qty",{x:330,y:t,size:9,font:m}),o.drawText("Cost Code",{x:360,y:t,size:9,font:m}),o.drawText("Unit Price",{x:460,y:t,size:9,font:m}),o.drawText("Total Cost",{x:520,y:t,size:9,font:m}),t-=15;for(const l of c){t<100&&(o=C.addPage([612,792]),t=r-50,o.drawText("Item Description",{x:50,y:t,size:9,font:m}),o.drawText("User",{x:210,y:t,size:9,font:m}),o.drawText("Qty",{x:330,y:t,size:9,font:m}),o.drawText("Cost Code",{x:360,y:t,size:9,font:m}),o.drawText("Unit Price",{x:460,y:t,size:9,font:m}),o.drawText("Total Cost",{x:520,y:t,size:9,font:m}),t-=15);const P=l.inventoryItem.name.length>30?l.inventoryItem.name.substring(0,30)+"...":l.inventoryItem.name,te=(l.userName||l.user||"N/A").length>20?(l.userName||l.user||"N/A").substring(0,20)+"...":l.userName||l.user||"N/A",L=l.departmentId||l.costCode||"IT Stock 1-20-000-5770",_=l.confirmedPrice,R=l.quantity||1,X=N*R,we=E*R,Te=_*R+X+we;o.drawText(P,{x:50,y:t,size:9,font:h}),o.drawText(te,{x:210,y:t,size:9,font:h}),o.drawText(String(R),{x:330,y:t,size:9,font:h}),o.drawText(L,{x:360,y:t,size:9,font:h}),o.drawText(`$${_.toFixed(2)}`,{x:460,y:t,size:9,font:h}),o.drawText(`$${Te.toFixed(2)}`,{x:520,y:t,size:9,font:h}),t-=15}t-=5;const p=c.reduce((l,P)=>l+(P.quantity||1),0);o.drawText(`Total Items: ${p}`,{x:50,y:t,size:9,font:m});const $=yield C.save(),z=new Blob([$],{type:"application/pdf"}),D=URL.createObjectURL(z),f=document.createElement("a");f.href=D,f.download=n.name,f.click(),URL.revokeObjectURL(D)}catch(i){throw console.error("Error generating PDF report:",i),i}}),W=j.filter(s=>{var n,c,i;if(!O)return!0;const a=O.toLowerCase();return((n=s.name)==null?void 0:n.toLowerCase().includes(a))||((c=s.category)==null?void 0:c.toLowerCase().includes(a))||((i=s.asin)==null?void 0:i.toLowerCase().includes(a))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center mb-4",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",children:"receipt_long"}),"Process Shipment Receipt"]}),e.jsx("p",{style:{color:"var(--color-text-muted)"},children:"Follow the 3-step workflow: Select inventory items, confirm quantities & prices, then upload receipt and process with automatic cost allocation."})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"1"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"inventory_2"}),"Select Items from Inventory (",B.length," selected)"]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by item name, category, or ASIN...",value:O,onChange:s=>K(s.target.value),className:"w-full px-4 py-2 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}}),e.jsx("span",{className:"material-icons absolute right-3 top-2.5",style:{color:"var(--color-text-muted)"},children:"search"})]})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{style:{background:"var(--md-sys-color-surface-container-high)"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium",style:{color:"var(--color-text-light)"},children:"Select"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium",style:{color:"var(--color-text-light)"},children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium",style:{color:"var(--color-text-light)"},children:"Category"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium",style:{color:"var(--color-text-light)"},children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium",style:{color:"var(--color-text-light)"},children:"Price"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium",style:{color:"var(--color-text-light)"},children:"Cost Code"})]})}),e.jsx("tbody",{children:W.slice(0,20).map(s=>{const a=B.some(c=>c.id===s.id),n="IT Stock 1-20-000-5770";return e.jsxs("tr",{className:`border-b border-[var(--md-sys-color-outline-variant)] cursor-pointer hover:bg-[var(--md-sys-color-surface-container-highest)] ${a?"bg-[rgba(59,130,246,0.15)]":""}`,onClick:()=>pe(s),children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:a,onChange:()=>{},className:"cursor-pointer"})}),e.jsxs("td",{className:"px-4 py-2 text-sm font-medium",style:{color:"var(--color-text-light)"},children:[s.name,s.asin&&e.jsx("div",{className:"text-xs",style:{color:"var(--color-text-muted)"},children:s.asin})]}),e.jsx("td",{className:"px-4 py-2 text-sm",style:{color:"var(--color-text-muted)"},children:s.category||"Uncategorized"}),e.jsx("td",{className:"px-4 py-2 text-sm",children:e.jsx("span",{className:"quantity-badge adequate-stock",children:s.quantity||0})}),e.jsx("td",{className:"px-4 py-2 text-sm",style:{color:"var(--color-success-green)"},children:s.price>0?`$${s.price.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-2 text-sm",children:e.jsx("span",{className:"pill-badge",children:n})})]},s.id)})})]}),W.length===0&&e.jsx("div",{className:"text-center py-8",style:{color:"var(--color-text-muted)"},children:"No inventory items available"}),W.length>20&&e.jsxs("div",{className:"text-center py-2 text-sm",style:{color:"var(--color-text-muted)"},children:["Showing first 20 of ",W.length," items"]})]})]}),y.length>0&&e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"2"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"link"}),"Confirm Quantities & Prices (",y.length," items)"]}),e.jsx("div",{className:"space-y-4",children:y.map((s,a)=>e.jsxs("div",{className:"border border-[var(--md-sys-color-outline-variant)] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium",style:{color:"var(--color-text-light)"},children:s.inventoryItem.name}),e.jsxs("span",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:[s.checkoutRecords.length," checkout",s.checkoutRecords.length!==1?"s":""," matched"]})]}),s.checkoutRecords.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-light)"},children:"Checkout Details:"}),e.jsx("div",{className:"space-y-1",children:s.checkoutRecords.map((n,c)=>{var i,d;return e.jsxs("div",{className:"text-xs p-2 rounded",style:{background:"var(--md-sys-color-surface-container-high)",color:"var(--color-text-muted)"},children:[n.userName||n.user," • Qty: ",n.quantity," • Dept: ",n.departmentId||n.costCode," • ",new Date(((d=(i=n.dateEntered)==null?void 0:i.toDate)==null?void 0:d.call(i))||n.dateEntered||n.date).toLocaleDateString()]},n.id)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--color-text-light)"},children:"Received Quantity"}),e.jsx("input",{type:"number",min:"1",value:s.confirmedQuantity,onChange:n=>le(s.inventoryItem.id,"confirmedQuantity",n.target.value),className:"w-full px-3 py-2 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--color-text-light)"},children:"Unit Price"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:s.confirmedPrice,onChange:n=>le(s.inventoryItem.id,"confirmedPrice",n.target.value),className:"w-full px-3 py-2 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}})]})]}),e.jsxs("div",{className:"mt-3 text-sm",style:{color:"var(--color-text-muted)"},children:["Total: $",(s.confirmedQuantity*s.confirmedPrice).toFixed(2)]})]},s.inventoryItem.id))})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"3"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-success-green)"},children:"receipt_long"}),"Upload Receipt & Finalize"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-light)"},children:"Upload Receipt PDF (Required)"}),e.jsxs("div",{className:"border-2 border-dashed border-[var(--md-sys-color-outline-variant)] rounded-lg p-6 text-center hover:border-[var(--color-primary-blue)] transition-colors",children:[e.jsx("input",{type:"file",accept:".pdf",onChange:ge,className:"hidden",id:"pdf-upload"}),e.jsxs("label",{htmlFor:"pdf-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"material-icons text-4xl",style:{color:"var(--color-text-muted)"},children:"upload_file"}),e.jsx("p",{className:"mt-2 text-sm",style:{color:"var(--color-text-light)"},children:"Click to upload PDF receipt or drag and drop"}),H&&e.jsxs("p",{className:"mt-2 text-sm font-medium",style:{color:"var(--color-success-green)"},children:["Selected: ",H.name]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(fe,{type:"number",label:"Tax Amount",value:Z,onChange:s=>se(s.target.value),step:"0.01",min:"0",placeholder:"0.00"}),e.jsx(fe,{type:"number",label:"Fees (Shipping/Handling)",value:ee,onChange:s=>oe(s.target.value),step:"0.01",min:"0",placeholder:"0.00"})]}),y.length>0&&e.jsxs("div",{className:"mt-6 p-4 rounded-lg",style:{background:"var(--md-sys-color-surface-container-highest)",border:"2px solid var(--color-primary-blue)"},children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"calculate"}),"Cost Summary"]}),e.jsx("div",{className:"space-y-2",children:(()=>{const s=y.reduce((i,d)=>i+d.confirmedQuantity*d.confirmedPrice,0),a=parseFloat(Z)||0,n=parseFloat(ee)||0,c=s+a+n;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Subtotal:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",s.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Tax:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",a.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Fees:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",n.toFixed(2)]})]}),e.jsx("div",{className:"pt-2 mt-2 border-t border-[var(--md-sys-color-outline-variant)]",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-bold",style:{color:"var(--color-text-light)"},children:"Total:"}),e.jsxs("span",{className:"font-bold text-xl",style:{color:"var(--color-success-green)"},children:["$",c.toFixed(2)]})]})})]})})()})]}),e.jsx(he,{color:"success",className:"w-full mt-6",disabled:U||!H||y.length===0,onClick:je,children:U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons mr-2",children:"receipt_long"}),"Process Receipt (",y.length," items)"]})})]}),J&&e.jsx("div",{className:`mat-card p-4 ${J.includes("✅")?"success-box":J.includes("⏳")?"info-box":"error-box"}`,children:J}),S&&e.jsx("div",{className:"mat-card p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center mb-2",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-warning-orange)"},children:"undo"}),"Undo Last Processing"]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:["Last processed: ",S.itemsProcessed," items • Total: $",S.totalAmount.toFixed(2)]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-muted)"},children:new Date(S.timestamp).toLocaleString()})]}),e.jsxs(he,{variant:"outlined",color:"error",onClick:be,className:"ml-4",children:[e.jsx("span",{className:"material-icons mr-2",children:"undo"}),"Undo Transaction"]})]})}),ae.length>0&&e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"history"}),"Recent Shipment Processing"]}),e.jsx("div",{className:"space-y-3",children:ae.slice(-5).reverse().map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg",style:{background:"var(--md-sys-color-surface-container-high)"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"material-icons",style:{color:"var(--color-success-green)"},children:"check_circle"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:"var(--color-text-light)"},children:[s.itemsProcessed," items processed"]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:["Total: $",s.totalAmount.toFixed(2)]})]})]}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:new Date(s.timestamp).toLocaleDateString()})]},a))})]})]})};export{qe as default};
