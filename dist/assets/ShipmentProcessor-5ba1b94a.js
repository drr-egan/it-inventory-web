var Pe=Object.defineProperty,Ie=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var xe=(j,g,x)=>g in j?Pe(j,g,{enumerable:!0,configurable:!0,writable:!0,value:x}):j[g]=x,_=(j,g)=>{for(var x in g||(g={}))$e.call(g,x)&&xe(j,x,g[x]);if(me)for(var x of me(g))ke.call(g,x)&&xe(j,x,g[x]);return j},J=(j,g)=>Ie(j,Ce(g));var K=(j,g,x)=>new Promise((A,E)=>{var S=w=>{try{y(x.next(w))}catch(L){E(L)}},W=w=>{try{y(x.throw(w))}catch(L){E(L)}},y=w=>w.done?A(w.value):Promise.resolve(w.value).then(S,W);y((x=x.apply(j,g)).next())});import{j as e,d as I}from"./index-9754a927.js";import{r as k}from"./react-vendor-3371026b.js";import{w as ue,h as q,l as Se,d as ye,T as he}from"./firebase-vendor-7a1907cd.js";import{M as fe}from"./MaterialButton-e429d430.js";import{M as pe}from"./MaterialInput-4f1a2629.js";const qe=({items:j,checkoutHistory:g,user:x})=>{const[A,E]=k.useState([]),[S,W]=k.useState(""),[y,w]=k.useState([]),[L,V]=k.useState(!1),[Z,se]=k.useState(""),[ee,oe]=k.useState(""),[H,re]=k.useState(null),[Y,F]=k.useState(""),[ae,ce]=k.useState([]),[z,ne]=k.useState(null),ie=s=>{A.findIndex(c=>c.id===s.id)>=0?(E(c=>c.filter(n=>n.id!==s.id)),w(c=>c.filter(n=>n.inventoryItem.id!==s.id))):(E(c=>[...c,s]),ve(s))},ve=s=>{const r=g.filter(c=>{var n,l,d,u;return((n=c.itemName)==null?void 0:n.toLowerCase())===((l=s.name)==null?void 0:l.toLowerCase())||((d=c.item)==null?void 0:d.toLowerCase())===((u=s.name)==null?void 0:u.toLowerCase())});if(r.length>0){const c={inventoryItem:s,checkoutRecords:r,confirmedQuantity:r.reduce((n,l)=>n+(l.quantity||1),0),confirmedPrice:s.price||0};w(n=>[...n,c])}else{const c={inventoryItem:s,checkoutRecords:[],confirmedQuantity:1,confirmedPrice:s.price||0};w(n=>[...n,c])}},le=(s,r,c)=>{w(n=>n.map(l=>l.inventoryItem.id===s?J(_({},l),{[r]:parseFloat(c)||0}):l))},ge=s=>{const r=s.target.files[0];r&&r.type==="application/pdf"?re(r):alert("Please select a valid PDF file.")},be=()=>K(void 0,null,function*(){if(!z){alert("No transaction to undo");return}const s=`This will undo the last processing of ${z.itemsProcessed} items.

This will:
• Restore checkout records from archive
• Revert inventory quantity changes
• Remove cost allocation records

Continue?`;if(confirm(s))try{F("⏳ Undoing last transaction...");const r=ue(I);for(const d of z.checkoutRecords){if(d.id.startsWith("synthetic-"))continue;const u=q(I,"checkoutHistory",d.id),v=_({},d);delete v.id,delete v.inventoryItem,delete v.confirmedPrice,r.set(u,v);const N=q(I,"archivedCheckouts",d.id);r.delete(N)}for(const d of z.inventoryUpdates){const u=j.find(v=>v.id===d.itemId);if(u){const v=q(I,"items",d.itemId),N=Math.max(0,u.quantity-d.quantityAdded);r.update(v,{quantity:N})}}const c=yield Se(ye(I,"costAllocation")),n=new Date(z.timestamp).getTime(),l=5e3;c.docs.forEach(d=>{var N,M,U;const v=(U=(M=(N=d.data().processedAt)==null?void 0:N.toDate)==null?void 0:M.call(N))==null?void 0:U.getTime();v&&Math.abs(v-n)<l&&r.delete(q(I,"costAllocation",d.id))}),yield r.commit(),ne(null),ce(d=>d.slice(0,-1)),F("✅ Transaction successfully undone. Checkout records restored and inventory reverted.")}catch(r){console.error("Error undoing transaction:",r),F(`❌ Error undoing transaction: ${r.message}`)}}),je=()=>K(void 0,null,function*(){if(!H){F("❌ Please upload a receipt PDF first");return}if(y.length===0){F("❌ Please select at least one item from inventory");return}console.log("=== SHIPMENT PROCESSING DEBUG ==="),console.log("Matched checkouts:",y.length),y.forEach((n,l)=>{console.log(`Item ${l+1}: ${n.inventoryItem.name}`),console.log(`  - Confirmed Quantity: ${n.confirmedQuantity}`),console.log(`  - Confirmed Price: $${n.confirmedPrice}`),console.log(`  - Checkout Records: ${n.checkoutRecords.length}`)});const s=y.reduce((n,l)=>n+l.confirmedQuantity,0);console.log(`Total Expected Items: ${s}`),console.log("=================================");const r=y.map(n=>`  • ${n.inventoryItem.name}: ${n.confirmedQuantity} items @ $${n.confirmedPrice.toFixed(2)}`).join(`
`),c=`You are about to process ${y.length} item type(s) with a total of ${s} items:

${r}

Do you want to proceed?`;if(!confirm(c)){F("❌ Processing cancelled by user");return}V(!0),F("⏳ Processing receipt and generating cost allocation...");try{const n=parseFloat(Z)||0,l=parseFloat(ee)||0,d=y.flatMap(a=>{const t=a.confirmedQuantity,T=[...a.checkoutRecords].sort((f,i)=>{var B,G,Q,X;const P=((G=(B=f.dateEntered)==null?void 0:B.toDate)==null?void 0:G.call(B))||f.dateEntered||new Date(0),te=((X=(Q=i.dateEntered)==null?void 0:Q.toDate)==null?void 0:X.call(Q))||i.dateEntered||new Date(0);return P-te}),b=[];let p=0;for(const f of T){if(p>=t)break;const i=f.quantity||1,P=t-p;P<i?(b.push(J(_({},f),{quantity:P})),p+=P):(b.push(f),p+=i)}const $=t-p,R=[];if($>0)for(let f=0;f<$;f++)R.push({id:`synthetic-${a.inventoryItem.id}-${Date.now()}-${f}`,itemName:a.inventoryItem.name,userName:"IT Stock",quantity:1,departmentId:"1-20-000-5770",dateEntered:new Date,inventoryItem:a.inventoryItem,confirmedPrice:a.confirmedPrice});return[...b.map(f=>J(_({},f),{inventoryItem:a.inventoryItem,confirmedPrice:a.confirmedPrice})),...R]}),u=d.reduce((a,t)=>a+(t.quantity||1),0);console.log("=== ALLOCATION RESULT ==="),console.log(`Total checkout records allocated: ${d.length}`),console.log(`Total item quantity: ${u}`),u!==s?console.warn(`⚠️ MISMATCH: Expected ${s} items but allocated ${u}!`):console.log("✓ Quantities match!"),console.log("========================");const v=u>0?n/u:0,N=u>0?l/u:0,M=d.reduce((a,t)=>{const T=t.departmentId||t.costCode||"IT Stock 1-20-000-5770",p=`${t.inventoryItem.name}|${T}`;return a[p]||(a[p]=[]),a[p].push(t),a},{}),U=Object.entries(M).map(([a,t])=>{const[T,b]=a.split("|"),p=t.reduce((f,i)=>f+(i.quantity||1),0),$=t[0].confirmedPrice,R=v*p,D=N*p;return{itemName:T,quantity:p,unitPrice:$,totalCost:$*p+R+D,taxAllocation:R,feeAllocation:D,costCode:b}}),C=U.reduce((a,t)=>a+t.unitPrice*t.quantity,0),o=C+n+l;yield Ne(U,{subtotal:C,tax:n,fees:l,total:o,taxPerItem:v,feePerItem:N},H,d);const h=ue(I);for(const a of d){const t=a.departmentId||a.costCode||"IT Stock 1-20-000-5770",T=a.quantity||1,b=a.confirmedPrice,p=v*T,$=N*T,R=q(ye(I,"costAllocation"));if(h.set(R,{itemId:a.inventoryItem.id,itemName:a.inventoryItem.name,quantity:T,unitPrice:b,totalCost:b*T+p+$,taxAllocation:p,feeAllocation:$,costCode:t,userName:a.userName||a.user||"Unknown",processedAt:he.now(),processedBy:(x==null?void 0:x.employeeID)||(x==null?void 0:x.email)||"Unknown",type:t.includes("Job")?"job":"it_stock"}),!a.id.startsWith("synthetic-")){const D=J(_({},a),{archivedAt:he.now(),archivedBy:(x==null?void 0:x.employeeID)||(x==null?void 0:x.email)||"Unknown",archiveReason:"Processed receipt"});delete D.id;const f=q(I,"archivedCheckouts",a.id);h.set(f,D);const i=q(I,"checkoutHistory",a.id);h.delete(i)}}for(const a of y){const t=q(I,"items",a.inventoryItem.id),b=(a.inventoryItem.quantity||0)+a.confirmedQuantity;h.update(t,{quantity:b})}yield h.commit();const m={timestamp:new Date().toISOString(),itemsProcessed:d.length,totalAmount:o,checkoutRecords:d,inventoryUpdates:y.map(a=>({itemId:a.inventoryItem.id,quantityAdded:a.confirmedQuantity}))};ne(m);const de={timestamp:new Date().toISOString(),itemsProcessed:d.length,totalAmount:o};ce(a=>[...a,de]),E([]),w([]),se(""),oe(""),re(null),F(`✅ Shipment processed successfully! ${u} items from ${y.length} product type(s) included in report. PDF downloaded and items archived.`),V(!1)}catch(n){console.error("Error processing shipment:",n),F(`❌ Error: ${n.message}`),V(!1)}}),Ne=(s,r,c,n)=>K(void 0,null,function*(){try{const l=window.PDFLib,{PDFDocument:d,rgb:u,StandardFonts:v}=l,N=r.taxPerItem||0,M=r.feePerItem||0,U=yield c.arrayBuffer(),C=yield d.load(U);let o=C.addPage([612,792]);const h=yield C.embedFont(v.Helvetica),m=yield C.embedFont(v.HelveticaBold),{width:de,height:a}=o.getSize();let t=a-50;if(o.drawText("Shipment Cost Allocation Report",{x:50,y:t,size:16,font:m,color:u(0,0,0)}),t-=30,r.tax>0||r.fees>0){const i=`Tax ($${r.tax.toFixed(2)}) and Fees ($${r.fees.toFixed(2)}) distributed evenly per item`;o.drawText(i,{x:50,y:t,size:10,font:h,color:u(0,0,0)}),t-=30}o.drawText("Cost Allocation Summary",{x:50,y:t,size:14,font:m,color:u(0,0,0)}),t-=25,o.drawText("Item Description",{x:50,y:t,size:9,font:m}),o.drawText("Qty",{x:280,y:t,size:9,font:m}),o.drawText("Job/Cost Code",{x:320,y:t,size:9,font:m}),o.drawText("Unit Price",{x:440,y:t,size:9,font:m}),o.drawText("Total Cost",{x:510,y:t,size:9,font:m}),t-=15;for(const i of s){t<150&&(o=C.addPage([612,792]),t=a-50,o.drawText("Item Description",{x:50,y:t,size:9,font:m}),o.drawText("Qty",{x:280,y:t,size:9,font:m}),o.drawText("Job/Cost Code",{x:320,y:t,size:9,font:m}),o.drawText("Unit Price",{x:440,y:t,size:9,font:m}),o.drawText("Total Cost",{x:510,y:t,size:9,font:m}),t-=15);const P=i.itemName.length>45?i.itemName.substring(0,45)+"...":i.itemName;o.drawText(P,{x:50,y:t,size:9,font:h}),o.drawText(String(i.quantity),{x:280,y:t,size:9,font:h}),o.drawText(i.costCode||"-",{x:320,y:t,size:9,font:h}),o.drawText(`$${i.unitPrice.toFixed(2)}`,{x:440,y:t,size:9,font:h}),o.drawText(`$${i.totalCost.toFixed(2)}`,{x:510,y:t,size:9,font:h}),t-=15}t-=10;const T=s.reduce((i,P)=>i+P.quantity,0);o.drawText(`Total Items: ${T}`,{x:50,y:t,size:9,font:m}),t-=20;const b=420;o.drawText(`Subtotal (Items): $${r.subtotal.toFixed(2)}`,{x:b,y:t,size:9,font:h}),t-=12,o.drawText(`Tax: $${r.tax.toFixed(2)}`,{x:b,y:t,size:9,font:h}),t-=12,o.drawText(`Fees: $${r.fees.toFixed(2)}`,{x:b,y:t,size:9,font:h}),t-=15,o.drawText(`Grand Total: $${r.total.toFixed(2)}`,{x:b,y:t,size:10,font:m}),t-=30,t<150&&(o=C.addPage([612,792]),t=a-50),o.drawText("Individual Checkout Details",{x:50,y:t,size:14,font:m,color:u(0,0,0)}),t-=25,o.drawText("Item Description",{x:50,y:t,size:9,font:m}),o.drawText("User",{x:210,y:t,size:9,font:m}),o.drawText("Qty",{x:330,y:t,size:9,font:m}),o.drawText("Cost Code",{x:360,y:t,size:9,font:m}),o.drawText("Unit Price",{x:460,y:t,size:9,font:m}),o.drawText("Total Cost",{x:520,y:t,size:9,font:m}),t-=15;for(const i of n){t<100&&(o=C.addPage([612,792]),t=a-50,o.drawText("Item Description",{x:50,y:t,size:9,font:m}),o.drawText("User",{x:210,y:t,size:9,font:m}),o.drawText("Qty",{x:330,y:t,size:9,font:m}),o.drawText("Cost Code",{x:360,y:t,size:9,font:m}),o.drawText("Unit Price",{x:460,y:t,size:9,font:m}),o.drawText("Total Cost",{x:520,y:t,size:9,font:m}),t-=15);const P=i.inventoryItem.name.length>30?i.inventoryItem.name.substring(0,30)+"...":i.inventoryItem.name,te=(i.userName||i.user||"N/A").length>20?(i.userName||i.user||"N/A").substring(0,20)+"...":i.userName||i.user||"N/A",B=i.departmentId||i.costCode||"IT Stock 1-20-000-5770",G=i.confirmedPrice,Q=i.quantity||1,X=N*Q,we=M*Q,Te=G*Q+X+we;o.drawText(P,{x:50,y:t,size:9,font:h}),o.drawText(te,{x:210,y:t,size:9,font:h}),o.drawText(String(Q),{x:330,y:t,size:9,font:h}),o.drawText(B,{x:360,y:t,size:9,font:h}),o.drawText(`$${G.toFixed(2)}`,{x:460,y:t,size:9,font:h}),o.drawText(`$${Te.toFixed(2)}`,{x:520,y:t,size:9,font:h}),t-=15}t-=5;const p=n.reduce((i,P)=>i+(P.quantity||1),0);o.drawText(`Total Items: ${p}`,{x:50,y:t,size:9,font:m});const $=yield C.save(),R=new Blob([$],{type:"application/pdf"}),D=URL.createObjectURL(R),f=document.createElement("a");f.href=D,f.download=c.name,f.click(),URL.revokeObjectURL(D)}catch(l){throw console.error("Error generating PDF report:",l),l}}),O=j.filter(s=>{var c,n,l;if(!S)return!0;const r=S.toLowerCase();return((c=s.name)==null?void 0:c.toLowerCase().includes(r))||((n=s.category)==null?void 0:n.toLowerCase().includes(r))||((l=s.asin)==null?void 0:l.toLowerCase().includes(r))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center mb-4",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",children:"receipt_long"}),"Process Shipment Receipt"]}),e.jsx("p",{style:{color:"var(--color-text-muted)"},children:"Follow the 3-step workflow: Select inventory items, confirm quantities & prices, then upload receipt and process with automatic cost allocation."})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"1"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"inventory_2"}),"Search & Add Items (",A.length," selected)"]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by item name, category, or ASIN...",value:S,onChange:s=>W(s.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-[var(--md-sys-color-outline-variant)] focus:border-[var(--color-primary-blue)] transition-colors",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}}),e.jsx("span",{className:"material-icons absolute right-3 top-3",style:{color:"var(--color-text-muted)"},children:"search"})]})}),S&&O.length>0&&e.jsxs("div",{className:"mb-4 border border-[var(--md-sys-color-outline-variant)] rounded-lg overflow-hidden",style:{maxHeight:"300px",overflowY:"auto",background:"var(--md-sys-color-surface)"},children:[O.slice(0,10).map(s=>{const r=A.some(c=>c.id===s.id);return e.jsx("div",{className:`p-3 border-b border-[var(--md-sys-color-outline-variant)] cursor-pointer hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors ${r?"opacity-50":""}`,onClick:()=>{r||(ie(s),W(""))},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",style:{color:"var(--color-text-light)"},children:[s.name,r&&e.jsx("span",{className:"ml-2 text-xs",style:{color:"var(--color-success-green)"},children:"✓ Added"})]}),e.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-text-muted)"},children:[s.category||"Uncategorized"," • Qty: ",s.quantity||0,s.asin&&` • ${s.asin}`]})]}),e.jsxs("div",{className:"ml-4 text-right",children:[s.price>0&&e.jsxs("div",{className:"font-medium",style:{color:"var(--color-success-green)"},children:["$",s.price.toFixed(2)]}),!r&&e.jsx("span",{className:"material-icons text-sm",style:{color:"var(--color-primary-blue)"},children:"add_circle"})]})]})},s.id)}),O.length>10&&e.jsxs("div",{className:"text-center py-2 text-xs",style:{color:"var(--color-text-muted)",background:"var(--md-sys-color-surface-container-high)"},children:["Showing 10 of ",O.length," results - refine search to see more"]})]}),S&&O.length===0&&e.jsxs("div",{className:"mb-4 p-4 text-center rounded-lg",style:{background:"var(--md-sys-color-surface-container-high)",color:"var(--color-text-muted)"},children:['No items found matching "',S,'"']}),A.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",style:{color:"var(--color-text-light)"},children:"Selected Items"}),e.jsx("div",{className:"space-y-2",children:A.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface-container-high)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-text-light)"},children:s.name}),e.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-text-muted)"},children:[s.category||"Uncategorized"," • Stock: ",s.quantity||0,s.price>0&&` • $${s.price.toFixed(2)}`]})]}),e.jsx("button",{onClick:()=>ie(s),className:"ml-4 p-2 rounded-full hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors",title:"Remove item",children:e.jsx("span",{className:"material-icons text-sm",style:{color:"var(--color-error-red)"},children:"close"})})]},s.id))})]}),A.length===0&&!S&&e.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-muted)"},children:[e.jsx("span",{className:"material-icons text-4xl mb-2",style:{color:"var(--color-text-muted)",opacity:.5},children:"search"}),e.jsx("p",{children:"Search for items to add to this shipment"})]})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"2"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"link"}),"Confirm Quantities & Prices (",y.length," items)"]}),y.length>0?e.jsx("div",{className:"space-y-4",children:y.map((s,r)=>e.jsxs("div",{className:"border border-[var(--md-sys-color-outline-variant)] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium",style:{color:"var(--color-text-light)"},children:s.inventoryItem.name}),e.jsxs("span",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:[s.checkoutRecords.length," checkout",s.checkoutRecords.length!==1?"s":""," matched"]})]}),s.checkoutRecords.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-light)"},children:"Checkout Details:"}),e.jsx("div",{className:"space-y-1",children:s.checkoutRecords.map((c,n)=>{var l,d;return e.jsxs("div",{className:"text-xs p-2 rounded",style:{background:"var(--md-sys-color-surface-container-high)",color:"var(--color-text-muted)"},children:[c.userName||c.user," • Qty: ",c.quantity," • Dept: ",c.departmentId||c.costCode," • ",new Date(((d=(l=c.dateEntered)==null?void 0:l.toDate)==null?void 0:d.call(l))||c.dateEntered||c.date).toLocaleDateString()]},c.id)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--color-text-light)"},children:"Received Quantity"}),e.jsx("input",{type:"number",min:"1",value:s.confirmedQuantity,onChange:c=>le(s.inventoryItem.id,"confirmedQuantity",c.target.value),className:"w-full px-3 py-2 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--color-text-light)"},children:"Unit Price"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:s.confirmedPrice,onChange:c=>le(s.inventoryItem.id,"confirmedPrice",c.target.value),className:"w-full px-3 py-2 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}})]})]}),e.jsxs("div",{className:"mt-3 text-sm",style:{color:"var(--color-text-muted)"},children:["Total: $",(s.confirmedQuantity*s.confirmedPrice).toFixed(2)]})]},s.inventoryItem.id))}):e.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-muted)"},children:[e.jsx("span",{className:"material-icons text-4xl mb-2",style:{color:"var(--color-text-muted)",opacity:.5},children:"fact_check"}),e.jsx("p",{children:"Add items in Step 1 to confirm their quantities and prices"})]})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"3"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-success-green)"},children:"receipt_long"}),"Upload Receipt & Finalize"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-light)"},children:"Upload Receipt PDF (Required)"}),e.jsxs("div",{className:"border-2 border-dashed border-[var(--md-sys-color-outline-variant)] rounded-lg p-6 text-center hover:border-[var(--color-primary-blue)] transition-colors",children:[e.jsx("input",{type:"file",accept:".pdf",onChange:ge,className:"hidden",id:"pdf-upload"}),e.jsxs("label",{htmlFor:"pdf-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"material-icons text-4xl",style:{color:"var(--color-text-muted)"},children:"upload_file"}),e.jsx("p",{className:"mt-2 text-sm",style:{color:"var(--color-text-light)"},children:"Click to upload PDF receipt or drag and drop"}),H&&e.jsxs("p",{className:"mt-2 text-sm font-medium",style:{color:"var(--color-success-green)"},children:["Selected: ",H.name]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(pe,{type:"number",label:"Tax Amount",value:Z,onChange:s=>se(s.target.value),step:"0.01",min:"0",placeholder:"0.00"}),e.jsx(pe,{type:"number",label:"Fees (Shipping/Handling)",value:ee,onChange:s=>oe(s.target.value),step:"0.01",min:"0",placeholder:"0.00"})]}),y.length>0&&e.jsxs("div",{className:"mt-6 p-4 rounded-lg",style:{background:"var(--md-sys-color-surface-container-highest)",border:"2px solid var(--color-primary-blue)"},children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"calculate"}),"Cost Summary"]}),e.jsx("div",{className:"space-y-2",children:(()=>{const s=y.reduce((l,d)=>l+d.confirmedQuantity*d.confirmedPrice,0),r=parseFloat(Z)||0,c=parseFloat(ee)||0,n=s+r+c;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Subtotal:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",s.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Tax:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",r.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Fees:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",c.toFixed(2)]})]}),e.jsx("div",{className:"pt-2 mt-2 border-t border-[var(--md-sys-color-outline-variant)]",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-bold",style:{color:"var(--color-text-light)"},children:"Total:"}),e.jsxs("span",{className:"font-bold text-xl",style:{color:"var(--color-success-green)"},children:["$",n.toFixed(2)]})]})})]})})()})]}),e.jsx(fe,{color:"success",className:"w-full mt-6",disabled:L||!H||y.length===0,onClick:je,children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons mr-2",children:"receipt_long"}),"Process Receipt (",y.length," items)"]})})]}),Y&&e.jsx("div",{className:`mat-card p-4 ${Y.includes("✅")?"success-box":Y.includes("⏳")?"info-box":"error-box"}`,children:Y}),z&&e.jsx("div",{className:"mat-card p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center mb-2",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-warning-orange)"},children:"undo"}),"Undo Last Processing"]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:["Last processed: ",z.itemsProcessed," items • Total: $",z.totalAmount.toFixed(2)]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-muted)"},children:new Date(z.timestamp).toLocaleString()})]}),e.jsxs(fe,{variant:"outlined",color:"error",onClick:be,className:"ml-4",children:[e.jsx("span",{className:"material-icons mr-2",children:"undo"}),"Undo Transaction"]})]})}),ae.length>0&&e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"history"}),"Recent Shipment Processing"]}),e.jsx("div",{className:"space-y-3",children:ae.slice(-5).reverse().map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg",style:{background:"var(--md-sys-color-surface-container-high)"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"material-icons",style:{color:"var(--color-success-green)"},children:"check_circle"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:"var(--color-text-light)"},children:[s.itemsProcessed," items processed"]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:["Total: $",s.totalAmount.toFixed(2)]})]})]}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:new Date(s.timestamp).toLocaleDateString()})]},r))})]})]})};export{qe as default};
