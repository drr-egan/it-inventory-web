var $e=Object.defineProperty,ke=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ye=(w,N,m)=>N in w?$e(w,N,{enumerable:!0,configurable:!0,writable:!0,value:m}):w[N]=m,H=(w,N)=>{for(var m in N||(N={}))Fe.call(N,m)&&ye(w,m,N[m]);if(he)for(var m of he(N))De.call(N,m)&&ye(w,m,N[m]);return w},Y=(w,N)=>ke(w,Se(N));var V=(w,N,m)=>new Promise((Q,E)=>{var F=P=>{try{y(m.next(P))}catch(L){E(L)}},X=P=>{try{y(m.throw(P))}catch(L){E(L)}},y=P=>P.done?Q(P.value):Promise.resolve(P.value).then(F,X);y((m=m.apply(w,N)).next())});import{j as e,d as k}from"./index-c6e7d7ac.js";import{r as S}from"./react-vendor-3371026b.js";import{w as fe,h as A,l as ze,d as pe,T as ve}from"./firebase-vendor-7a1907cd.js";import{M as ge}from"./MaterialButton-ce673a4b.js";import{M as re}from"./MaterialInput-879792e7.js";const Le=({items:w,checkoutHistory:N,user:m})=>{const[Q,E]=S.useState([]),[F,X]=S.useState(""),[y,P]=S.useState([]),[L,Z]=S.useState(!1),[ee,ae]=S.useState(""),[te,ce]=S.useState(""),[se,ne]=S.useState(""),[O,ie]=S.useState(null),[K,D]=S.useState(""),[le,de]=S.useState([]),[z,me]=S.useState(null),xe=t=>{Q.findIndex(n=>n.id===t.id)>=0?(E(n=>n.filter(c=>c.id!==t.id)),P(n=>n.filter(c=>c.inventoryItem.id!==t.id))):(E(n=>[...n,t]),be(t))},be=t=>{const o=N.filter(n=>{var c,l,x,u;return((c=n.itemName)==null?void 0:c.toLowerCase())===((l=t.name)==null?void 0:l.toLowerCase())||((x=n.item)==null?void 0:x.toLowerCase())===((u=t.name)==null?void 0:u.toLowerCase())});if(o.length>0){const n={inventoryItem:t,checkoutRecords:o,confirmedQuantity:o.reduce((c,l)=>c+(l.quantity||1),0),confirmedPrice:t.price||0};P(c=>[...c,n])}else{const n={inventoryItem:t,checkoutRecords:[],confirmedQuantity:1,confirmedPrice:t.price||0};P(c=>[...c,n])}},ue=(t,o,n)=>{P(c=>c.map(l=>l.inventoryItem.id===t?Y(H({},l),{[o]:parseFloat(n)||0}):l))},je=t=>{const o=t.target.files[0];o&&o.type==="application/pdf"?ie(o):alert("Please select a valid PDF file.")},Ne=()=>V(void 0,null,function*(){if(!z){alert("No transaction to undo");return}const t=`This will undo the last processing of ${z.itemsProcessed} items.

This will:
• Restore checkout records from archive
• Revert inventory quantity changes
• Remove cost allocation records

Continue?`;if(confirm(t))try{D("⏳ Undoing last transaction...");const o=fe(k);for(const x of z.checkoutRecords){if(x.id.startsWith("synthetic-"))continue;const u=A(k,"checkoutHistory",x.id),p=H({},x);delete p.id,delete p.inventoryItem,delete p.confirmedPrice,o.set(u,p);const C=A(k,"archivedCheckouts",x.id);o.delete(C)}for(const x of z.inventoryUpdates){const u=w.find(p=>p.id===x.itemId);if(u){const p=A(k,"items",x.itemId),C=Math.max(0,u.quantity-x.quantityAdded);o.update(p,{quantity:C})}}const n=yield ze(pe(k,"costAllocation")),c=new Date(z.timestamp).getTime(),l=5e3;n.docs.forEach(x=>{var C,v,r;const p=(r=(v=(C=x.data().processedAt)==null?void 0:C.toDate)==null?void 0:v.call(C))==null?void 0:r.getTime();p&&Math.abs(p-c)<l&&o.delete(A(k,"costAllocation",x.id))}),yield o.commit(),me(null),de(x=>x.slice(0,-1)),D("✅ Transaction successfully undone. Checkout records restored and inventory reverted.")}catch(o){console.error("Error undoing transaction:",o),D(`❌ Error undoing transaction: ${o.message}`)}}),we=()=>V(void 0,null,function*(){if(!O){D("❌ Please upload a receipt PDF first");return}if(y.length===0){D("❌ Please select at least one item from inventory");return}console.log("=== SHIPMENT PROCESSING DEBUG ==="),console.log("Matched checkouts:",y.length),y.forEach((c,l)=>{console.log(`Item ${l+1}: ${c.inventoryItem.name}`),console.log(`  - Confirmed Quantity: ${c.confirmedQuantity}`),console.log(`  - Confirmed Price: $${c.confirmedPrice}`),console.log(`  - Checkout Records: ${c.checkoutRecords.length}`)});const t=y.reduce((c,l)=>c+l.confirmedQuantity,0);console.log(`Total Expected Items: ${t}`),console.log("=================================");const o=y.map(c=>`  • ${c.inventoryItem.name}: ${c.confirmedQuantity} items @ $${c.confirmedPrice.toFixed(2)}`).join(`
`),n=`You are about to process ${y.length} item type(s) with a total of ${t} items:

${o}

Do you want to proceed?`;if(!confirm(n)){D("❌ Processing cancelled by user");return}Z(!0),D("⏳ Processing receipt and generating cost allocation...");try{const c=parseFloat(ee)||0,l=parseFloat(te)||0,x=parseFloat(se)||0,u=y.flatMap(a=>{const h=a.confirmedQuantity,T=[...a.checkoutRecords].sort((f,i)=>{var _,G,U,J;const j=((G=(_=f.dateEntered)==null?void 0:_.toDate)==null?void 0:G.call(_))||f.dateEntered||new Date(0),oe=((J=(U=i.dateEntered)==null?void 0:U.toDate)==null?void 0:J.call(U))||i.dateEntered||new Date(0);return j-oe}),I=[];let b=0;for(const f of T){if(b>=h)break;const i=f.quantity||1,j=h-b;j<i?(I.push(Y(H({},f),{quantity:j})),b+=j):(I.push(f),b+=i)}const R=h-b,$=[];if(R>0)for(let f=0;f<R;f++)$.push({id:`synthetic-${a.inventoryItem.id}-${Date.now()}-${f}`,itemName:a.inventoryItem.name,userName:"IT Stock",quantity:1,departmentId:"1-20-000-5770",dateEntered:new Date,inventoryItem:a.inventoryItem,confirmedPrice:a.confirmedPrice});return[...I.map(f=>Y(H({},f),{inventoryItem:a.inventoryItem,confirmedPrice:a.confirmedPrice})),...$]}),p=u.reduce((a,h)=>a+(h.quantity||1),0);console.log("=== ALLOCATION RESULT ==="),console.log(`Total checkout records allocated: ${u.length}`),console.log(`Total item quantity: ${p}`),p!==t?console.warn(`⚠️ MISMATCH: Expected ${t} items but allocated ${p}!`):console.log("✓ Quantities match!"),console.log("========================");const C=y.filter(a=>!a.confirmedPrice||a.confirmedPrice<=0);if(C.length>0){const a=C.map(h=>h.inventoryItem.name).join(", ");throw new Error(`Cannot process shipment: The following items are missing prices: ${a}. Please add prices to all items before processing.`)}const v=y.reduce((a,h)=>a+h.confirmedQuantity*h.confirmedPrice,0),r=u.reduce((a,h)=>{const T=h.departmentId||h.costCode||"IT Stock 1-20-000-5770",b=`${h.inventoryItem.name}|${T}`;return a[b]||(a[b]=[]),a[b].push(h),a},{}),g=Object.entries(r).map(([a,h])=>{const[T,I]=a.split("|"),b=h.reduce((i,j)=>i+(j.quantity||1),0),R=h[0].confirmedPrice,$=R*b,q=v>0?$/v:0,f=c*q;return{itemName:T,quantity:b,unitPrice:R,itemSubtotal:$,totalCost:$+f,taxAllocation:f,costCode:I}}),d=v+c+l-x;yield Te(g,{subtotal:v,tax:c,fees:l,discount:x,total:d},O,u);const M=fe(k);for(const a of u){const h=a.departmentId||a.costCode||"IT Stock 1-20-000-5770",T=a.quantity||1,I=a.confirmedPrice,b=I*T,R=v>0?b/v:0,$=c*R,q=A(pe(k,"costAllocation"));if(M.set(q,{itemId:a.inventoryItem.id,itemName:a.inventoryItem.name,quantity:T,unitPrice:I,totalCost:b+$,taxAllocation:$,costCode:h,userName:a.userName||a.user||"Unknown",processedAt:ve.now(),processedBy:(m==null?void 0:m.employeeID)||(m==null?void 0:m.email)||"Unknown",type:h.includes("Job")?"job":"it_stock"}),!a.id.startsWith("synthetic-")){const f=Y(H({},a),{archivedAt:ve.now(),archivedBy:(m==null?void 0:m.employeeID)||(m==null?void 0:m.email)||"Unknown",archiveReason:"Processed receipt"});delete f.id;const i=A(k,"archivedCheckouts",a.id);M.set(i,f);const j=A(k,"checkoutHistory",a.id);M.delete(j)}}for(const a of y){const h=A(k,"items",a.inventoryItem.id),I=(a.inventoryItem.quantity||0)+a.confirmedQuantity;M.update(h,{quantity:I})}yield M.commit();const B={timestamp:new Date().toISOString(),itemsProcessed:u.length,totalAmount:d,checkoutRecords:u,inventoryUpdates:y.map(a=>({itemId:a.inventoryItem.id,quantityAdded:a.confirmedQuantity}))};me(B);const s={timestamp:new Date().toISOString(),itemsProcessed:u.length,totalAmount:d};de(a=>[...a,s]),E([]),P([]),ae(""),ce(""),ne(""),ie(null),D(`✅ Shipment processed successfully! ${p} items from ${y.length} product type(s) included in report. PDF downloaded and items archived.`),Z(!1)}catch(c){console.error("Error processing shipment:",c),D(`❌ Error: ${c.message}`),Z(!1)}}),Te=(t,o,n,c)=>V(void 0,null,function*(){try{const l=window.PDFLib,{PDFDocument:x,rgb:u,StandardFonts:p}=l,C=yield n.arrayBuffer(),v=yield x.load(C);let r=v.addPage([612,792]);const g=yield v.embedFont(p.Helvetica),d=yield v.embedFont(p.HelveticaBold),{width:M,height:B}=r.getSize();let s=B-50;r.drawText("Shipment Cost Allocation Report",{x:50,y:s,size:16,font:d,color:u(0,0,0)}),s-=30;const a=[];if(o.tax>0&&a.push(`Tax ($${o.tax.toFixed(2)}) distributed proportionally based on item value`),o.fees>0&&a.push(`Fees: $${o.fees.toFixed(2)}`),o.discount>0&&a.push(`Discount: $${o.discount.toFixed(2)}`),a.length>0){const i=a.join(". ");r.drawText(i,{x:50,y:s,size:10,font:g,color:u(0,0,0)}),s-=30}r.drawText("Cost Allocation Summary",{x:50,y:s,size:14,font:d,color:u(0,0,0)}),s-=25,r.drawText("Item Description",{x:50,y:s,size:9,font:d}),r.drawText("Qty",{x:280,y:s,size:9,font:d}),r.drawText("Job/Cost Code",{x:320,y:s,size:9,font:d}),r.drawText("Unit Price",{x:440,y:s,size:9,font:d}),r.drawText("Total Cost",{x:510,y:s,size:9,font:d}),s-=15;for(const i of t){s<150&&(r=v.addPage([612,792]),s=B-50,r.drawText("Item Description",{x:50,y:s,size:9,font:d}),r.drawText("Qty",{x:280,y:s,size:9,font:d}),r.drawText("Job/Cost Code",{x:320,y:s,size:9,font:d}),r.drawText("Unit Price",{x:440,y:s,size:9,font:d}),r.drawText("Total Cost",{x:510,y:s,size:9,font:d}),s-=15);const j=i.itemName.length>45?i.itemName.substring(0,45)+"...":i.itemName;r.drawText(j,{x:50,y:s,size:9,font:g}),r.drawText(String(i.quantity),{x:280,y:s,size:9,font:g}),r.drawText(i.costCode||"-",{x:320,y:s,size:9,font:g}),r.drawText(`$${i.unitPrice.toFixed(2)}`,{x:440,y:s,size:9,font:g}),r.drawText(`$${i.totalCost.toFixed(2)}`,{x:510,y:s,size:9,font:g}),s-=15}s-=10;const h=t.reduce((i,j)=>i+j.quantity,0);r.drawText(`Total Items: ${h}`,{x:50,y:s,size:9,font:d}),s-=20;const T=420,I=o.subtotal+o.tax;r.drawText(`Subtotal (Items with Tax): $${I.toFixed(2)}`,{x:T,y:s,size:9,font:g}),s-=12,o.fees>0&&(r.drawText(`Fees: $${o.fees.toFixed(2)}`,{x:T,y:s,size:9,font:g}),s-=12),o.discount>0&&(r.drawText(`Discount: -$${o.discount.toFixed(2)}`,{x:T,y:s,size:9,font:g}),s-=12),s-=3,r.drawText(`Grand Total: $${o.total.toFixed(2)}`,{x:T,y:s,size:10,font:d}),s-=30,s<150&&(r=v.addPage([612,792]),s=B-50),r.drawText("Individual Checkout Details",{x:50,y:s,size:14,font:d,color:u(0,0,0)}),s-=25,r.drawText("Item Description",{x:50,y:s,size:9,font:d}),r.drawText("User",{x:210,y:s,size:9,font:d}),r.drawText("Qty",{x:330,y:s,size:9,font:d}),r.drawText("Cost Code",{x:360,y:s,size:9,font:d}),r.drawText("Unit Price",{x:460,y:s,size:9,font:d}),r.drawText("Total Cost",{x:520,y:s,size:9,font:d}),s-=15;for(const i of c){s<100&&(r=v.addPage([612,792]),s=B-50,r.drawText("Item Description",{x:50,y:s,size:9,font:d}),r.drawText("User",{x:210,y:s,size:9,font:d}),r.drawText("Qty",{x:330,y:s,size:9,font:d}),r.drawText("Cost Code",{x:360,y:s,size:9,font:d}),r.drawText("Unit Price",{x:460,y:s,size:9,font:d}),r.drawText("Total Cost",{x:520,y:s,size:9,font:d}),s-=15);const j=i.inventoryItem.name.length>30?i.inventoryItem.name.substring(0,30)+"...":i.inventoryItem.name,oe=(i.userName||i.user||"N/A").length>20?(i.userName||i.user||"N/A").substring(0,20)+"...":i.userName||i.user||"N/A",_=i.departmentId||i.costCode||"IT Stock 1-20-000-5770",G=i.confirmedPrice,U=i.quantity||1,J=G*U,Pe=o.subtotal>0?J/o.subtotal:0,Ce=o.tax*Pe,Ie=J+Ce;r.drawText(j,{x:50,y:s,size:9,font:g}),r.drawText(oe,{x:210,y:s,size:9,font:g}),r.drawText(String(U),{x:330,y:s,size:9,font:g}),r.drawText(_,{x:360,y:s,size:9,font:g}),r.drawText(`$${G.toFixed(2)}`,{x:460,y:s,size:9,font:g}),r.drawText(`$${Ie.toFixed(2)}`,{x:520,y:s,size:9,font:g}),s-=15}s-=5;const b=c.reduce((i,j)=>i+(j.quantity||1),0);r.drawText(`Total Items: ${b}`,{x:50,y:s,size:9,font:d});const R=yield v.save(),$=new Blob([R],{type:"application/pdf"}),q=URL.createObjectURL($),f=document.createElement("a");f.href=q,f.download=n.name,f.click(),URL.revokeObjectURL(q)}catch(l){throw console.error("Error generating PDF report:",l),l}}),W=w.filter(t=>{var n,c,l;if(!F)return!0;const o=F.toLowerCase();return((n=t.name)==null?void 0:n.toLowerCase().includes(o))||((c=t.category)==null?void 0:c.toLowerCase().includes(o))||((l=t.asin)==null?void 0:l.toLowerCase().includes(o))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center mb-4",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",children:"receipt_long"}),"Process Shipment Receipt"]}),e.jsx("p",{style:{color:"var(--color-text-muted)"},children:"Follow the 3-step workflow: Select inventory items, confirm quantities & prices, then upload receipt and process with automatic cost allocation."})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"1"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"inventory_2"}),"Search & Add Items (",Q.length," selected)"]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search by item name, category, or ASIN...",value:F,onChange:t=>X(t.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-[var(--md-sys-color-outline-variant)] focus:border-[var(--color-primary-blue)] transition-colors",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}}),e.jsx("span",{className:"material-icons absolute right-3 top-3",style:{color:"var(--color-text-muted)"},children:"search"})]})}),F&&W.length>0&&e.jsxs("div",{className:"mb-4 border border-[var(--md-sys-color-outline-variant)] rounded-lg overflow-hidden",style:{maxHeight:"300px",overflowY:"auto",background:"var(--md-sys-color-surface)"},children:[W.slice(0,10).map(t=>{const o=Q.some(n=>n.id===t.id);return e.jsx("div",{className:`p-3 border-b border-[var(--md-sys-color-outline-variant)] cursor-pointer hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors ${o?"opacity-50":""}`,onClick:()=>{o||(xe(t),X(""))},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",style:{color:"var(--color-text-light)"},children:[t.name,o&&e.jsx("span",{className:"ml-2 text-xs",style:{color:"var(--color-success-green)"},children:"✓ Added"})]}),e.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-text-muted)"},children:[t.category||"Uncategorized"," • Qty: ",t.quantity||0,t.asin&&` • ${t.asin}`]})]}),e.jsxs("div",{className:"ml-4 text-right",children:[t.price>0&&e.jsxs("div",{className:"font-medium",style:{color:"var(--color-success-green)"},children:["$",t.price.toFixed(2)]}),!o&&e.jsx("span",{className:"material-icons text-sm",style:{color:"var(--color-primary-blue)"},children:"add_circle"})]})]})},t.id)}),W.length>10&&e.jsxs("div",{className:"text-center py-2 text-xs",style:{color:"var(--color-text-muted)",background:"var(--md-sys-color-surface-container-high)"},children:["Showing 10 of ",W.length," results - refine search to see more"]})]}),F&&W.length===0&&e.jsxs("div",{className:"mb-4 p-4 text-center rounded-lg",style:{background:"var(--md-sys-color-surface-container-high)",color:"var(--color-text-muted)"},children:['No items found matching "',F,'"']}),Q.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",style:{color:"var(--color-text-light)"},children:"Selected Items"}),e.jsx("div",{className:"space-y-2",children:Q.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface-container-high)"},children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-text-light)"},children:t.name}),e.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-text-muted)"},children:[t.category||"Uncategorized"," • Stock: ",t.quantity||0,t.price>0&&` • $${t.price.toFixed(2)}`]})]}),e.jsx("button",{onClick:()=>xe(t),className:"ml-4 p-2 rounded-full hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors",title:"Remove item",children:e.jsx("span",{className:"material-icons text-sm",style:{color:"var(--color-error-red)"},children:"close"})})]},t.id))})]}),Q.length===0&&!F&&e.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-muted)"},children:[e.jsx("span",{className:"material-icons text-4xl mb-2",style:{color:"var(--color-text-muted)",opacity:.5},children:"search"}),e.jsx("p",{children:"Search for items to add to this shipment"})]})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"2"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"link"}),"Confirm Quantities & Prices (",y.length," items)"]}),y.length>0?e.jsx("div",{className:"space-y-4",children:y.map((t,o)=>e.jsxs("div",{className:"border border-[var(--md-sys-color-outline-variant)] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium",style:{color:"var(--color-text-light)"},children:t.inventoryItem.name}),e.jsxs("span",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:[t.checkoutRecords.length," checkout",t.checkoutRecords.length!==1?"s":""," matched"]})]}),t.checkoutRecords.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-light)"},children:"Checkout Details:"}),e.jsx("div",{className:"space-y-1",children:t.checkoutRecords.map((n,c)=>{var l,x;return e.jsxs("div",{className:"text-xs p-2 rounded",style:{background:"var(--md-sys-color-surface-container-high)",color:"var(--color-text-muted)"},children:[n.userName||n.user," • Qty: ",n.quantity," • Dept: ",n.departmentId||n.costCode," • ",new Date(((x=(l=n.dateEntered)==null?void 0:l.toDate)==null?void 0:x.call(l))||n.dateEntered||n.date).toLocaleDateString()]},n.id)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--color-text-light)"},children:"Received Quantity"}),e.jsx("input",{type:"number",min:"1",value:t.confirmedQuantity,onChange:n=>ue(t.inventoryItem.id,"confirmedQuantity",n.target.value),className:"w-full px-3 py-2 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--color-text-light)"},children:"Unit Price"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:t.confirmedPrice,onChange:n=>ue(t.inventoryItem.id,"confirmedPrice",n.target.value),className:"w-full px-3 py-2 rounded-lg border border-[var(--md-sys-color-outline-variant)]",style:{background:"var(--md-sys-color-surface)",color:"var(--color-text-light)"}})]})]}),e.jsxs("div",{className:"mt-3 text-sm",style:{color:"var(--color-text-muted)"},children:["Total: $",(t.confirmedQuantity*t.confirmedPrice).toFixed(2)]})]},t.inventoryItem.id))}):e.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-muted)"},children:[e.jsx("span",{className:"material-icons text-4xl mb-2",style:{color:"var(--color-text-muted)",opacity:.5},children:"fact_check"}),e.jsx("p",{children:"Add items in Step 1 to confirm their quantities and prices"})]})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"inline-flex items-center justify-center w-8 h-8 rounded-full mr-2 text-sm font-bold",style:{background:"var(--color-primary-blue)",color:"white"},children:"3"}),e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-success-green)"},children:"receipt_long"}),"Upload Receipt & Finalize"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-light)"},children:"Upload Receipt PDF (Required)"}),e.jsxs("div",{className:"border-2 border-dashed border-[var(--md-sys-color-outline-variant)] rounded-lg p-6 text-center hover:border-[var(--color-primary-blue)] transition-colors",children:[e.jsx("input",{type:"file",accept:".pdf",onChange:je,className:"hidden",id:"pdf-upload"}),e.jsxs("label",{htmlFor:"pdf-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"material-icons text-4xl",style:{color:"var(--color-text-muted)"},children:"upload_file"}),e.jsx("p",{className:"mt-2 text-sm",style:{color:"var(--color-text-light)"},children:"Click to upload PDF receipt or drag and drop"}),O&&e.jsxs("p",{className:"mt-2 text-sm font-medium",style:{color:"var(--color-success-green)"},children:["Selected: ",O.name]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(re,{type:"number",label:"Tax Amount",value:ee,onChange:t=>ae(t.target.value),step:"0.01",min:"0",placeholder:"0.00"}),e.jsx(re,{type:"number",label:"Fees (Shipping/Handling)",value:te,onChange:t=>ce(t.target.value),step:"0.01",min:"0",placeholder:"0.00"}),e.jsx(re,{type:"number",label:"Discount/Promo",value:se,onChange:t=>ne(t.target.value),step:"0.01",min:"0",placeholder:"0.00"})]}),y.length>0&&e.jsxs("div",{className:"mt-6 p-4 rounded-lg",style:{background:"var(--md-sys-color-surface-container-highest)",border:"2px solid var(--color-primary-blue)"},children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"calculate"}),"Cost Summary"]}),e.jsx("div",{className:"space-y-2",children:(()=>{const t=y.reduce((x,u)=>x+u.confirmedQuantity*u.confirmedPrice,0),o=parseFloat(ee)||0,n=parseFloat(te)||0,c=parseFloat(se)||0,l=t+o+n-c;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Subtotal:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",t.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Tax:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Fees:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-text-light)"},children:["$",n.toFixed(2)]})]}),c>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{style:{color:"var(--color-text-muted)"},children:"Discount:"}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-error-red)"},children:["-$",c.toFixed(2)]})]}),e.jsx("div",{className:"pt-2 mt-2 border-t border-[var(--md-sys-color-outline-variant)]",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-bold",style:{color:"var(--color-text-light)"},children:"Total:"}),e.jsxs("span",{className:"font-bold text-xl",style:{color:"var(--color-success-green)"},children:["$",l.toFixed(2)]})]})})]})})()})]}),e.jsx(ge,{color:"success",className:"w-full mt-6",disabled:L||!O||y.length===0,onClick:we,children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons mr-2",children:"receipt_long"}),"Process Receipt (",y.length," items)"]})})]}),K&&e.jsx("div",{className:`mat-card p-4 ${K.includes("✅")?"success-box":K.includes("⏳")?"info-box":"error-box"}`,children:K}),z&&e.jsx("div",{className:"mat-card p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center mb-2",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-warning-orange)"},children:"undo"}),"Undo Last Processing"]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:["Last processed: ",z.itemsProcessed," items • Total: $",z.totalAmount.toFixed(2)]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-muted)"},children:new Date(z.timestamp).toLocaleString()})]}),e.jsxs(ge,{variant:"outlined",color:"error",onClick:Ne,className:"ml-4",children:[e.jsx("span",{className:"material-icons mr-2",children:"undo"}),"Undo Transaction"]})]})}),le.length>0&&e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",style:{color:"var(--color-primary-blue)"},children:"history"}),"Recent Shipment Processing"]}),e.jsx("div",{className:"space-y-3",children:le.slice(-5).reverse().map((t,o)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg",style:{background:"var(--md-sys-color-surface-container-high)"},children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"material-icons",style:{color:"var(--color-success-green)"},children:"check_circle"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:"var(--color-text-light)"},children:[t.itemsProcessed," items processed"]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:["Total: $",t.totalAmount.toFixed(2)]})]})]}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-muted)"},children:new Date(t.timestamp).toLocaleDateString()})]},o))})]})]})};export{Le as default};
