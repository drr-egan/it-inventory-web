var y=(r,p,n)=>new Promise((x,d)=>{var u=s=>{try{l(n.next(s))}catch(c){d(c)}},g=s=>{try{l(n.throw(s))}catch(c){d(c)}},l=s=>s.done?x(s.value):Promise.resolve(s.value).then(u,g);l((n=n.apply(r,p)).next())});import{j as e,d as j}from"./index-779badf6.js";import{r as m}from"./react-vendor-3371026b.js";import{f as S,r as F,h as $,d as I}from"./firebase-vendor-6f993aa2.js";const P=({cart:r,addToCart:p,removeFromCart:n,clearCart:x,users:d,onCheckout:u})=>{const[g,l]=m.useState(!1),[s,c]=m.useState("user"),[h,f]=m.useState(""),[b,N]=m.useState(""),[k,v]=m.useState(""),w=r.reduce((t,a)=>t+(a.price||0)*a.cartQuantity,0),C=t=>{if(!t)return"";const a=t.toString().split("-");if(a.length>=3){const i=a[2],o=i.length===3?i:i.padStart(3,"0").substring(0,3);return`${a[0]}-${a[1]}-${o}-5770`}return t},Q=()=>y(void 0,null,function*(){if(r.length!==0){if(s==="user"&&!h){alert("Please select a user for checkout");return}if(s==="job"&&!b.trim()){alert("Please enter a job number");return}l(!0);try{const t=d.find(a=>a.id===h);for(const a of r){const i=S(j,"items",a.id);yield F(j,o=>y(void 0,null,function*(){const q=(yield o.get(i)).data().quantity||0,U=Math.max(0,q-a.cartQuantity);o.update(i,{quantity:U,lastUpdated:$()});const _=S(I(j,"checkoutHistory"));o.set(_,{itemId:a.id,itemName:a.name,userId:s==="user"?h:"",userName:s==="user"?(t==null?void 0:t.name)||`${t==null?void 0:t.firstName} ${t==null?void 0:t.lastName}`:"Job Checkout",quantity:a.cartQuantity,departmentId:s==="user"?C((t==null?void 0:t.costCode)||(t==null?void 0:t.cost_code)):b,jobNumber:s==="job"?b:"",notes:k,status:"active",dateEntered:$(),createdBy:"system"})}))}x(),f(""),N(""),v(""),alert(`Checkout completed! ${r.length} items processed.`),u&&u()}catch(t){console.error("Checkout error:",t),alert(`Checkout failed: ${t.message}`)}finally{l(!1)}}});return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"material-icons text-xl mr-2 text-blue-600",children:"shopping_cart"}),e.jsx("h3",{className:"text-lg font-medium dark:text-white",children:"Shopping Cart"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r.length>0&&e.jsxs("div",{className:"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full text-sm font-medium",children:[r.length," items"]}),w>0&&e.jsxs("div",{className:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-3 py-1 rounded-full text-sm font-medium",children:["$",w.toFixed(2)]})]})]}),r.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"material-icons text-6xl mb-4 opacity-50",children:"shopping_cart"}),e.jsx("p",{className:"font-medium",children:"Your cart is empty"}),e.jsx("p",{className:"text-sm",children:"Add items to get started"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:r.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Qty: ",t.cartQuantity,t.price>0&&e.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400 font-medium",children:["$",(t.price*t.cartQuantity).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-3",children:[e.jsx("button",{onClick:()=>p(t,1),className:"p-2 min-w-0 w-8 h-8 bg-blue-500 hover:bg-blue-600 text-white rounded transition-all flex items-center justify-center",children:e.jsx("span",{className:"material-icons text-sm",children:"add"})}),e.jsx("button",{onClick:()=>n(t.id),className:"p-2 min-w-0 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded transition-all flex items-center justify-center",children:e.jsx("span",{className:"material-icons text-sm",children:"remove"})})]})]},t.id))}),e.jsxs("div",{className:"border-t dark:border-gray-600 pt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Checkout Method"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"user",checked:s==="user",onChange:t=>c(t.target.value),className:"mr-2 text-blue-600"}),e.jsx("span",{className:"material-icons mr-1 text-sm",children:"person"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"User Checkout"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",value:"job",checked:s==="job",onChange:t=>c(t.target.value),className:"mr-2 text-blue-600"}),e.jsx("span",{className:"material-icons mr-1 text-sm",children:"work"}),e.jsx("span",{className:"text-sm dark:text-gray-300",children:"Job Checkout"})]})]})]}),s==="user"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select User"}),e.jsxs("select",{value:h,onChange:t=>f(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Choose a user..."}),d.slice(0,50).map(t=>e.jsxs("option",{value:t.id,children:[t.name||`${t.firstName} ${t.lastName}`," - ",C(t.costCode||t.cost_code)]},t.id))]})]}),s==="job"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Job Number"}),e.jsx("input",{type:"text",value:b,onChange:t=>N(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:k,onChange:t=>v(t.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:Q,disabled:g,className:"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center justify-center",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons mr-2",children:"check_circle"}),"Checkout"]})}),e.jsx("button",{onClick:x,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-all",children:e.jsx("span",{className:"material-icons",children:"clear"})})]})]})]})]})};export{P as default};
