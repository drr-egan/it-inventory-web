var ee=Object.defineProperty,se=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var B=(l,a,o)=>a in l?ee(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,k=(l,a)=>{for(var o in a||(a={}))ae.call(a,o)&&B(l,o,a[o]);if(q)for(var o of q(a))re.call(a,o)&&B(l,o,a[o]);return l},A=(l,a)=>se(l,te(a));var g=(l,a,o)=>new Promise((C,y)=>{var E=t=>{try{m(o.next(t))}catch(j){y(j)}},N=t=>{try{m(o.throw(t))}catch(j){y(j)}},m=t=>t.done?C(t.value):Promise.resolve(t.value).then(E,N);m((o=o.apply(l,a)).next())});import{j as e,d as $}from"./index-4f19519e.js";import{r as d}from"./react-vendor-3371026b.js";import{j as O,d as J,T as w,h as z,u as le,k as oe}from"./firebase-vendor-fdbb15af.js";import{M as v}from"./MaterialButton-d38df72a.js";import{M as U}from"./MaterialInput-f65a328f.js";import{M as ce}from"./MaterialPagination-bfd34f58.js";const xe=({users:l})=>{const[a,o]=d.useState(""),[C,y]=d.useState(null),[E,N]=d.useState(!1),[m,t]=d.useState(""),[j,S]=d.useState(!1),[f,D]=d.useState(null),[M,T]=d.useState(1),P=20,[i,b]=d.useState({firstName:"",lastName:"",costCode:"",email:""}),V=d.useMemo(()=>a?l.filter(s=>{var r,c;return`${s.firstName} ${s.lastName}`.toLowerCase().includes(a.toLowerCase())||((r=s.costCode)==null?void 0:r.toLowerCase().includes(a.toLowerCase()))||((c=s.email)==null?void 0:c.toLowerCase().includes(a.toLowerCase()))}):l,[l,a]),I=Math.ceil(V.length/P),R=V.slice((M-1)*P,M*P),L=s=>{const{name:r,value:c}=s.target;b(h=>A(k({},h),{[r]:c}))},G=s=>g(void 0,null,function*(){if(s.preventDefault(),!i.firstName||!i.lastName||!i.costCode){t("❌ First Name, Last Name, and Cost Code are required");return}try{yield O(J($,"users"),A(k({},i),{createdAt:w.now(),updatedAt:w.now()})),t("✅ User added successfully"),b({firstName:"",lastName:"",costCode:"",email:""}),S(!1),setTimeout(()=>t(""),3e3)}catch(r){console.error("Error adding user:",r),t(`❌ Error: ${r.message}`)}}),H=s=>g(void 0,null,function*(){if(s.preventDefault(),!!f)try{const r=z($,"users",f.id);yield le(r,A(k({},i),{updatedAt:w.now()})),t("✅ User updated successfully"),D(null),b({firstName:"",lastName:"",costCode:"",email:""}),setTimeout(()=>t(""),3e3)}catch(r){console.error("Error updating user:",r),t(`❌ Error: ${r.message}`)}}),K=s=>g(void 0,null,function*(){if(confirm("Are you sure you want to delete this user?"))try{yield oe(z($,"users",s)),t("✅ User deleted successfully"),setTimeout(()=>t(""),3e3)}catch(r){console.error("Error deleting user:",r),t(`❌ Error: ${r.message}`)}}),Q=s=>{var r,c,h,p;D(s),b({firstName:(r=s.firstName)!=null?r:"",lastName:(c=s.lastName)!=null?c:"",costCode:(h=s.costCode)!=null?h:"",email:(p=s.email)!=null?p:""}),S(!0)},_=()=>{D(null),b({firstName:"",lastName:"",costCode:"",email:""}),S(!1)},W=s=>{y(s.target.files[0]),t("")},X=()=>g(void 0,null,function*(){if(!C){t("❌ Please select a CSV file");return}N(!0),t("⏳ Uploading and processing CSV...");try{const s=yield C.text();window.Papa.parse(s,{header:!0,skipEmptyLines:!0,complete:c=>g(void 0,null,function*(){var F;const h=c.data;let p=0,u=0;for(const x of h)try{if(!x.FirstName||!x.LastName||!x.CostCode){u++;continue}yield O(J($,"users"),{firstName:x.FirstName.trim(),lastName:x.LastName.trim(),costCode:x.CostCode.trim(),email:((F=x.Email)==null?void 0:F.trim())||"",createdAt:w.now(),updatedAt:w.now()}),p++}catch(Z){console.error("Error importing user:",Z),u++}t(`✅ Import complete: ${p} users added, ${u} errors`),y(null),N(!1);const n=document.getElementById("user-csv-input");n&&(n.value="")}),error:c=>{console.error("CSV parse error:",c),t(`❌ Error parsing CSV: ${c.message}`),N(!1)}})}catch(s){console.error("Error reading file:",s),t(`❌ Error: ${s.message}`),N(!1)}}),Y=()=>{if(l.length===0){t("❌ No users to export");return}const s=["FirstName","LastName","CostCode","Email"],r=l.map(n=>[n.firstName,n.lastName,n.costCode,n.email||""]),c=[s.join(","),...r.map(n=>n.map(F=>`"${F}"`).join(","))].join(`
`),h=new Blob([c],{type:"text/csv"}),p=URL.createObjectURL(h),u=document.createElement("a");u.href=p,u.download=`users_export_${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(p),t("✅ Users exported successfully"),setTimeout(()=>t(""),3e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center mb-4",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",children:"people"}),"Users Management"]}),e.jsx("p",{style:{color:"var(--color-text-muted)"},children:"Manage user database via CSV import or manual entry. Users can be assigned to checkout history."})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs(v,{color:"primary",onClick:()=>{S(!j),f&&_()},children:[e.jsx("span",{className:"material-icons",children:"person_add"}),"Add User"]}),e.jsxs(v,{variant:"outlined",onClick:Y,disabled:l.length===0,children:[e.jsx("span",{className:"material-icons",children:"download"}),"Export CSV"]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{id:"user-csv-input",type:"file",accept:".csv",onChange:W,className:"hidden"}),e.jsx("label",{htmlFor:"user-csv-input",children:e.jsxs(v,{variant:"outlined",onClick:()=>document.getElementById("user-csv-input").click(),children:[e.jsx("span",{className:"material-icons",children:"upload_file"}),"Select CSV"]})}),C&&e.jsxs(v,{color:"primary",onClick:X,disabled:E,children:[e.jsx("span",{className:"material-icons",children:"cloud_upload"}),E?"Uploading...":"Import CSV"]})]})]}),e.jsxs("div",{className:"info-box text-sm",children:[e.jsx("strong",{children:"CSV Format:"})," FirstName, LastName, CostCode, Email (optional)",e.jsx("br",{}),e.jsx("strong",{children:"Example:"})," John, Doe, 2-20-060-5770, john.doe@example.com"]}),m&&e.jsx("div",{className:`mt-4 p-3 rounded-lg ${m.includes("✅")?"success-box":m.includes("⏳")?"info-box":"error-box"}`,children:m})]}),j&&e.jsxs("div",{className:"mat-card p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--color-text-light)"},children:f?"Edit User":"Add New User"}),e.jsxs("form",{onSubmit:f?H:G,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(U,{label:"First Name *",name:"firstName",value:i.firstName,onChange:L,required:!0}),e.jsx(U,{label:"Last Name *",name:"lastName",value:i.lastName,onChange:L,required:!0}),e.jsx(U,{label:"Cost Code *",name:"costCode",value:i.costCode,onChange:L,placeholder:"e.g., 2-20-060-5770",required:!0}),e.jsx(U,{label:"Email",name:"email",type:"email",value:i.email,onChange:L})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(v,{type:"submit",color:"primary",children:[e.jsx("span",{className:"material-icons",children:"save"}),f?"Update User":"Add User"]}),e.jsxs(v,{type:"button",variant:"outlined",onClick:_,children:[e.jsx("span",{className:"material-icons",children:"cancel"}),"Cancel"]})]})]})]}),e.jsx("div",{className:"mat-card p-6",children:e.jsx(U,{label:"Search Users",value:a,onChange:s=>{o(s.target.value),T(1)},placeholder:"Search by name, cost code, or email...",children:e.jsx("span",{className:"material-icons",style:{position:"absolute",right:"12px",top:"16px",color:"var(--color-text-muted)"},children:"search"})})}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text-light)"},children:["Users (",V.length,")"]})}),R.length===0?e.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-muted)"},children:[e.jsx("span",{className:"material-icons text-6xl mb-4 opacity-50",children:"people_outline"}),e.jsx("p",{children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Add users manually or import from CSV"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--md-sys-color-outline-variant)]",children:[e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Name"}),e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Cost Code"}),e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Email"}),e.jsx("th",{className:"text-right p-3",style:{color:"var(--color-text-light)"},children:"Actions"})]})}),e.jsx("tbody",{children:R.map(s=>e.jsxs("tr",{className:"border-b border-[var(--md-sys-color-outline-variant)] hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors",children:[e.jsxs("td",{className:"p-3",style:{color:"var(--color-text-light)"},children:[s.firstName," ",s.lastName]}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"pill-badge",children:s.costCode})}),e.jsx("td",{className:"p-3",style:{color:"var(--color-text-muted)"},children:s.email||"-"}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>Q(s),className:"p-2 rounded hover:bg-blue-500/20 transition-colors",style:{color:"var(--color-primary-blue)"},title:"Edit user",children:e.jsx("span",{className:"material-icons text-sm",children:"edit"})}),e.jsx("button",{onClick:()=>K(s.id),className:"p-2 rounded hover:bg-red-500/20 transition-colors",style:{color:"var(--color-error-red)"},title:"Delete user",children:e.jsx("span",{className:"material-icons text-sm",children:"delete"})})]})})]},s.id))})]})}),I>1&&e.jsx("div",{className:"mt-6",children:e.jsx(ce,{currentPage:M,totalPages:I,onPageChange:T})})]})]})]})};export{xe as default};
