var ee=Object.defineProperty,se=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var B=(o,a,l)=>a in o?ee(o,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[a]=l,L=(o,a)=>{for(var l in a||(a={}))ae.call(a,l)&&B(o,l,a[l]);if(q)for(var l of q(a))re.call(a,l)&&B(o,l,a[l]);return o},F=(o,a)=>se(o,te(a));var j=(o,a,l)=>new Promise((v,C)=>{var E=t=>{try{m(l.next(t))}catch(g){C(g)}},N=t=>{try{m(l.throw(t))}catch(g){C(g)}},m=t=>t.done?v(t.value):Promise.resolve(t.value).then(E,N);m((l=l.apply(o,a)).next())});import{j as e,d as k}from"./index-71a9055e.js";import{r as d}from"./react-vendor-3371026b.js";import{j as O,d as J,T as w,h as z,u as oe,k as le}from"./firebase-vendor-fdbb15af.js";import{M as y}from"./MaterialButton-8e67b4a9.js";import{M as U}from"./MaterialInput-966319b4.js";import{M as ce}from"./MaterialPagination-d67a673f.js";const xe=({users:o})=>{const[a,l]=d.useState(""),[v,C]=d.useState(null),[E,N]=d.useState(!1),[m,t]=d.useState(""),[g,D]=d.useState(!1),[f,A]=d.useState(null),[M,V]=d.useState(1),P=20,[n,b]=d.useState({firstName:"",lastName:"",costCode:"",employeeID:""}),$=d.useMemo(()=>a?o.filter(s=>{var r,c;return`${s.firstName} ${s.lastName}`.toLowerCase().includes(a.toLowerCase())||((r=s.costCode)==null?void 0:r.toLowerCase().includes(a.toLowerCase()))||((c=s.employeeID)==null?void 0:c.toLowerCase().includes(a.toLowerCase()))}):o,[o,a]),T=Math.ceil($.length/P),R=$.slice((M-1)*P,M*P),S=s=>{const{name:r,value:c}=s.target;b(p=>F(L({},p),{[r]:c}))},G=s=>j(void 0,null,function*(){if(s.preventDefault(),!n.firstName||!n.lastName||!n.costCode){t("❌ First Name, Last Name, and Cost Code are required");return}try{yield O(J(k,"users"),F(L({},n),{createdAt:w.now(),updatedAt:w.now()})),t("✅ User added successfully"),b({firstName:"",lastName:"",costCode:"",employeeID:""}),D(!1),setTimeout(()=>t(""),3e3)}catch(r){console.error("Error adding user:",r),t(`❌ Error: ${r.message}`)}}),H=s=>j(void 0,null,function*(){if(s.preventDefault(),!!f)try{const r=z(k,"users",f.id);yield oe(r,F(L({},n),{updatedAt:w.now()})),t("✅ User updated successfully"),A(null),b({firstName:"",lastName:"",costCode:"",employeeID:""}),setTimeout(()=>t(""),3e3)}catch(r){console.error("Error updating user:",r),t(`❌ Error: ${r.message}`)}}),K=s=>j(void 0,null,function*(){if(confirm("Are you sure you want to delete this user?"))try{yield le(z(k,"users",s)),t("✅ User deleted successfully"),setTimeout(()=>t(""),3e3)}catch(r){console.error("Error deleting user:",r),t(`❌ Error: ${r.message}`)}}),Q=s=>{var r,c,p,h;A(s),b({firstName:(r=s.firstName)!=null?r:"",lastName:(c=s.lastName)!=null?c:"",costCode:(p=s.costCode)!=null?p:"",employeeID:(h=s.employeeID)!=null?h:""}),D(!0)},_=()=>{A(null),b({firstName:"",lastName:"",costCode:"",employeeID:""}),D(!1)},W=s=>{C(s.target.files[0]),t("")},X=()=>j(void 0,null,function*(){if(!v){t("❌ Please select a CSV file");return}N(!0),t("⏳ Uploading and processing CSV...");try{const s=yield v.text();window.Papa.parse(s,{header:!0,skipEmptyLines:!0,complete:c=>j(void 0,null,function*(){var I;const p=c.data;let h=0,u=0;for(const x of p)try{if(!x.FirstName||!x.LastName||!x.CostCode){u++;continue}yield O(J(k,"users"),{firstName:x.FirstName.trim(),lastName:x.LastName.trim(),costCode:x.CostCode.trim(),employeeID:((I=x.EmployeeID)==null?void 0:I.trim())||"",createdAt:w.now(),updatedAt:w.now()}),h++}catch(Z){console.error("Error importing user:",Z),u++}t(`✅ Import complete: ${h} users added, ${u} errors`),C(null),N(!1);const i=document.getElementById("user-csv-input");i&&(i.value="")}),error:c=>{console.error("CSV parse error:",c),t(`❌ Error parsing CSV: ${c.message}`),N(!1)}})}catch(s){console.error("Error reading file:",s),t(`❌ Error: ${s.message}`),N(!1)}}),Y=()=>{if(o.length===0){t("❌ No users to export");return}const s=["EmployeeID","FirstName","LastName","CostCode"],r=o.map(i=>[i.employeeID||"",i.firstName,i.lastName,i.costCode]),c=[s.join(","),...r.map(i=>i.map(I=>`"${I}"`).join(","))].join(`
`),p=new Blob([c],{type:"text/csv"}),h=URL.createObjectURL(p),u=document.createElement("a");u.href=h,u.download=`users_export_${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(h),t("✅ Users exported successfully"),setTimeout(()=>t(""),3e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center mb-4",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",children:"people"}),"Users Management"]}),e.jsx("p",{style:{color:"var(--color-text-muted)"},children:"Manage user database via CSV import or manual entry. Users can be assigned to checkout history."})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs(y,{color:"primary",onClick:()=>{D(!g),f&&_()},children:[e.jsx("span",{className:"material-icons",children:"person_add"}),"Add User"]}),e.jsxs(y,{variant:"outlined",onClick:Y,disabled:o.length===0,children:[e.jsx("span",{className:"material-icons",children:"download"}),"Export CSV"]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{id:"user-csv-input",type:"file",accept:".csv",onChange:W,className:"hidden"}),e.jsx("label",{htmlFor:"user-csv-input",children:e.jsxs(y,{variant:"outlined",onClick:()=>document.getElementById("user-csv-input").click(),children:[e.jsx("span",{className:"material-icons",children:"upload_file"}),"Select CSV"]})}),v&&e.jsxs(y,{color:"primary",onClick:X,disabled:E,children:[e.jsx("span",{className:"material-icons",children:"cloud_upload"}),E?"Uploading...":"Import CSV"]})]})]}),e.jsxs("div",{className:"info-box text-sm",children:[e.jsx("strong",{children:"CSV Format:"})," EmployeeID, FirstName, LastName, CostCode",e.jsx("br",{}),e.jsx("strong",{children:"Example:"})," EMP001, John, Doe, 2-20-060-5770"]}),m&&e.jsx("div",{className:`mt-4 p-3 rounded-lg ${m.includes("✅")?"success-box":m.includes("⏳")?"info-box":"error-box"}`,children:m})]}),g&&e.jsxs("div",{className:"mat-card p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--color-text-light)"},children:f?"Edit User":"Add New User"}),e.jsxs("form",{onSubmit:f?H:G,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(U,{label:"First Name *",name:"firstName",value:n.firstName,onChange:S,required:!0}),e.jsx(U,{label:"Last Name *",name:"lastName",value:n.lastName,onChange:S,required:!0}),e.jsx(U,{label:"Cost Code *",name:"costCode",value:n.costCode,onChange:S,placeholder:"e.g., 2-20-060-5770",required:!0}),e.jsx(U,{label:"Employee ID",name:"employeeID",value:n.employeeID,onChange:S,placeholder:"e.g., EMP001"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(y,{type:"submit",color:"primary",children:[e.jsx("span",{className:"material-icons",children:"save"}),f?"Update User":"Add User"]}),e.jsxs(y,{type:"button",variant:"outlined",onClick:_,children:[e.jsx("span",{className:"material-icons",children:"cancel"}),"Cancel"]})]})]})]}),e.jsx("div",{className:"mat-card p-6",children:e.jsx(U,{label:"Search Users",value:a,onChange:s=>{l(s.target.value),V(1)},placeholder:"Search by name, cost code, or employee ID...",children:e.jsx("span",{className:"material-icons",style:{position:"absolute",right:"12px",top:"16px",color:"var(--color-text-muted)"},children:"search"})})}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text-light)"},children:["Users (",$.length,")"]})}),R.length===0?e.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-muted)"},children:[e.jsx("span",{className:"material-icons text-6xl mb-4 opacity-50",children:"people_outline"}),e.jsx("p",{children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Add users manually or import from CSV"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--md-sys-color-outline-variant)]",children:[e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Name"}),e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Cost Code"}),e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Employee ID"}),e.jsx("th",{className:"text-right p-3",style:{color:"var(--color-text-light)"},children:"Actions"})]})}),e.jsx("tbody",{children:R.map(s=>e.jsxs("tr",{className:"border-b border-[var(--md-sys-color-outline-variant)] hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors",children:[e.jsxs("td",{className:"p-3",style:{color:"var(--color-text-light)"},children:[s.firstName," ",s.lastName]}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"pill-badge",children:s.costCode})}),e.jsx("td",{className:"p-3",style:{color:"var(--color-text-muted)"},children:s.employeeID||"-"}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>Q(s),className:"p-2 rounded hover:bg-blue-500/20 transition-colors",style:{color:"var(--color-primary-blue)"},title:"Edit user",children:e.jsx("span",{className:"material-icons text-sm",children:"edit"})}),e.jsx("button",{onClick:()=>K(s.id),className:"p-2 rounded hover:bg-red-500/20 transition-colors",style:{color:"var(--color-error-red)"},title:"Delete user",children:e.jsx("span",{className:"material-icons text-sm",children:"delete"})})]})})]},s.id))})]})}),T>1&&e.jsx("div",{className:"mt-6",children:e.jsx(ce,{currentPage:M,totalPages:T,onPageChange:V})})]})]})]})};export{xe as default};
