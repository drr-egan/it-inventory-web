var ee=Object.defineProperty,se=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var B=(r,t,o)=>t in r?ee(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,k=(r,t)=>{for(var o in t||(t={}))te.call(t,o)&&B(r,o,t[o]);if(q)for(var o of q(t))re.call(t,o)&&B(r,o,t[o]);return r},A=(r,t)=>se(r,ae(t));var j=(r,t,o)=>new Promise((g,v)=>{var E=a=>{try{m(o.next(a))}catch(x){v(x)}},u=a=>{try{m(o.throw(a))}catch(x){v(x)}},m=a=>a.done?g(a.value):Promise.resolve(a.value).then(E,u);m((o=o.apply(r,t)).next())});import{j as e,d as $}from"./index-3ab971df.js";import{r as d}from"./react-vendor-3371026b.js";import{j as O,d as J,T as w,h as z,u as le,k as oe}from"./firebase-vendor-fdbb15af.js";import{M as f}from"./MaterialButton-bbeddb73.js";import{M as U}from"./MaterialInput-bfbcf9bb.js";import{M as ce}from"./MaterialPagination-a1219955.js";const xe=({users:r})=>{const[t,o]=d.useState(""),[g,v]=d.useState(null),[E,u]=d.useState(!1),[m,a]=d.useState(""),[x,S]=d.useState(!1),[N,D]=d.useState(null),[M,T]=d.useState(1),P=20,[n,C]=d.useState({firstName:"",lastName:"",costCode:"",email:""}),V=d.useMemo(()=>t?r.filter(s=>{var l,c;return`${s.firstName} ${s.lastName}`.toLowerCase().includes(t.toLowerCase())||((l=s.costCode)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))||((c=s.email)==null?void 0:c.toLowerCase().includes(t.toLowerCase()))}):r,[r,t]),I=Math.ceil(V.length/P),R=V.slice((M-1)*P,M*P),L=s=>{const{name:l,value:c}=s.target;C(y=>A(k({},y),{[l]:c}))},G=s=>j(void 0,null,function*(){if(s.preventDefault(),!n.firstName||!n.lastName||!n.costCode){a("❌ First Name, Last Name, and Cost Code are required");return}try{yield O(J($,"users"),A(k({},n),{createdAt:w.now(),updatedAt:w.now()})),a("✅ User added successfully"),C({firstName:"",lastName:"",costCode:"",email:""}),S(!1),setTimeout(()=>a(""),3e3)}catch(l){console.error("Error adding user:",l),a(`❌ Error: ${l.message}`)}}),H=s=>j(void 0,null,function*(){if(s.preventDefault(),!!N)try{const l=z($,"users",N.id);yield le(l,A(k({},n),{updatedAt:w.now()})),a("✅ User updated successfully"),D(null),C({firstName:"",lastName:"",costCode:"",email:""}),setTimeout(()=>a(""),3e3)}catch(l){console.error("Error updating user:",l),a(`❌ Error: ${l.message}`)}}),K=s=>j(void 0,null,function*(){if(confirm("Are you sure you want to delete this user?"))try{yield oe(z($,"users",s)),a("✅ User deleted successfully"),setTimeout(()=>a(""),3e3)}catch(l){console.error("Error deleting user:",l),a(`❌ Error: ${l.message}`)}}),Q=s=>{D(s),C({firstName:s.firstName,lastName:s.lastName,costCode:s.costCode,email:s.email||""}),S(!0)},_=()=>{D(null),C({firstName:"",lastName:"",costCode:"",email:""}),S(!1)},W=s=>{v(s.target.files[0]),a("")},X=()=>j(void 0,null,function*(){if(!g){a("❌ Please select a CSV file");return}u(!0),a("⏳ Uploading and processing CSV...");try{const s=yield g.text();window.Papa.parse(s,{header:!0,skipEmptyLines:!0,complete:c=>j(void 0,null,function*(){var F;const y=c.data;let b=0,h=0;for(const p of y)try{if(!p.FirstName||!p.LastName||!p.CostCode){h++;continue}yield O(J($,"users"),{firstName:p.FirstName.trim(),lastName:p.LastName.trim(),costCode:p.CostCode.trim(),email:((F=p.Email)==null?void 0:F.trim())||"",createdAt:w.now(),updatedAt:w.now()}),b++}catch(Z){console.error("Error importing user:",Z),h++}a(`✅ Import complete: ${b} users added, ${h} errors`),v(null),u(!1);const i=document.getElementById("user-csv-input");i&&(i.value="")}),error:c=>{console.error("CSV parse error:",c),a(`❌ Error parsing CSV: ${c.message}`),u(!1)}})}catch(s){console.error("Error reading file:",s),a(`❌ Error: ${s.message}`),u(!1)}}),Y=()=>{if(r.length===0){a("❌ No users to export");return}const s=["FirstName","LastName","CostCode","Email"],l=r.map(i=>[i.firstName,i.lastName,i.costCode,i.email||""]),c=[s.join(","),...l.map(i=>i.map(F=>`"${F}"`).join(","))].join(`
`),y=new Blob([c],{type:"text/csv"}),b=URL.createObjectURL(y),h=document.createElement("a");h.href=b,h.download=`users_export_${new Date().toISOString().split("T")[0]}.csv`,h.click(),URL.revokeObjectURL(b),a("✅ Users exported successfully"),setTimeout(()=>a(""),3e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center mb-4",style:{color:"var(--color-text-light)"},children:[e.jsx("span",{className:"material-icons mr-2",children:"people"}),"Users Management"]}),e.jsx("p",{style:{color:"var(--color-text-muted)"},children:"Manage user database via CSV import or manual entry. Users can be assigned to checkout history."})]}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs(f,{variant:"primary",onClick:()=>{S(!x),N&&_()},children:[e.jsx("span",{className:"material-icons",children:"person_add"}),"Add User"]}),e.jsxs(f,{variant:"secondary",onClick:Y,disabled:r.length===0,children:[e.jsx("span",{className:"material-icons",children:"download"}),"Export CSV"]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{id:"user-csv-input",type:"file",accept:".csv",onChange:W,className:"hidden"}),e.jsx("label",{htmlFor:"user-csv-input",children:e.jsxs(f,{variant:"secondary",onClick:()=>document.getElementById("user-csv-input").click(),children:[e.jsx("span",{className:"material-icons",children:"upload_file"}),"Select CSV"]})}),g&&e.jsxs(f,{variant:"primary",onClick:X,disabled:E,children:[e.jsx("span",{className:"material-icons",children:"cloud_upload"}),E?"Uploading...":"Import CSV"]})]})]}),e.jsxs("div",{className:"info-box text-sm",children:[e.jsx("strong",{children:"CSV Format:"})," FirstName, LastName, CostCode, Email (optional)",e.jsx("br",{}),e.jsx("strong",{children:"Example:"})," John, Doe, 2-20-060-5770, john.doe@example.com"]}),m&&e.jsx("div",{className:`mt-4 p-3 rounded-lg ${m.includes("✅")?"success-box":m.includes("⏳")?"info-box":"error-box"}`,children:m})]}),x&&e.jsxs("div",{className:"mat-card p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{color:"var(--color-text-light)"},children:N?"Edit User":"Add New User"}),e.jsxs("form",{onSubmit:N?H:G,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(U,{label:"First Name *",name:"firstName",value:n.firstName,onChange:L,required:!0}),e.jsx(U,{label:"Last Name *",name:"lastName",value:n.lastName,onChange:L,required:!0}),e.jsx(U,{label:"Cost Code *",name:"costCode",value:n.costCode,onChange:L,placeholder:"e.g., 2-20-060-5770",required:!0}),e.jsx(U,{label:"Email",name:"email",type:"email",value:n.email,onChange:L})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(f,{type:"submit",variant:"primary",children:[e.jsx("span",{className:"material-icons",children:"save"}),N?"Update User":"Add User"]}),e.jsxs(f,{type:"button",variant:"secondary",onClick:_,children:[e.jsx("span",{className:"material-icons",children:"cancel"}),"Cancel"]})]})]})]}),e.jsx("div",{className:"mat-card p-6",children:e.jsx(U,{label:"Search Users",value:t,onChange:s=>{o(s.target.value),T(1)},placeholder:"Search by name, cost code, or email...",children:e.jsx("span",{className:"material-icons",style:{position:"absolute",right:"12px",top:"16px",color:"var(--color-text-muted)"},children:"search"})})}),e.jsxs("div",{className:"mat-card p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text-light)"},children:["Users (",V.length,")"]})}),R.length===0?e.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-muted)"},children:[e.jsx("span",{className:"material-icons text-6xl mb-4 opacity-50",children:"people_outline"}),e.jsx("p",{children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Add users manually or import from CSV"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--md-sys-color-outline-variant)]",children:[e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Name"}),e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Cost Code"}),e.jsx("th",{className:"text-left p-3",style:{color:"var(--color-text-light)"},children:"Email"}),e.jsx("th",{className:"text-right p-3",style:{color:"var(--color-text-light)"},children:"Actions"})]})}),e.jsx("tbody",{children:R.map(s=>e.jsxs("tr",{className:"border-b border-[var(--md-sys-color-outline-variant)] hover:bg-[var(--md-sys-color-surface-container-highest)] transition-colors",children:[e.jsxs("td",{className:"p-3",style:{color:"var(--color-text-light)"},children:[s.firstName," ",s.lastName]}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"pill-badge",children:s.costCode})}),e.jsx("td",{className:"p-3",style:{color:"var(--color-text-muted)"},children:s.email||"-"}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>Q(s),className:"p-2 rounded hover:bg-blue-500/20 transition-colors",style:{color:"var(--color-primary-blue)"},title:"Edit user",children:e.jsx("span",{className:"material-icons text-sm",children:"edit"})}),e.jsx("button",{onClick:()=>K(s.id),className:"p-2 rounded hover:bg-red-500/20 transition-colors",style:{color:"var(--color-error-red)"},title:"Delete user",children:e.jsx("span",{className:"material-icons text-sm",children:"delete"})})]})})]},s.id))})]})}),I>1&&e.jsx("div",{className:"mt-6",children:e.jsx(ce,{currentPage:M,totalPages:I,onPageChange:T})})]})]})]})};export{xe as default};
