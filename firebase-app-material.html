<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Inventory Management - Firebase Material</title>

    <!-- Material Design CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase Configuration -->
    <script src="./firebase-config.js"></script>

    <style>
        /* Material Design Custom Styles */
        * {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* Material Design Shadows */
        .mat-elevation-1 { box-shadow: 0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12); }
        .mat-elevation-2 { box-shadow: 0px 3px 1px -2px rgba(0,0,0,0.2), 0px 2px 2px 0px rgba(0,0,0,0.14), 0px 1px 5px 0px rgba(0,0,0,0.12); }
        .mat-elevation-4 { box-shadow: 0px 2px 4px -1px rgba(0,0,0,0.2), 0px 4px 5px 0px rgba(0,0,0,0.14), 0px 1px 10px 0px rgba(0,0,0,0.12); }
        .mat-elevation-8 { box-shadow: 0px 5px 5px -3px rgba(0,0,0,0.2), 0px 8px 10px 1px rgba(0,0,0,0.14), 0px 3px 14px 2px rgba(0,0,0,0.12); }
        .mat-elevation-16 { box-shadow: 0px 8px 10px -5px rgba(0,0,0,0.2), 0px 16px 24px 2px rgba(0,0,0,0.14), 0px 6px 30px 5px rgba(0,0,0,0.12); }

        /* Material Design Ripple Effect */
        .mat-ripple {
            position: relative;
            overflow: hidden;
            transform: translate3d(0, 0, 0);
        }

        .mat-ripple:before {
            content: "";
            display: block;
            position: absolute;
            left: 50%;
            top: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: width 0.6s, height 0.6s, left 0.6s, top 0.6s;
            transform: translate(-50%, -50%);
        }

        .mat-ripple:active:before {
            width: 300px;
            height: 300px;
        }

        /* Material Design Input Fields */
        .mat-input {
            position: relative;
        }

        .mat-input input, .mat-input select, .mat-input textarea {
            width: 100%;
            padding: 16px 12px 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background: transparent;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .mat-input input:focus, .mat-input select:focus, .mat-input textarea:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .mat-input label {
            position: absolute;
            left: 12px;
            top: 16px;
            color: #757575;
            font-size: 16px;
            transition: all 0.2s ease;
            pointer-events: none;
            background: white;
            padding: 0 4px;
        }

        .mat-input input:focus + label,
        .mat-input input:not(:placeholder-shown) + label,
        .mat-input select:focus + label,
        .mat-input textarea:focus + label,
        .mat-input textarea:not(:placeholder-shown) + label {
            top: -6px;
            font-size: 12px;
            color: #1976d2;
        }

        /* Material Design FAB */
        .mat-fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .mat-fab:hover {
            transform: scale(1.1);
        }

        /* Material Design Tabs */
        .mat-tab-nav {
            border-bottom: 1px solid #e0e0e0;
        }

        .mat-tab {
            position: relative;
            padding: 16px 24px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }

        .mat-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #1976d2;
            transition: all 0.2s ease;
        }

        /* Material Design Cards */
        .mat-card {
            border-radius: 4px;
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .mat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2), 0px 6px 10px 0px rgba(0,0,0,0.14), 0px 1px 18px 0px rgba(0,0,0,0.12);
        }

        /* Material Design Snackbar */
        .mat-snackbar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: #323232;
            color: white;
            padding: 14px 24px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        /* Dark Mode Material Design */
        .dark .mat-card { background: #424242; }
        .dark .mat-input input,
        .dark .mat-input select,
        .dark .mat-input textarea {
            background: #424242;
            border-color: #616161;
            color: white;
        }
        .dark .mat-input label {
            background: #424242;
            color: #bdbdbd;
        }
        .dark .mat-tab-nav { border-bottom-color: #616161; }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Loading animations */
        .mat-spinner {
            animation: mat-spinner-rotate 2s linear infinite;
        }

        @keyframes mat-spinner-rotate {
            0% { transform: rotate(0); }
            100% { transform: rotate(360deg); }
        }

        /* Material Design progress bar */
        .mat-progress-bar {
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
        }

        .mat-progress-bar-fill {
            height: 100%;
            background: #1976d2;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Material Design Hook for Snackbar
        const useSnackbar = () => {
            const [snackbar, setSnackbar] = useState(null);

            const showSnackbar = (message, type = 'info', duration = 4000) => {
                setSnackbar({ message, type });
                setTimeout(() => setSnackbar(null), duration);
            };

            return { snackbar, showSnackbar };
        };

        // Material Design Hook for Theme
        const useTheme = () => {
            const [isDarkMode, setIsDarkMode] = useState(() => {
                const saved = localStorage.getItem('darkMode');
                return saved ? JSON.parse(saved) : false;
            });

            useEffect(() => {
                localStorage.setItem('darkMode', JSON.stringify(isDarkMode));
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [isDarkMode]);

            return { isDarkMode, toggleDarkMode: () => setIsDarkMode(!isDarkMode) };
        };

        // Material Design Input Component
        const MaterialInput = ({ label, type = 'text', value, onChange, placeholder = ' ', ...props }) => {
            return (
                <div className="mat-input">
                    <input
                        type={type}
                        value={value}
                        onChange={onChange}
                        placeholder={placeholder}
                        {...props}
                    />
                    <label>{label}</label>
                </div>
            );
        };

        // Material Design Button Component
        const MaterialButton = ({ children, variant = 'contained', color = 'primary', onClick, disabled, className = '', ...props }) => {
            const baseClasses = 'mat-ripple inline-flex items-center justify-center px-6 py-3 font-medium text-sm rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2';

            const variantClasses = {
                contained: {
                    primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 mat-elevation-2',
                    secondary: 'bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500 mat-elevation-2',
                    success: 'bg-green-600 text-white hover:bg-green-700 focus:ring-green-500 mat-elevation-2',
                    error: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500 mat-elevation-2'
                },
                outlined: {
                    primary: 'border border-blue-600 text-blue-600 hover:bg-blue-50 focus:ring-blue-500',
                    secondary: 'border border-gray-600 text-gray-600 hover:bg-gray-50 focus:ring-gray-500',
                    success: 'border border-green-600 text-green-600 hover:bg-green-50 focus:ring-green-500',
                    error: 'border border-red-600 text-red-600 hover:bg-red-50 focus:ring-red-500'
                },
                text: {
                    primary: 'text-blue-600 hover:bg-blue-50 focus:ring-blue-500',
                    secondary: 'text-gray-600 hover:bg-gray-50 focus:ring-gray-500',
                    success: 'text-green-600 hover:bg-green-50 focus:ring-green-500',
                    error: 'text-red-600 hover:bg-red-50 focus:ring-red-500'
                }
            };

            const buttonClasses = `${baseClasses} ${variantClasses[variant][color]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`;

            return (
                <button
                    className={buttonClasses}
                    onClick={onClick}
                    disabled={disabled}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        // Material Design Card Component
        const MaterialCard = ({ children, elevation = 1, className = '', ...props }) => {
            return (
                <div className={`mat-card mat-elevation-${elevation} p-6 ${className}`} {...props}>
                    {children}
                </div>
            );
        };

        // Error Boundary
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true };
            }

            componentDidCatch(error, errorInfo) {
                console.error('ðŸš¨ Application Error:', error);
                this.setState({ error });
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900">
                            <MaterialCard elevation={8} className="max-w-md">
                                <div className="flex items-center text-red-600 mb-4">
                                    <span className="material-icons mr-2">error</span>
                                    <h1 className="text-xl font-bold">Application Error</h1>
                                </div>
                                <p className="text-gray-700 dark:text-gray-300 mb-4">
                                    {this.state.error?.message || 'An unexpected error occurred'}
                                </p>
                                <MaterialButton
                                    onClick={() => window.location.reload()}
                                    variant="contained"
                                    color="primary"
                                    className="w-full"
                                >
                                    <span className="material-icons mr-2">refresh</span>
                                    Refresh Page
                                </MaterialButton>
                            </MaterialCard>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // Authentication Component with Material Design
        const AuthComponent = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const { showSnackbar } = useSnackbar();

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setLoading(false);
                });
                return unsubscribe;
            }, []);

            const handleSignIn = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    showSnackbar('Welcome back!', 'success');
                } catch (error) {
                    setError(error.message);
                    showSnackbar(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900">
                        <div className="text-center">
                            <div className="mat-spinner w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"></div>
                            <p className="text-gray-600 dark:text-gray-400">Loading Firebase...</p>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 px-4">
                        <MaterialCard elevation={8} className="w-full max-w-md">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full mb-4">
                                    <span className="material-icons text-2xl text-blue-600 dark:text-blue-400">inventory</span>
                                </div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white">IT Inventory</h2>
                                <p className="text-gray-600 dark:text-gray-400">Sign in to access your inventory system</p>
                            </div>

                            <form onSubmit={handleSignIn} className="space-y-6">
                                <MaterialInput
                                    label="Email Address"
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />

                                <MaterialInput
                                    label="Password"
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />

                                {error && (
                                    <div className="flex items-center text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded">
                                        <span className="material-icons mr-2 text-sm">error</span>
                                        {error}
                                    </div>
                                )}

                                <MaterialButton
                                    type="submit"
                                    variant="contained"
                                    color="primary"
                                    disabled={loading}
                                    className="w-full"
                                >
                                    {loading ? (
                                        <>
                                            <div className="mat-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                            Signing in...
                                        </>
                                    ) : (
                                        <>
                                            <span className="material-icons mr-2">login</span>
                                            Sign In
                                        </>
                                    )}
                                </MaterialButton>
                            </form>
                        </MaterialCard>
                    </div>
                );
            }

            return (
                <header className="bg-blue-600 dark:bg-blue-800 text-white mat-elevation-4">
                    <div className="max-w-7xl mx-auto px-4">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center space-x-4">
                                <span className="material-icons text-2xl">inventory</span>
                                <div>
                                    <h1 className="font-semibold">IT Inventory System</h1>
                                    <p className="text-xs text-blue-100">Firebase powered</p>
                                </div>
                            </div>

                            <div className="flex items-center space-x-4">
                                <div className="flex items-center space-x-2 text-sm">
                                    <span className="material-icons text-sm">account_circle</span>
                                    <span>{user.email}</span>
                                    <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                </div>

                                <MaterialButton
                                    onClick={() => auth.signOut()}
                                    variant="text"
                                    className="text-white hover:bg-blue-700 dark:hover:bg-blue-900"
                                >
                                    <span className="material-icons mr-1">logout</span>
                                    Sign Out
                                </MaterialButton>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // Shopping Cart Component with Material Design
        const MaterialShoppingCart = ({ cart, addToCart, removeFromCart, clearCart, users, onCheckout }) => {
            const [isCheckingOut, setIsCheckingOut] = useState(false);
            const [checkoutMethod, setCheckoutMethod] = useState('user');
            const [selectedUser, setSelectedUser] = useState('');
            const [jobNumber, setJobNumber] = useState('');
            const [notes, setNotes] = useState('');
            const { showSnackbar } = useSnackbar();

            const cartTotal = cart.reduce((sum, item) => sum + (item.price || 0) * item.cartQuantity, 0);

            const handleCheckout = async () => {
                if (cart.length === 0) return;

                if (checkoutMethod === 'user' && !selectedUser) {
                    showSnackbar('Please select a user for checkout', 'error');
                    return;
                }

                if (checkoutMethod === 'job' && !jobNumber.trim()) {
                    showSnackbar('Please enter a job number', 'error');
                    return;
                }

                setIsCheckingOut(true);

                try {
                    const user = users.find(u => u.id === selectedUser);

                    for (const cartItem of cart) {
                        // Update inventory
                        const itemRef = db.collection('items').doc(cartItem.id);
                        await db.runTransaction(async (transaction) => {
                            const doc = await transaction.get(itemRef);
                            const currentQty = doc.data().quantity || 0;
                            const newQty = Math.max(0, currentQty - cartItem.cartQuantity);

                            transaction.update(itemRef, {
                                quantity: newQty,
                                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                            });

                            // Create checkout record
                            const checkoutRef = db.collection('checkoutHistory').doc();
                            transaction.set(checkoutRef, {
                                itemId: cartItem.id,
                                itemName: cartItem.name,
                                userId: checkoutMethod === 'user' ? selectedUser : '',
                                userName: checkoutMethod === 'user' ? (user?.name || `${user?.firstName} ${user?.lastName}`) : 'Job Checkout',
                                quantity: cartItem.cartQuantity,
                                departmentId: checkoutMethod === 'user' ? (user?.costCode || user?.cost_code) : jobNumber,
                                jobNumber: checkoutMethod === 'job' ? jobNumber : '',
                                notes: notes,
                                status: 'active',
                                dateEntered: firebase.firestore.FieldValue.serverTimestamp(),
                                createdBy: auth.currentUser?.email || 'unknown'
                            });
                        });
                    }

                    // Clear cart and form
                    clearCart();
                    setSelectedUser('');
                    setJobNumber('');
                    setNotes('');
                    showSnackbar(`Checkout completed! ${cart.length} items processed.`, 'success');

                    if (onCheckout) onCheckout();

                } catch (error) {
                    console.error('Checkout error:', error);
                    showSnackbar(`Checkout failed: ${error.message}`, 'error');
                } finally {
                    setIsCheckingOut(false);
                }
            };

            return (
                <MaterialCard elevation={2} className="sticky top-6">
                    <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center">
                            <span className="material-icons text-xl mr-2 text-blue-600">shopping_cart</span>
                            <h3 className="text-lg font-medium dark:text-white">Shopping Cart</h3>
                        </div>
                        <div className="flex items-center space-x-2">
                            {cart.length > 0 && (
                                <div className="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full text-sm font-medium">
                                    {cart.length} items
                                </div>
                            )}
                            {cartTotal > 0 && (
                                <div className="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-3 py-1 rounded-full text-sm font-medium">
                                    ${cartTotal.toFixed(2)}
                                </div>
                            )}
                        </div>
                    </div>

                    {cart.length === 0 ? (
                        <div className="text-center py-12 text-gray-500 dark:text-gray-400">
                            <span className="material-icons text-6xl mb-4 opacity-50">shopping_cart</span>
                            <p className="font-medium">Your cart is empty</p>
                            <p className="text-sm">Add items to get started</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            <div className="space-y-3 max-h-60 overflow-y-auto">
                                {cart.map(item => (
                                    <div key={item.id} className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div className="flex-1 min-w-0">
                                            <div className="font-medium text-gray-900 dark:text-white truncate">{item.name}</div>
                                            <div className="text-sm text-gray-600 dark:text-gray-400">
                                                Qty: {item.cartQuantity}
                                                {item.price > 0 && (
                                                    <span className="ml-2 text-green-600 dark:text-green-400 font-medium">
                                                        ${(item.price * item.cartQuantity).toFixed(2)}
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                        <div className="flex items-center space-x-2 ml-3">
                                            <MaterialButton
                                                onClick={() => addToCart(item, 1)}
                                                variant="outlined"
                                                color="primary"
                                                className="!p-2 !min-w-0 !w-8 !h-8"
                                            >
                                                <span className="material-icons text-sm">add</span>
                                            </MaterialButton>
                                            <MaterialButton
                                                onClick={() => removeFromCart(item.id)}
                                                variant="outlined"
                                                color="error"
                                                className="!p-2 !min-w-0 !w-8 !h-8"
                                            >
                                                <span className="material-icons text-sm">remove</span>
                                            </MaterialButton>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="border-t dark:border-gray-600 pt-4 space-y-4">
                                {/* Checkout Method */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                                        Checkout Method
                                    </label>
                                    <div className="flex space-x-4">
                                        <label className="flex items-center cursor-pointer">
                                            <input
                                                type="radio"
                                                value="user"
                                                checked={checkoutMethod === 'user'}
                                                onChange={(e) => setCheckoutMethod(e.target.value)}
                                                className="mr-2 text-blue-600"
                                            />
                                            <span className="material-icons mr-1 text-sm">person</span>
                                            <span className="text-sm">User Checkout</span>
                                        </label>
                                        <label className="flex items-center cursor-pointer">
                                            <input
                                                type="radio"
                                                value="job"
                                                checked={checkoutMethod === 'job'}
                                                onChange={(e) => setCheckoutMethod(e.target.value)}
                                                className="mr-2 text-blue-600"
                                            />
                                            <span className="material-icons mr-1 text-sm">work</span>
                                            <span className="text-sm">Job Checkout</span>
                                        </label>
                                    </div>
                                </div>

                                {/* User Selection */}
                                {checkoutMethod === 'user' && (
                                    <div className="mat-input">
                                        <select
                                            value={selectedUser}
                                            onChange={(e) => setSelectedUser(e.target.value)}
                                            required
                                        >
                                            <option value="">Choose a user...</option>
                                            {users.slice(0, 50).map(user => (
                                                <option key={user.id} value={user.id}>
                                                    {user.name || `${user.firstName} ${user.lastName}`} - {user.costCode || user.cost_code}
                                                </option>
                                            ))}
                                        </select>
                                        <label>Select User</label>
                                    </div>
                                )}

                                {/* Job Number */}
                                {checkoutMethod === 'job' && (
                                    <MaterialInput
                                        label="Job Number"
                                        value={jobNumber}
                                        onChange={(e) => setJobNumber(e.target.value)}
                                        required
                                    />
                                )}

                                {/* Notes */}
                                <div className="mat-input">
                                    <textarea
                                        value={notes}
                                        onChange={(e) => setNotes(e.target.value)}
                                        rows={2}
                                        placeholder=" "
                                    />
                                    <label>Notes (Optional)</label>
                                </div>

                                {/* Checkout Buttons */}
                                <div className="flex space-x-3">
                                    <MaterialButton
                                        onClick={handleCheckout}
                                        disabled={isCheckingOut}
                                        variant="contained"
                                        color="success"
                                        className="flex-1"
                                    >
                                        {isCheckingOut ? (
                                            <>
                                                <div className="mat-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                                Processing...
                                            </>
                                        ) : (
                                            <>
                                                <span className="material-icons mr-2">check_circle</span>
                                                Checkout
                                            </>
                                        )}
                                    </MaterialButton>
                                    <MaterialButton
                                        onClick={clearCart}
                                        variant="outlined"
                                        color="secondary"
                                        className="px-4"
                                    >
                                        <span className="material-icons">clear</span>
                                    </MaterialButton>
                                </div>
                            </div>
                        </div>
                    )}
                </MaterialCard>
            );
        };

        // Barcode Scanner Component with Material Design
        const MaterialBarcodeScanner = ({ items, onItemScanned }) => {
            const [scanInput, setScanInput] = useState('');
            const [recentScans, setRecentScans] = useState([]);
            const [feedback, setFeedback] = useState('');
            const [isScanning, setIsScanning] = useState(false);
            const { showSnackbar } = useSnackbar();
            const inputRef = useRef(null);

            const handleItemScanned = async (itemIdentifier, quantity = 1) => {
                setIsScanning(true);

                try {
                    const item = items.find(i =>
                        i.name.toLowerCase().includes(itemIdentifier.toLowerCase()) ||
                        i.asin === itemIdentifier ||
                        i.id === itemIdentifier
                    );

                    if (!item) {
                        showSnackbar(`Item not found: ${itemIdentifier}`, 'error');
                        setIsScanning(false);
                        return;
                    }

                    // Update inventory in Firebase
                    await db.collection('items').doc(item.id).update({
                        quantity: firebase.firestore.FieldValue.increment(quantity),
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Add to recent scans
                    const scanRecord = {
                        id: Date.now(),
                        item: item,
                        quantity: quantity,
                        timestamp: new Date()
                    };

                    setRecentScans(prev => [scanRecord, ...prev.slice(0, 4)]);
                    showSnackbar(`${item.name} +${quantity}`, 'success');

                    if (onItemScanned) {
                        onItemScanned(item, quantity);
                    }

                    setScanInput('');

                } catch (error) {
                    showSnackbar(`Scan error: ${error.message}`, 'error');
                } finally {
                    setIsScanning(false);
                    if (inputRef.current) {
                        setTimeout(() => inputRef.current.focus(), 100);
                    }
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && scanInput.trim()) {
                    handleItemScanned(scanInput.trim());
                }
            };

            const startVoiceSearch = () => {
                if (!('webkitSpeechRecognition' in window)) {
                    showSnackbar('Voice recognition not supported', 'error');
                    return;
                }

                const recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onstart = () => {
                    setFeedback('ðŸŽ¤ Listening...');
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    setScanInput(transcript);
                    handleItemScanned(transcript);
                };

                recognition.onerror = () => {
                    showSnackbar('Voice recognition failed', 'error');
                    setFeedback('');
                };

                recognition.start();
            };

            return (
                <MaterialCard elevation={2}>
                    <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center">
                            <span className="material-icons text-xl mr-2 text-blue-600">qr_code_scanner</span>
                            <h3 className="text-lg font-medium dark:text-white">Barcode Scanner</h3>
                        </div>
                        <div className="flex items-center space-x-2">
                            <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span className="text-sm text-gray-600 dark:text-gray-400">Ready</span>
                        </div>
                    </div>

                    <div className="space-y-4">
                        <MaterialInput
                            ref={inputRef}
                            label="Scan or type item name"
                            value={scanInput}
                            onChange={(e) => setScanInput(e.target.value)}
                            onKeyPress={handleKeyPress}
                            disabled={isScanning}
                            autoFocus
                        />

                        <div className="flex space-x-3">
                            <MaterialButton
                                onClick={startVoiceSearch}
                                disabled={isScanning}
                                variant="outlined"
                                color="primary"
                                className="flex-1"
                            >
                                <span className="material-icons mr-2">mic</span>
                                Voice Search
                            </MaterialButton>
                            <MaterialButton
                                onClick={() => handleItemScanned(scanInput.trim())}
                                disabled={isScanning || !scanInput.trim()}
                                variant="contained"
                                color="primary"
                                className="flex-1"
                            >
                                {isScanning ? (
                                    <>
                                        <div className="mat-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                        Scanning...
                                    </>
                                ) : (
                                    <>
                                        <span className="material-icons mr-2">search</span>
                                        Scan
                                    </>
                                )}
                            </MaterialButton>
                        </div>

                        {/* Recent Scans */}
                        {recentScans.length > 0 && (
                            <div>
                                <h4 className="font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                    <span className="material-icons mr-2 text-sm">history</span>
                                    Recent Scans
                                </h4>
                                <div className="space-y-2 max-h-32 overflow-y-auto">
                                    {recentScans.map((scan, index) => (
                                        <div
                                            key={scan.id}
                                            className={`flex justify-between items-center p-3 rounded-lg transition-all ${
                                                index === 0
                                                    ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800'
                                                    : 'bg-gray-50 dark:bg-gray-700'
                                            }`}
                                        >
                                            <div className="flex-1 min-w-0">
                                                <div className="font-medium text-gray-900 dark:text-white truncate">
                                                    {scan.item.name}
                                                </div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">
                                                    {scan.timestamp.toLocaleTimeString()}
                                                </div>
                                            </div>
                                            <div className="flex items-center space-x-2 ml-3">
                                                <span className="text-green-600 dark:text-green-400 font-bold">
                                                    +{scan.quantity}
                                                </span>
                                                <MaterialButton
                                                    onClick={() => handleItemScanned(scan.item.name)}
                                                    variant="text"
                                                    color="primary"
                                                    className="!p-2 !min-w-0 !text-xs"
                                                >
                                                    <span className="material-icons text-sm">refresh</span>
                                                </MaterialButton>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </MaterialCard>
            );
        };

        // Snackbar Component
        const MaterialSnackbar = ({ snackbar }) => {
            if (!snackbar) return null;

            const iconMap = {
                success: 'check_circle',
                error: 'error',
                warning: 'warning',
                info: 'info'
            };

            return (
                <div className="mat-snackbar flex items-center">
                    <span className="material-icons mr-2 text-sm">
                        {iconMap[snackbar.type] || 'info'}
                    </span>
                    {snackbar.message}
                </div>
            );
        };

        // Main Firebase App with Material Design
        const MaterialFirebaseApp = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [items, setItems] = useState([]);
            const [users, setUsers] = useState([]);
            const [checkoutHistory, setCheckoutHistory] = useState([]);
            const [activeTab, setActiveTab] = useState('shop');
            const [cart, setCart] = useState([]);
            const [connectionStatus, setConnectionStatus] = useState('connecting');
            const [notifications, setNotifications] = useState([]);

            const { isDarkMode, toggleDarkMode } = useTheme();
            const { snackbar, showSnackbar } = useSnackbar();

            // Real-time data listeners
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    setUser(user);
                    setLoading(false);

                    if (user) {
                        try {
                            setConnectionStatus('connecting');

                            // Set up real-time listeners
                            const itemsUnsubscribe = db.collection('items')
                                .onSnapshot((snapshot) => {
                                    const itemsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                    setItems(itemsData);
                                    checkLowStock(itemsData);
                                });

                            const usersUnsubscribe = db.collection('users')
                                .limit(100)
                                .onSnapshot((snapshot) => {
                                    const usersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                    setUsers(usersData);
                                });

                            const historyUnsubscribe = db.collection('checkoutHistory')
                                .orderBy('dateEntered', 'desc')
                                .limit(50)
                                .onSnapshot((snapshot) => {
                                    const historyData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                    setCheckoutHistory(historyData);
                                });

                            setConnectionStatus('connected');

                            return () => {
                                itemsUnsubscribe();
                                usersUnsubscribe();
                                historyUnsubscribe();
                            };

                        } catch (error) {
                            console.error('Firebase connection error:', error);
                            setConnectionStatus('error');
                            showSnackbar('Connection error: ' + error.message, 'error');
                        }
                    }
                });

                return unsubscribe;
            }, []);

            const checkLowStock = (itemList) => {
                const lowStockItems = itemList.filter(item =>
                    item.quantity <= (item.minThreshold || 5)
                );

                setNotifications(lowStockItems.map(item => ({
                    id: item.id,
                    type: 'warning',
                    message: `Low stock: ${item.name} (${item.quantity} remaining)`
                })));
            };

            const addToCart = (item, quantity = 1) => {
                const existingIndex = cart.findIndex(cartItem => cartItem.id === item.id);

                if (existingIndex >= 0) {
                    const newCart = [...cart];
                    newCart[existingIndex].cartQuantity += quantity;
                    setCart(newCart);
                } else {
                    setCart(prev => [...prev, { ...item, cartQuantity: quantity }]);
                }

                showSnackbar(`Added ${item.name} to cart`, 'success');
            };

            const removeFromCart = (itemId) => {
                setCart(prev => prev.filter(item => item.id !== itemId));
            };

            const clearCart = () => {
                setCart([]);
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900">
                        <div className="text-center">
                            <div className="mat-spinner w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"></div>
                            <p className="text-gray-600 dark:text-gray-400">Loading Firebase App...</p>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <>
                        <AuthComponent />
                        <MaterialSnackbar snackbar={snackbar} />
                    </>
                );
            }

            const tabs = [
                { id: 'shop', name: 'Shop', icon: 'storefront', count: cart.length },
                { id: 'scanner', name: 'Scanner', icon: 'qr_code_scanner' },
                { id: 'inventory', name: 'Inventory', icon: 'inventory_2', count: items.length },
                { id: 'users', name: 'Users', icon: 'people', count: users.length },
                { id: 'admin', name: 'Admin', icon: 'admin_panel_settings' },
                { id: 'history', name: 'History', icon: 'history', count: checkoutHistory.length }
            ];

            return (
                <div className="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
                    <AuthComponent />

                    {/* Connection Status */}
                    <div className={`px-4 py-2 text-center text-sm transition-colors duration-300 ${
                        connectionStatus === 'connected'
                            ? 'bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300'
                            : connectionStatus === 'error'
                            ? 'bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300'
                            : 'bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300'
                    }`}>
                        <div className="flex items-center justify-center space-x-2">
                            <span className="material-icons text-sm">
                                {connectionStatus === 'connected' ? 'cloud_done' :
                                 connectionStatus === 'error' ? 'cloud_off' : 'cloud_sync'}
                            </span>
                            <span>
                                {connectionStatus === 'connected' ? 'Firebase Connected - Real-time sync active' :
                                 connectionStatus === 'error' ? 'Firebase Connection Error' :
                                 'Connecting to Firebase...'}
                            </span>
                        </div>
                    </div>

                    {/* Low Stock Notifications */}
                    {notifications.length > 0 && (
                        <div className="bg-amber-50 dark:bg-amber-900/20 border-l-4 border-amber-400 p-4">
                            <div className="flex items-start">
                                <span className="material-icons text-amber-400 mr-3">warning</span>
                                <div>
                                    <p className="text-amber-700 dark:text-amber-300 font-medium">
                                        Low Stock Alert: {notifications.length} item(s) need attention
                                    </p>
                                    <div className="text-sm text-amber-600 dark:text-amber-400 mt-1">
                                        {notifications.slice(0, 3).map(notif => notif.message).join(' â€¢ ')}
                                        {notifications.length > 3 && ` â€¢ +${notifications.length - 3} more`}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Material Design Navigation */}
                    <nav className="bg-white dark:bg-gray-800 mat-elevation-2 transition-colors duration-300">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex justify-between items-center">
                                <div className="flex mat-tab-nav">
                                    {tabs.map(tab => (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`mat-tab flex items-center space-x-2 ${
                                                activeTab === tab.id
                                                    ? 'active text-blue-600 dark:text-blue-400'
                                                    : 'text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white'
                                            }`}
                                        >
                                            <span className="material-icons text-sm">{tab.icon}</span>
                                            <span className="font-medium">{tab.name}</span>
                                            {tab.count !== undefined && tab.count > 0 && (
                                                <div className={`px-2 py-1 text-xs rounded-full ${
                                                    tab.id === 'shop'
                                                        ? 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200'
                                                        : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300'
                                                }`}>
                                                    {tab.count}
                                                </div>
                                            )}
                                        </button>
                                    ))}
                                </div>

                                <div className="flex items-center space-x-4 px-4">
                                    <MaterialButton
                                        onClick={toggleDarkMode}
                                        variant="text"
                                        className="!p-2 !min-w-0"
                                    >
                                        <span className="material-icons">
                                            {isDarkMode ? 'light_mode' : 'dark_mode'}
                                        </span>
                                    </MaterialButton>

                                    <div className="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400">
                                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <span>Real-time</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto p-6">
                        {activeTab === 'shop' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                {/* Shop Items */}
                                <div className="lg:col-span-2 space-y-6">
                                    {/* Barcode Scanner */}
                                    <MaterialBarcodeScanner
                                        items={items}
                                        onItemScanned={(item, quantity) => {
                                            console.log(`Scanned: ${item.name} +${quantity}`);
                                        }}
                                    />

                                    {/* Items Grid */}
                                    <div>
                                        <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                            <span className="material-icons mr-2">storefront</span>
                                            Shop Items
                                        </h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                                            {items.slice(0, 24).map(item => (
                                                <MaterialCard key={item.id} elevation={1} className="!p-4 hover:mat-elevation-4">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <h3 className="font-medium text-sm text-gray-900 dark:text-white line-clamp-2">
                                                            {item.name}
                                                        </h3>
                                                        <div className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                            item.quantity <= (item.minThreshold || 5)
                                                                ? 'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300'
                                                                : 'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300'
                                                        }`}>
                                                            {item.quantity}
                                                        </div>
                                                    </div>
                                                    <div className="text-xs text-gray-600 dark:text-gray-400 mb-4">
                                                        <div className="flex items-center">
                                                            <span className="material-icons text-xs mr-1">category</span>
                                                            {item.category}
                                                        </div>
                                                        {item.price > 0 && (
                                                            <div className="flex items-center mt-1 text-green-600 dark:text-green-400 font-medium">
                                                                <span className="material-icons text-xs mr-1">attach_money</span>
                                                                ${item.price}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <MaterialButton
                                                        onClick={() => addToCart(item)}
                                                        disabled={item.quantity === 0}
                                                        variant="contained"
                                                        color="primary"
                                                        className="w-full !py-2"
                                                    >
                                                        {item.quantity === 0 ? (
                                                            <>
                                                                <span className="material-icons mr-2 text-sm">block</span>
                                                                Out of Stock
                                                            </>
                                                        ) : (
                                                            <>
                                                                <span className="material-icons mr-2 text-sm">add_shopping_cart</span>
                                                                Add to Cart
                                                            </>
                                                        )}
                                                    </MaterialButton>
                                                </MaterialCard>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Shopping Cart */}
                                <div>
                                    <MaterialShoppingCart
                                        cart={cart}
                                        addToCart={addToCart}
                                        removeFromCart={removeFromCart}
                                        clearCart={clearCart}
                                        users={users}
                                        onCheckout={() => {
                                            showSnackbar('Checkout completed successfully!', 'success');
                                        }}
                                    />
                                </div>
                            </div>
                        )}

                        {activeTab === 'scanner' && (
                            <div className="max-w-2xl mx-auto">
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">qr_code_scanner</span>
                                    Barcode Scanner
                                </h2>
                                <MaterialBarcodeScanner
                                    items={items}
                                    onItemScanned={(item, quantity) => {
                                        showSnackbar(`Scanned: ${item.name} +${quantity}`, 'success');
                                    }}
                                />
                            </div>
                        )}

                        {activeTab === 'inventory' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">inventory_2</span>
                                    Inventory Management
                                </h2>
                                <MaterialCard elevation={1}>
                                    <div className="mb-4 flex justify-between items-center">
                                        <p className="text-sm text-gray-600 dark:text-gray-400">
                                            Showing {Math.min(items.length, 50)} of {items.length} total items
                                        </p>
                                        <div className="flex items-center space-x-2">
                                            <span className="material-icons text-green-500">trending_up</span>
                                            <span className="text-sm text-gray-600 dark:text-gray-400">Real-time sync</span>
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">inventory</span>
                                                            Item
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">numbers</span>
                                                            Quantity
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">category</span>
                                                            Category
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">attach_money</span>
                                                            Price
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                {items.slice(0, 50).map(item => (
                                                    <tr key={item.id} className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                        <td className="px-6 py-4">
                                                            <div className="font-medium text-gray-900 dark:text-white">{item.name}</div>
                                                            <div className="text-sm text-gray-500 dark:text-gray-400">{item.asin}</div>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${
                                                                item.quantity <= (item.minThreshold || 5)
                                                                    ? 'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300'
                                                                    : 'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300'
                                                            }`}>
                                                                {item.quantity}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                                            {item.category}
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            {item.price > 0 ? (
                                                                <span className="text-green-600 dark:text-green-400 font-medium">
                                                                    ${item.price}
                                                                </span>
                                                            ) : (
                                                                <span className="text-gray-400">-</span>
                                                            )}
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <MaterialButton
                                                                onClick={() => addToCart(item)}
                                                                variant="text"
                                                                color="primary"
                                                                className="!p-2"
                                                            >
                                                                <span className="material-icons text-sm">add_shopping_cart</span>
                                                            </MaterialButton>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </MaterialCard>
                            </div>
                        )}

                        {activeTab === 'users' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">people</span>
                                    Users Management
                                </h2>
                                <MaterialCard elevation={1}>
                                    <div className="mb-4">
                                        <p className="text-sm text-gray-600 dark:text-gray-400">
                                            Showing {users.length} of 1,000+ total users (first 100 loaded for performance)
                                        </p>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">person</span>
                                                            Name
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">badge</span>
                                                            Cost Code
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">business</span>
                                                            Department
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                {users.map(user => (
                                                    <tr key={user.id} className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                        <td className="px-6 py-4">
                                                            <div className="font-medium text-gray-900 dark:text-white">
                                                                {user.name || `${user.firstName || ''} ${user.lastName || ''}`.trim()}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <code className="text-sm bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">
                                                                {user.costCode || user.cost_code}
                                                            </code>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                                            {(user.costCode || user.cost_code || '').split('-')[0] || 'Unknown'}
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300">
                                                                <span className="material-icons mr-1 text-xs">check_circle</span>
                                                                Active
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </MaterialCard>
                            </div>
                        )}

                        {activeTab === 'admin' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">admin_panel_settings</span>
                                    Administration
                                </h2>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* Add New Item */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-blue-600">add_box</span>
                                            Add New Item
                                        </h3>
                                        <div className="space-y-4">
                                            <MaterialInput label="Item Name" />
                                            <div className="grid grid-cols-2 gap-4">
                                                <MaterialInput label="Price" type="number" />
                                                <MaterialInput label="Quantity" type="number" />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <MaterialInput label="ASIN" />
                                                <div className="mat-input">
                                                    <select>
                                                        <option value="">Choose category...</option>
                                                        <option value="Electronics">Electronics</option>
                                                        <option value="Accessories">Accessories</option>
                                                        <option value="Cables">Cables</option>
                                                        <option value="Office">Office</option>
                                                    </select>
                                                    <label>Category</label>
                                                </div>
                                            </div>
                                            <MaterialButton variant="contained" color="primary" className="w-full">
                                                <span className="material-icons mr-2">add</span>
                                                Create Item
                                            </MaterialButton>
                                        </div>
                                    </MaterialCard>

                                    {/* Add New User */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-green-600">person_add</span>
                                            Add New User
                                        </h3>
                                        <div className="space-y-4">
                                            <div className="grid grid-cols-2 gap-4">
                                                <MaterialInput label="First Name" />
                                                <MaterialInput label="Last Name" />
                                            </div>
                                            <MaterialInput label="Cost Code" placeholder="e.g., IT-001-5770" />
                                            <MaterialInput label="Email (Optional)" type="email" />
                                            <MaterialInput label="Department" />
                                            <MaterialButton variant="contained" color="success" className="w-full">
                                                <span className="material-icons mr-2">person_add</span>
                                                Create User
                                            </MaterialButton>
                                        </div>
                                    </MaterialCard>

                                    {/* CSV Import/Export */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-purple-600">import_export</span>
                                            CSV Import/Export
                                        </h3>
                                        <div className="space-y-4">
                                            <div>
                                                <h4 className="font-medium mb-2">Import Data</h4>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <MaterialButton variant="outlined" color="primary" className="w-full">
                                                        <span className="material-icons mr-2">upload_file</span>
                                                        Import Items
                                                    </MaterialButton>
                                                    <MaterialButton variant="outlined" color="primary" className="w-full">
                                                        <span className="material-icons mr-2">upload_file</span>
                                                        Import Users
                                                    </MaterialButton>
                                                </div>
                                            </div>
                                            <div className="border-t dark:border-gray-600 pt-4">
                                                <h4 className="font-medium mb-2">Export Data</h4>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <MaterialButton variant="outlined" color="secondary" className="w-full">
                                                        <span className="material-icons mr-2">download</span>
                                                        Export Items
                                                    </MaterialButton>
                                                    <MaterialButton variant="outlined" color="secondary" className="w-full">
                                                        <span className="material-icons mr-2">download</span>
                                                        Export Users
                                                    </MaterialButton>
                                                </div>
                                            </div>
                                        </div>
                                    </MaterialCard>

                                    {/* Bulk Operations */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-orange-600">batch_prediction</span>
                                            Bulk Operations
                                        </h3>
                                        <div className="space-y-4">
                                            <div>
                                                <h4 className="font-medium mb-2">Inventory Management</h4>
                                                <div className="space-y-3">
                                                    <MaterialButton variant="outlined" color="primary" className="w-full">
                                                        <span className="material-icons mr-2">edit</span>
                                                        Bulk Edit Quantities
                                                    </MaterialButton>
                                                    <MaterialButton variant="outlined" color="primary" className="w-full">
                                                        <span className="material-icons mr-2">attach_money</span>
                                                        Update Prices
                                                    </MaterialButton>
                                                    <MaterialButton variant="outlined" color="error" className="w-full">
                                                        <span className="material-icons mr-2">restore</span>
                                                        Reset All to Zero
                                                    </MaterialButton>
                                                </div>
                                            </div>
                                        </div>
                                    </MaterialCard>

                                    {/* System Stats */}
                                    <MaterialCard elevation={2} className="lg:col-span-2">
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-indigo-600">analytics</span>
                                            System Statistics
                                        </h3>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div className="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                                <div className="text-2xl font-bold text-blue-600 dark:text-blue-400">{items.length}</div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">Total Items</div>
                                            </div>
                                            <div className="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                                <div className="text-2xl font-bold text-green-600 dark:text-green-400">{users.length}+</div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">Active Users</div>
                                            </div>
                                            <div className="text-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                                <div className="text-2xl font-bold text-purple-600 dark:text-purple-400">{checkoutHistory.length}</div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">Recent Checkouts</div>
                                            </div>
                                            <div className="text-center p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg">
                                                <div className="text-2xl font-bold text-amber-600 dark:text-amber-400">{notifications.length}</div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">Low Stock Alerts</div>
                                            </div>
                                        </div>
                                    </MaterialCard>
                                </div>
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">history</span>
                                    Checkout History
                                </h2>
                                <MaterialCard elevation={1}>
                                    <div className="mb-4">
                                        <p className="text-sm text-gray-600 dark:text-gray-400">
                                            Showing {checkoutHistory.length} most recent checkout records
                                        </p>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">inventory</span>
                                                            Item
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">person</span>
                                                            User
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">numbers</span>
                                                            Quantity
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">business</span>
                                                            Department
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">schedule</span>
                                                            Date
                                                        </div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                {checkoutHistory.map(record => (
                                                    <tr key={record.id} className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                        <td className="px-6 py-4 font-medium text-gray-900 dark:text-white">
                                                            {record.itemName}
                                                        </td>
                                                        <td className="px-6 py-4 text-gray-600 dark:text-gray-400">
                                                            {record.userName}
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300">
                                                                {record.quantity}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                                            {record.departmentId || record.costCode || '-'}
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                                            {record.dateEntered?.toDate?.()?.toLocaleDateString() ||
                                                             (typeof record.dateEntered === 'string' ? new Date(record.dateEntered).toLocaleDateString() : 'Unknown')}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </MaterialCard>
                            </div>
                        )}
                    </main>

                    {/* Material Design FAB */}
                    <button
                        onClick={() => setActiveTab('shop')}
                        className="mat-fab bg-blue-600 hover:bg-blue-700 text-white mat-elevation-8"
                    >
                        <span className="material-icons">add_shopping_cart</span>
                    </button>

                    {/* Snackbar */}
                    <MaterialSnackbar snackbar={snackbar} />
                </div>
            );
        };

        // Render the Material Design Firebase app
        ReactDOM.render(
            <ErrorBoundary>
                <MaterialFirebaseApp />
            </ErrorBoundary>,
            document.getElementById('root')
        );
    </script>
</body>
</html>