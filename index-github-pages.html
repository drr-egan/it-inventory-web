<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Inventory Management - Firebase Material</title>
    <!-- GitHub Pages Deploy: 2025-09-16 -->

    <!-- Material Design CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase Configuration (Embedded for GitHub Pages) -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCBOBb7mJPoI7cwubp12xnmjglLkuWYWYI",
            authDomain: "it-inventory-eaebc.firebaseapp.com",
            projectId: "it-inventory-eaebc",
            storageBucket: "it-inventory-eaebc.firebasestorage.app",
            messagingSenderId: "1081021280207",
            appId: "1:1081021280207:web:9619a96bff1692493aecba"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Initialize Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.addScope('email');
        googleProvider.addScope('profile');

        // Enable offline persistence
        db.enablePersistence({synchronizeTabs: true}).catch((err) => {
            console.warn('Firestore persistence not available:', err.code);
        });
    </script>

    <style>
        /* Material Design Custom Styles */
        * {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* Material Design Shadows */
        .mat-elevation-1 { box-shadow: 0px 2px 1px -1px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 1px 3px 0px rgba(0,0,0,0.12); }
        .mat-elevation-2 { box-shadow: 0px 3px 1px -2px rgba(0,0,0,0.2), 0px 2px 2px 0px rgba(0,0,0,0.14), 0px 1px 5px 0px rgba(0,0,0,0.12); }
        .mat-elevation-4 { box-shadow: 0px 2px 4px -1px rgba(0,0,0,0.2), 0px 4px 5px 0px rgba(0,0,0,0.14), 0px 1px 10px 0px rgba(0,0,0,0.12); }
        .mat-elevation-8 { box-shadow: 0px 5px 5px -3px rgba(0,0,0,0.2), 0px 8px 10px 1px rgba(0,0,0,0.14), 0px 3px 14px 2px rgba(0,0,0,0.12); }
        .mat-elevation-16 { box-shadow: 0px 8px 10px -5px rgba(0,0,0,0.2), 0px 16px 24px 2px rgba(0,0,0,0.14), 0px 6px 30px 5px rgba(0,0,0,0.12); }

        /* Material Design Ripple Effect */
        .mat-ripple {
            position: relative;
            overflow: hidden;
            transform: translate3d(0, 0, 0);
        }

        .mat-ripple:before {
            content: "";
            display: block;
            position: absolute;
            left: 50%;
            top: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: width 0.6s, height 0.6s, left 0.6s, top 0.6s;
            transform: translate(-50%, -50%);
        }

        .mat-ripple:active:before {
            width: 300px;
            height: 300px;
        }

        /* Material Design Input Fields */
        .mat-input {
            position: relative;
        }

        .mat-input input, .mat-input select, .mat-input textarea {
            width: 100%;
            padding: 16px 12px 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background: transparent;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .mat-input input:focus, .mat-input select:focus, .mat-input textarea:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .mat-input label {
            position: absolute;
            left: 12px;
            top: 16px;
            color: #757575;
            font-size: 16px;
            transition: all 0.2s ease;
            pointer-events: none;
            background: white;
            padding: 0 4px;
        }

        .mat-input input:focus + label,
        .mat-input input:not(:placeholder-shown) + label,
        .mat-input select:focus + label,
        .mat-input textarea:focus + label,
        .mat-input textarea:not(:placeholder-shown) + label {
            top: -6px;
            font-size: 12px;
            color: #1976d2;
        }

        /* Material Design FAB */
        .mat-fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .mat-fab:hover {
            transform: scale(1.1);
        }

        /* Material Design Tabs */
        .mat-tab-nav {
            border-bottom: 1px solid #e0e0e0;
        }

        .mat-tab {
            position: relative;
            padding: 16px 24px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }

        .mat-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #1976d2;
            transition: all 0.2s ease;
        }

        /* Material Design Cards */
        .mat-card {
            border-radius: 4px;
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .mat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2), 0px 6px 10px 0px rgba(0,0,0,0.14), 0px 1px 18px 0px rgba(0,0,0,0.12);
        }

        /* Material Design Snackbar */
        .mat-snackbar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: #323232;
            color: white;
            padding: 14px 24px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        /* Enhanced Dark Mode Material Design */
        .dark .mat-card {
            background: #1f2937;
            border: 1px solid #374151;
        }
        .dark .mat-input input,
        .dark .mat-input select,
        .dark .mat-input textarea {
            background: #374151;
            border-color: #4b5563;
            color: #f9fafb;
        }
        .dark .mat-input input:focus,
        .dark .mat-input select:focus,
        .dark .mat-input textarea:focus {
            background: #374151;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        .dark .mat-input label {
            background: #1f2937;
            color: #9ca3af;
        }
        .dark .mat-input input:focus + label,
        .dark .mat-input input:not(:placeholder-shown) + label,
        .dark .mat-input select:focus + label,
        .dark .mat-input textarea:focus + label,
        .dark .mat-input textarea:not(:placeholder-shown) + label {
            color: #3b82f6;
            background: #1f2937;
        }
        .dark .mat-tab-nav { border-bottom-color: #4b5563; }

        /* Dark mode enhancements */
        .dark body { background: #111827; }
        .dark .mat-snackbar {
            background: #374151;
            border: 1px solid #4b5563;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .mat-tab {
                padding: 12px 16px;
                font-size: 14px;
            }
            .mat-card {
                border-radius: 8px;
            }
            .mat-input input,
            .mat-input select,
            .mat-input textarea {
                padding: 14px 10px 6px 10px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Loading animations */
        .mat-spinner {
            animation: mat-spinner-rotate 2s linear infinite;
        }

        @keyframes mat-spinner-rotate {
            0% { transform: rotate(0); }
            100% { transform: rotate(360deg); }
        }

        /* Material Design progress bar */
        .mat-progress-bar {
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
        }

        .mat-progress-bar-fill {
            height: 100%;
            background: #1976d2;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Material Design Hook for Snackbar
        const useSnackbar = () => {
            const [snackbar, setSnackbar] = useState(null);

            const showSnackbar = (message, type = 'info', duration = 4000) => {
                setSnackbar({ message, type });
                setTimeout(() => setSnackbar(null), duration);
            };

            return { snackbar, showSnackbar };
        };

        // Material Design Hook for Theme
        const useTheme = () => {
            const [isDarkMode, setIsDarkMode] = useState(() => {
                const saved = localStorage.getItem('darkMode');
                return saved ? JSON.parse(saved) : false;
            });

            useEffect(() => {
                localStorage.setItem('darkMode', JSON.stringify(isDarkMode));
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [isDarkMode]);

            return { isDarkMode, toggleDarkMode: () => setIsDarkMode(!isDarkMode) };
        };

        // Material Design Input Component
        const MaterialInput = ({ label, type = 'text', value, onChange, placeholder = ' ', ...props }) => {
            return (
                <div className="mat-input">
                    <input
                        type={type}
                        value={value}
                        onChange={onChange}
                        placeholder={placeholder}
                        {...props}
                    />
                    <label>{label}</label>
                </div>
            );
        };

        // Material Design Button Component
        const MaterialButton = ({ children, variant = 'contained', color = 'primary', onClick, disabled, className = '', ...props }) => {
            const baseClasses = 'mat-ripple inline-flex items-center justify-center px-6 py-3 font-medium text-sm rounded transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2';

            const variantClasses = {
                contained: {
                    primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 mat-elevation-2',
                    secondary: 'bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500 mat-elevation-2',
                    success: 'bg-green-600 text-white hover:bg-green-700 focus:ring-green-500 mat-elevation-2',
                    error: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500 mat-elevation-2'
                },
                outlined: {
                    primary: 'border border-blue-600 text-blue-600 hover:bg-blue-50 focus:ring-blue-500',
                    secondary: 'border border-gray-600 text-gray-600 hover:bg-gray-50 focus:ring-gray-500',
                    success: 'border border-green-600 text-green-600 hover:bg-green-50 focus:ring-green-500',
                    error: 'border border-red-600 text-red-600 hover:bg-red-50 focus:ring-red-500'
                },
                text: {
                    primary: 'text-blue-600 hover:bg-blue-50 focus:ring-blue-500',
                    secondary: 'text-gray-600 hover:bg-gray-50 focus:ring-gray-500',
                    success: 'text-green-600 hover:bg-green-50 focus:ring-green-500',
                    error: 'text-red-600 hover:bg-red-50 focus:ring-red-500'
                }
            };

            const buttonClasses = `${baseClasses} ${variantClasses[variant][color]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`;

            return (
                <button
                    className={buttonClasses}
                    onClick={onClick}
                    disabled={disabled}
                    {...props}
                >
                    {children}
                </button>
            );
        };

        // Material Design Card Component
        const MaterialCard = ({ children, elevation = 1, className = '', ...props }) => {
            return (
                <div className={`mat-card mat-elevation-${elevation} p-6 ${className}`} {...props}>
                    {children}
                </div>
            );
        };

        // Error Boundary
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true };
            }

            componentDidCatch(error, errorInfo) {
                console.error('ðŸš¨ Application Error:', error);
                this.setState({ error });
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900">
                            <MaterialCard elevation={8} className="max-w-md">
                                <div className="flex items-center text-red-600 mb-4">
                                    <span className="material-icons mr-2">error</span>
                                    <h1 className="text-xl font-bold">Application Error</h1>
                                </div>
                                <p className="text-gray-700 dark:text-gray-300 mb-4">
                                    {this.state.error?.message || 'An unexpected error occurred'}
                                </p>
                                <MaterialButton
                                    onClick={() => window.location.reload()}
                                    variant="contained"
                                    color="primary"
                                    className="w-full"
                                >
                                    <span className="material-icons mr-2">refresh</span>
                                    Refresh Page
                                </MaterialButton>
                            </MaterialCard>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // Authentication Component with Material Design
        const AuthComponent = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [showEmailForm, setShowEmailForm] = useState(false);
            const { showSnackbar } = useSnackbar();

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setLoading(false);
                });
                return unsubscribe;
            }, []);

            const handleSignIn = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    showSnackbar('Welcome back!', 'success');
                } catch (error) {
                    setError(error.message);
                    showSnackbar(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleGoogleSignIn = async () => {
                setError('');
                setLoading(true);

                try {
                    const result = await auth.signInWithPopup(googleProvider);
                    const user = result.user;
                    showSnackbar(`Welcome ${user.displayName || user.email}!`, 'success');
                } catch (error) {
                    console.error('Google Sign-In Error:', error);
                    if (error.code === 'auth/popup-closed-by-user') {
                        showSnackbar('Sign-in was cancelled', 'warning');
                    } else if (error.code === 'auth/popup-blocked') {
                        showSnackbar('Pop-up blocked. Please allow pop-ups for this site.', 'error');
                    } else {
                        setError(error.message);
                        showSnackbar(`Google Sign-In failed: ${error.message}`, 'error');
                    }
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900">
                        <div className="text-center">
                            <div className="mat-spinner w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"></div>
                            <p className="text-gray-600 dark:text-gray-400">Loading Firebase...</p>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="min-h-screen relative bg-gradient-to-br from-blue-50 via-white to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-indigo-900">
                        {/* Email Sign-In Toggle - Small corner button */}
                        <div className="absolute top-4 right-4 z-10">
                            <MaterialButton
                                onClick={() => setShowEmailForm(!showEmailForm)}
                                variant="text"
                                className="!p-2 !min-w-0 !text-xs opacity-60 hover:opacity-100 transition-opacity"
                            >
                                <span className="material-icons text-sm">alternate_email</span>
                            </MaterialButton>
                        </div>

                        {/* Email Form Overlay */}
                        {showEmailForm && (
                            <div className="absolute inset-0 bg-black/50 backdrop-blur-sm z-20 flex items-center justify-center p-4">
                                <MaterialCard elevation={16} className="w-full max-w-sm relative">
                                    <MaterialButton
                                        onClick={() => setShowEmailForm(false)}
                                        variant="text"
                                        className="!absolute !top-2 !right-2 !p-2 !min-w-0"
                                    >
                                        <span className="material-icons text-sm">close</span>
                                    </MaterialButton>

                                    <h3 className="text-lg font-medium mb-4 dark:text-white">Email Sign-In</h3>

                                    <form onSubmit={handleSignIn} className="space-y-4">
                                        <MaterialInput
                                            label="Email Address"
                                            type="email"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            required
                                        />

                                        <MaterialInput
                                            label="Password"
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            required
                                        />

                                        {error && (
                                            <div className="flex items-center text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded">
                                                <span className="material-icons mr-2 text-sm">error</span>
                                                {error}
                                            </div>
                                        )}

                                        <MaterialButton
                                            type="submit"
                                            variant="contained"
                                            color="primary"
                                            disabled={loading}
                                            className="w-full"
                                        >
                                            {loading ? (
                                                <>
                                                    <div className="mat-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                                    Signing in...
                                                </>
                                            ) : (
                                                <>
                                                    <span className="material-icons mr-2">login</span>
                                                    Sign In
                                                </>
                                            )}
                                        </MaterialButton>
                                    </form>
                                </MaterialCard>
                            </div>
                        )}

                        {/* Main Sign-In Interface - Google Only */}
                        <div className="flex items-center justify-center min-h-screen p-4">
                            <div className="text-center max-w-md">
                                {/* Logo and Branding */}
                                <div className="mb-12">
                                    <div className="inline-flex items-center justify-center w-20 h-20 bg-white dark:bg-gray-800 rounded-3xl shadow-lg mb-6">
                                        <span className="material-icons text-4xl text-blue-600 dark:text-blue-400">inventory</span>
                                    </div>
                                    <h1 className="text-4xl font-bold text-gray-900 dark:text-white mb-2">
                                        IT Inventory
                                    </h1>
                                    <p className="text-gray-600 dark:text-gray-300 text-lg">
                                        Enterprise Inventory Management
                                    </p>
                                    <p className="text-gray-500 dark:text-gray-400 text-sm mt-2">
                                        Real-time tracking â€¢ Material Design â€¢ Firebase powered
                                    </p>
                                </div>

                                {/* Primary Google Sign-In */}
                                <div className="space-y-4">
                                    <MaterialButton
                                        onClick={handleGoogleSignIn}
                                        variant="contained"
                                        disabled={loading}
                                        className="w-full !bg-white hover:!bg-gray-50 !text-gray-700 !border !border-gray-300 shadow-lg hover:shadow-xl transition-all duration-200 !py-4 !text-lg"
                                    >
                                        {loading ? (
                                            <>
                                                <div className="mat-spinner w-5 h-5 border-2 border-gray-600 border-t-transparent rounded-full mr-3"></div>
                                                Signing in...
                                            </>
                                        ) : (
                                            <>
                                                <svg className="w-6 h-6 mr-3" viewBox="0 0 24 24">
                                                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                                </svg>
                                                Continue with Google
                                            </>
                                        )}
                                    </MaterialButton>

                                    <p className="text-xs text-gray-500 dark:text-gray-400 mt-6">
                                        Secure authentication powered by Google<br/>
                                        Your data is protected and never shared
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <header className="bg-blue-600 dark:bg-blue-800 text-white mat-elevation-4">
                    <div className="max-w-7xl mx-auto px-4">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center space-x-4">
                                <span className="material-icons text-2xl">inventory</span>
                                <div>
                                    <h1 className="font-semibold">IT Inventory System</h1>
                                    <p className="text-xs text-blue-100">Firebase powered</p>
                                </div>
                            </div>

                            <div className="flex items-center space-x-4">
                                <div className="flex items-center space-x-2 text-sm">
                                    <span className="material-icons text-sm">account_circle</span>
                                    <span>{user.email}</span>
                                    <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                </div>

                                <MaterialButton
                                    onClick={() => auth.signOut()}
                                    variant="text"
                                    className="text-white hover:bg-blue-700 dark:hover:bg-blue-900"
                                >
                                    <span className="material-icons mr-1">logout</span>
                                    Sign Out
                                </MaterialButton>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // Shopping Cart Component with Material Design
        const MaterialShoppingCart = ({ cart, addToCart, removeFromCart, clearCart, users, onCheckout }) => {
            const [isCheckingOut, setIsCheckingOut] = useState(false);
            const [checkoutMethod, setCheckoutMethod] = useState('user');
            const [selectedUser, setSelectedUser] = useState('');
            const [jobNumber, setJobNumber] = useState('');
            const [notes, setNotes] = useState('');
            const { showSnackbar } = useSnackbar();

            const cartTotal = cart.reduce((sum, item) => sum + (item.price || 0) * item.cartQuantity, 0);

            const handleCheckout = async () => {
                if (cart.length === 0) return;

                if (checkoutMethod === 'user' && !selectedUser) {
                    showSnackbar('Please select a user for checkout', 'error');
                    return;
                }

                if (checkoutMethod === 'job' && !jobNumber.trim()) {
                    showSnackbar('Please enter a job number', 'error');
                    return;
                }

                setIsCheckingOut(true);

                try {
                    const user = users.find(u => u.id === selectedUser);

                    for (const cartItem of cart) {
                        // Update inventory
                        const itemRef = db.collection('items').doc(cartItem.id);
                        await db.runTransaction(async (transaction) => {
                            const doc = await transaction.get(itemRef);
                            const currentQty = doc.data().quantity || 0;
                            const newQty = Math.max(0, currentQty - cartItem.cartQuantity);

                            transaction.update(itemRef, {
                                quantity: newQty,
                                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                            });

                            // Create checkout record
                            const checkoutRef = db.collection('checkoutHistory').doc();
                            transaction.set(checkoutRef, {
                                itemId: cartItem.id,
                                itemName: cartItem.name,
                                userId: checkoutMethod === 'user' ? selectedUser : '',
                                userName: checkoutMethod === 'user' ? (user?.name || `${user?.firstName} ${user?.lastName}`) : 'Job Checkout',
                                quantity: cartItem.cartQuantity,
                                departmentId: checkoutMethod === 'user' ? (user?.costCode || user?.cost_code) : jobNumber,
                                jobNumber: checkoutMethod === 'job' ? jobNumber : '',
                                notes: notes,
                                status: 'active',
                                dateEntered: firebase.firestore.FieldValue.serverTimestamp(),
                                createdBy: auth.currentUser?.email || 'unknown'
                            });
                        });
                    }

                    // Clear cart and form
                    clearCart();
                    setSelectedUser('');
                    setJobNumber('');
                    setNotes('');
                    showSnackbar(`Checkout completed! ${cart.length} items processed.`, 'success');

                    if (onCheckout) onCheckout();

                } catch (error) {
                    console.error('Checkout error:', error);
                    showSnackbar(`Checkout failed: ${error.message}`, 'error');
                } finally {
                    setIsCheckingOut(false);
                }
            };

            return (
                <MaterialCard elevation={2} className="sticky top-6">
                    <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center">
                            <span className="material-icons text-xl mr-2 text-blue-600">shopping_cart</span>
                            <h3 className="text-lg font-medium dark:text-white">Shopping Cart</h3>
                        </div>
                        <div className="flex items-center space-x-2">
                            {cart.length > 0 && (
                                <div className="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full text-sm font-medium">
                                    {cart.length} items
                                </div>
                            )}
                            {cartTotal > 0 && (
                                <div className="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-3 py-1 rounded-full text-sm font-medium">
                                    ${cartTotal.toFixed(2)}
                                </div>
                            )}
                        </div>
                    </div>

                    {cart.length === 0 ? (
                        <div className="text-center py-12 text-gray-500 dark:text-gray-400">
                            <span className="material-icons text-6xl mb-4 opacity-50">shopping_cart</span>
                            <p className="font-medium">Your cart is empty</p>
                            <p className="text-sm">Add items to get started</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            <div className="space-y-3 max-h-60 overflow-y-auto">
                                {cart.map(item => (
                                    <div key={item.id} className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div className="flex-1 min-w-0">
                                            <div className="font-medium text-gray-900 dark:text-white truncate">{item.name}</div>
                                            <div className="text-sm text-gray-600 dark:text-gray-400">
                                                Qty: {item.cartQuantity}
                                                {item.price > 0 && (
                                                    <span className="ml-2 text-green-600 dark:text-green-400 font-medium">
                                                        ${(item.price * item.cartQuantity).toFixed(2)}
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                        <div className="flex items-center space-x-2 ml-3">
                                            <MaterialButton
                                                onClick={() => addToCart(item, 1)}
                                                variant="outlined"
                                                color="primary"
                                                className="!p-2 !min-w-0 !w-8 !h-8"
                                            >
                                                <span className="material-icons text-sm">add</span>
                                            </MaterialButton>
                                            <MaterialButton
                                                onClick={() => removeFromCart(item.id)}
                                                variant="outlined"
                                                color="error"
                                                className="!p-2 !min-w-0 !w-8 !h-8"
                                            >
                                                <span className="material-icons text-sm">remove</span>
                                            </MaterialButton>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="border-t dark:border-gray-600 pt-4 space-y-4">
                                {/* Checkout Method */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                                        Checkout Method
                                    </label>
                                    <div className="flex space-x-4">
                                        <label className="flex items-center cursor-pointer">
                                            <input
                                                type="radio"
                                                value="user"
                                                checked={checkoutMethod === 'user'}
                                                onChange={(e) => setCheckoutMethod(e.target.value)}
                                                className="mr-2 text-blue-600"
                                            />
                                            <span className="material-icons mr-1 text-sm">person</span>
                                            <span className="text-sm">User Checkout</span>
                                        </label>
                                        <label className="flex items-center cursor-pointer">
                                            <input
                                                type="radio"
                                                value="job"
                                                checked={checkoutMethod === 'job'}
                                                onChange={(e) => setCheckoutMethod(e.target.value)}
                                                className="mr-2 text-blue-600"
                                            />
                                            <span className="material-icons mr-1 text-sm">work</span>
                                            <span className="text-sm">Job Checkout</span>
                                        </label>
                                    </div>
                                </div>

                                {/* User Selection */}
                                {checkoutMethod === 'user' && (
                                    <div className="mat-input">
                                        <select
                                            value={selectedUser}
                                            onChange={(e) => setSelectedUser(e.target.value)}
                                            required
                                        >
                                            <option value="">Choose a user...</option>
                                            {users.slice(0, 50).map(user => (
                                                <option key={user.id} value={user.id}>
                                                    {user.name || `${user.firstName} ${user.lastName}`} - {user.costCode || user.cost_code}
                                                </option>
                                            ))}
                                        </select>
                                        <label>Select User</label>
                                    </div>
                                )}

                                {/* Job Number */}
                                {checkoutMethod === 'job' && (
                                    <MaterialInput
                                        label="Job Number"
                                        value={jobNumber}
                                        onChange={(e) => setJobNumber(e.target.value)}
                                        required
                                    />
                                )}

                                {/* Notes */}
                                <div className="mat-input">
                                    <textarea
                                        value={notes}
                                        onChange={(e) => setNotes(e.target.value)}
                                        rows={2}
                                        placeholder=" "
                                    />
                                    <label>Notes (Optional)</label>
                                </div>

                                {/* Checkout Buttons */}
                                <div className="flex space-x-3">
                                    <MaterialButton
                                        onClick={handleCheckout}
                                        disabled={isCheckingOut}
                                        variant="contained"
                                        color="success"
                                        className="flex-1"
                                    >
                                        {isCheckingOut ? (
                                            <>
                                                <div className="mat-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                                Processing...
                                            </>
                                        ) : (
                                            <>
                                                <span className="material-icons mr-2">check_circle</span>
                                                Checkout
                                            </>
                                        )}
                                    </MaterialButton>
                                    <MaterialButton
                                        onClick={clearCart}
                                        variant="outlined"
                                        color="secondary"
                                        className="px-4"
                                    >
                                        <span className="material-icons">clear</span>
                                    </MaterialButton>
                                </div>
                            </div>
                        </div>
                    )}
                </MaterialCard>
            );
        };

        // Barcode Scanner Component with Material Design
        const MaterialBarcodeScanner = ({ items, onItemScanned }) => {
            const [scanInput, setScanInput] = useState('');
            const [recentScans, setRecentScans] = useState([]);
            const [feedback, setFeedback] = useState('');
            const [isScanning, setIsScanning] = useState(false);
            const [cameraMode, setCameraMode] = useState(false);
            const [cameraStream, setCameraStream] = useState(null);
            const { showSnackbar } = useSnackbar();
            const inputRef = useRef(null);
            const videoRef = useRef(null);
            const canvasRef = useRef(null);

            const handleItemScanned = async (itemIdentifier, quantity = 1) => {
                setIsScanning(true);

                try {
                    // Enhanced search: exact match first, then partial matches
                    let item = items.find(i =>
                        i.asin === itemIdentifier ||
                        i.id === itemIdentifier
                    );

                    // If no exact match, try partial name search
                    if (!item) {
                        const searchLower = itemIdentifier.toLowerCase().trim();
                        item = items.find(i =>
                            i.name.toLowerCase() === searchLower ||
                            i.name.toLowerCase().includes(searchLower) ||
                            (i.category && i.category.toLowerCase().includes(searchLower))
                        );
                    }

                    if (!item) {
                        showSnackbar(`Item not found: ${itemIdentifier}`, 'error');
                        setIsScanning(false);
                        return;
                    }

                    // Update inventory in Firebase
                    await db.collection('items').doc(item.id).update({
                        quantity: firebase.firestore.FieldValue.increment(quantity),
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Add to recent scans
                    const scanRecord = {
                        id: Date.now(),
                        item: item,
                        quantity: quantity,
                        timestamp: new Date()
                    };

                    setRecentScans(prev => [scanRecord, ...prev.slice(0, 4)]);
                    showSnackbar(`${item.name} +${quantity}`, 'success');

                    if (onItemScanned) {
                        onItemScanned(item, quantity);
                    }

                    setScanInput('');

                } catch (error) {
                    showSnackbar(`Scan error: ${error.message}`, 'error');
                } finally {
                    setIsScanning(false);
                    if (inputRef.current) {
                        setTimeout(() => inputRef.current.focus(), 100);
                    }
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && scanInput.trim() && !isScanning) {
                    e.preventDefault();
                    handleItemScanned(scanInput.trim());
                }
            };

            const handleScanClick = () => {
                if (scanInput.trim()) {
                    handleItemScanned(scanInput.trim());
                }
            };

            const startVoiceSearch = () => {
                if (!('webkitSpeechRecognition' in window)) {
                    showSnackbar('Voice recognition not supported', 'error');
                    return;
                }

                const recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onstart = () => {
                    setFeedback('ðŸŽ¤ Listening...');
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    setScanInput(transcript);
                    handleItemScanned(transcript);
                };

                recognition.onerror = () => {
                    showSnackbar('Voice recognition failed', 'error');
                    setFeedback('');
                };

                recognition.start();
            };

            // Check camera permissions and capabilities
            const checkCameraSupport = async () => {
                try {
                    // Check if getUserMedia is supported
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        return { supported: false, message: 'Camera API not supported' };
                    }

                    // Check permissions
                    if (navigator.permissions && navigator.permissions.query) {
                        try {
                            const permission = await navigator.permissions.query({ name: 'camera' });
                            console.log('Camera permission status:', permission.state);
                            if (permission.state === 'denied') {
                                return { supported: false, message: 'Camera permission denied' };
                            }
                        } catch (permError) {
                            console.warn('Permission query failed:', permError);
                        }
                    }

                    // Check available devices
                    if (navigator.mediaDevices.enumerateDevices) {
                        try {
                            const devices = await navigator.mediaDevices.enumerateDevices();
                            const videoDevices = devices.filter(device => device.kind === 'videoinput');
                            console.log('Available video devices:', videoDevices.length);
                            if (videoDevices.length === 0) {
                                return { supported: false, message: 'No cameras found' };
                            }
                        } catch (enumError) {
                            console.warn('Device enumeration failed:', enumError);
                        }
                    }

                    return { supported: true, message: 'Camera supported' };
                } catch (error) {
                    return { supported: false, message: error.message };
                }
            };

            // Camera barcode scanning functions
            const startCamera = async () => {
                try {
                    setIsScanning(true);
                    showSnackbar('Checking camera support...', 'info');

                    // Check camera support first
                    const supportCheck = await checkCameraSupport();
                    if (!supportCheck.supported) {
                        throw new Error(supportCheck.message);
                    }

                    showSnackbar('Requesting camera access...', 'info');

                    // iOS-optimized constraints
                    const constraints = {
                        video: {
                            facingMode: { ideal: 'environment' },
                            width: { min: 320, ideal: 640, max: 1920 },
                            height: { min: 240, ideal: 480, max: 1080 },
                            frameRate: { ideal: 30, max: 30 }
                        },
                        audio: false
                    };

                    let stream;
                    try {
                        // Try with environment camera first
                        stream = await navigator.mediaDevices.getUserMedia(constraints);
                    } catch (envError) {
                        console.warn('Environment camera failed, trying any camera:', envError);
                        // Fallback to any available camera
                        try {
                            stream = await navigator.mediaDevices.getUserMedia({
                                video: {
                                    width: { min: 320, ideal: 640 },
                                    height: { min: 240, ideal: 480 }
                                },
                                audio: false
                            });
                        } catch (anyError) {
                            throw new Error(`Camera access denied: ${anyError.message}`);
                        }
                    }

                    setCameraStream(stream);
                    setCameraMode(true);

                    if (videoRef.current) {
                        const video = videoRef.current;

                        // iOS-specific video setup
                        video.setAttribute('playsinline', 'true');
                        video.setAttribute('webkit-playsinline', 'true');
                        video.muted = true;
                        video.autoplay = true;

                        video.srcObject = stream;

                        // Wait for video to be ready
                        video.addEventListener('loadedmetadata', () => {
                            console.log('Video metadata loaded:', video.videoWidth, 'x', video.videoHeight);
                            startBarcodeDetection();
                        });

                        video.addEventListener('canplay', () => {
                            console.log('Video can play');
                            video.play().catch(playError => {
                                console.error('Video play failed:', playError);
                                showSnackbar('Video playback failed', 'error');
                            });
                        });

                        // Force play for iOS
                        const playPromise = video.play();
                        if (playPromise !== undefined) {
                            playPromise.catch(error => {
                                console.error('Play promise failed:', error);
                                // Try again after a short delay
                                setTimeout(() => {
                                    video.play().catch(retryError => {
                                        console.error('Retry play failed:', retryError);
                                        showSnackbar('Unable to start video on this device', 'error');
                                    });
                                }, 100);
                            });
                        }
                    }

                    showSnackbar('Camera started - point at barcode', 'success');
                } catch (error) {
                    console.error('Camera start error:', error);
                    showSnackbar(`Camera failed: ${error.message}`, 'error');
                    setIsScanning(false);
                    setCameraMode(false);
                }
            };

            const stopCamera = () => {
                if (cameraStream) {
                    cameraStream.getTracks().forEach(track => track.stop());
                    setCameraStream(null);
                }
                setCameraMode(false);
                setIsScanning(false);
            };

            const startBarcodeDetection = async () => {
                if (!videoRef.current || !canvasRef.current) return;

                const video = videoRef.current;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');

                // Check for BarcodeDetector API support
                if ('BarcodeDetector' in window) {
                    const detector = new BarcodeDetector({ formats: ['code_128', 'code_39', 'ean_13', 'ean_8', 'upc_a', 'upc_e'] });

                    const detectBarcodes = async () => {
                        if (!cameraMode || !video.videoWidth || !video.videoHeight) return;

                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        ctx.drawImage(video, 0, 0);

                        try {
                            const barcodes = await detector.detect(canvas);
                            if (barcodes.length > 0) {
                                const barcode = barcodes[0];
                                showSnackbar(`Barcode detected: ${barcode.rawValue}`, 'info');
                                await handleItemScanned(barcode.rawValue);
                                stopCamera();
                                return;
                            }
                        } catch (error) {
                            console.warn('Barcode detection error:', error);
                        }

                        // Continue scanning
                        if (cameraMode) {
                            requestAnimationFrame(detectBarcodes);
                        }
                    };

                    // Start detection when video is ready
                    video.addEventListener('loadedmetadata', () => {
                        detectBarcodes();
                    });

                    if (video.readyState >= video.HAVE_METADATA) {
                        detectBarcodes();
                    }
                } else {
                    // Fallback: Manual capture for browsers without BarcodeDetector
                    showSnackbar('Automatic scanning not supported - use manual input', 'warning');
                }
            };

            // Cleanup effect
            useEffect(() => {
                return () => {
                    if (cameraStream) {
                        cameraStream.getTracks().forEach(track => track.stop());
                    }
                };
            }, [cameraStream]);

            return (
                <MaterialCard elevation={2}>
                    <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center">
                            <span className="material-icons text-xl mr-2 text-blue-600">qr_code_scanner</span>
                            <h3 className="text-lg font-medium dark:text-white">Barcode Scanner</h3>
                        </div>
                        <div className="flex items-center space-x-2">
                            <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span className="text-sm text-gray-600 dark:text-gray-400">Ready</span>
                        </div>
                    </div>

                    <div className="space-y-4">
                        <MaterialInput
                            ref={inputRef}
                            label="Scan barcode or type item name/ASIN"
                            value={scanInput}
                            onChange={(e) => setScanInput(e.target.value)}
                            onKeyDown={handleKeyPress}
                            disabled={isScanning}
                            autoFocus
                            placeholder="Enter item name, ASIN, or scan barcode..."
                        />

                        <div className="flex space-x-2">
                            <MaterialButton
                                onClick={cameraMode ? stopCamera : startCamera}
                                disabled={false}
                                variant={cameraMode ? "contained" : "outlined"}
                                color={cameraMode ? "error" : "primary"}
                                className="flex-1"
                            >
                                <span className="material-icons mr-2">
                                    {cameraMode ? 'videocam_off' : 'videocam'}
                                </span>
                                {cameraMode ? 'Stop Camera' : 'Start Camera'}
                            </MaterialButton>
                            <MaterialButton
                                onClick={startVoiceSearch}
                                disabled={isScanning || cameraMode}
                                variant="outlined"
                                color="primary"
                                className="flex-1"
                            >
                                <span className="material-icons mr-2">mic</span>
                                Voice
                            </MaterialButton>
                            <MaterialButton
                                onClick={handleScanClick}
                                disabled={isScanning || !scanInput.trim() || cameraMode}
                                variant="contained"
                                color="primary"
                                className="flex-1"
                            >
                                {isScanning && !cameraMode ? (
                                    <>
                                        <div className="mat-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                        Scanning...
                                    </>
                                ) : (
                                    <>
                                        <span className="material-icons mr-2">search</span>
                                        Manual
                                    </>
                                )}
                            </MaterialButton>
                        </div>

                        {/* Debug Info */}
                        <div className="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-xs">
                            <div className="font-medium text-blue-800 dark:text-blue-200 mb-2">Camera Debug Info:</div>
                            <div className="space-y-1 text-blue-700 dark:text-blue-300">
                                <div>HTTPS: {location.protocol === 'https:' ? 'âœ…' : 'âŒ'}</div>
                                <div>MediaDevices: {navigator.mediaDevices ? 'âœ…' : 'âŒ'}</div>
                                <div>getUserMedia: {navigator.mediaDevices?.getUserMedia ? 'âœ…' : 'âŒ'}</div>
                                <div>User Agent: {navigator.userAgent.includes('iPhone') ? 'iPhone' : navigator.userAgent.includes('iPad') ? 'iPad' : 'Other'}</div>
                                <div>BarcodeDetector: {'BarcodeDetector' in window ? 'âœ…' : 'âŒ'}</div>
                            </div>
                        </div>

                        {/* Camera View */}
                        {cameraMode && (
                            <div className="bg-black rounded-lg overflow-hidden relative">
                                <video
                                    ref={videoRef}
                                    autoPlay
                                    playsInline
                                    webkitPlaysinline="true"
                                    muted
                                    controls={false}
                                    className="w-full h-64 object-cover"
                                    style={{ backgroundColor: '#000' }}
                                />
                                <canvas
                                    ref={canvasRef}
                                    className="hidden"
                                />
                                <div className="absolute inset-0 border-2 border-red-500 border-dashed rounded-lg pointer-events-none">
                                    <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-48 h-24 border-2 border-red-500 rounded-lg bg-red-500/10">
                                        <div className="text-white text-center mt-8 text-sm font-medium">
                                            Position barcode here
                                        </div>
                                    </div>
                                </div>
                                <div className="absolute top-2 right-2 bg-black/50 text-white px-2 py-1 rounded text-xs">
                                    {isScanning ? (
                                        <div className="flex items-center">
                                            <div className="w-2 h-2 bg-red-500 rounded-full animate-pulse mr-2"></div>
                                            Scanning...
                                        </div>
                                    ) : (
                                        'Ready'
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Recent Scans */}
                        {recentScans.length > 0 && (
                            <div>
                                <h4 className="font-medium text-gray-900 dark:text-white mb-3 flex items-center">
                                    <span className="material-icons mr-2 text-sm">history</span>
                                    Recent Scans
                                </h4>
                                <div className="space-y-2 max-h-32 overflow-y-auto">
                                    {recentScans.map((scan, index) => (
                                        <div
                                            key={scan.id}
                                            className={`flex justify-between items-center p-3 rounded-lg transition-all ${
                                                index === 0
                                                    ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800'
                                                    : 'bg-gray-50 dark:bg-gray-700'
                                            }`}
                                        >
                                            <div className="flex-1 min-w-0">
                                                <div className="font-medium text-gray-900 dark:text-white truncate">
                                                    {scan.item.name}
                                                </div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">
                                                    {scan.timestamp.toLocaleTimeString()}
                                                </div>
                                            </div>
                                            <div className="flex items-center space-x-2 ml-3">
                                                <span className="text-green-600 dark:text-green-400 font-bold">
                                                    +{scan.quantity}
                                                </span>
                                                <MaterialButton
                                                    onClick={() => handleItemScanned(scan.item.name)}
                                                    variant="text"
                                                    color="primary"
                                                    className="!p-2 !min-w-0 !text-xs"
                                                >
                                                    <span className="material-icons text-sm">refresh</span>
                                                </MaterialButton>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </MaterialCard>
            );
        };

        // Snackbar Component
        const MaterialSnackbar = ({ snackbar }) => {
            if (!snackbar) return null;

            const iconMap = {
                success: 'check_circle',
                error: 'error',
                warning: 'warning',
                info: 'info'
            };

            return (
                <div className="mat-snackbar flex items-center">
                    <span className="material-icons mr-2 text-sm">
                        {iconMap[snackbar.type] || 'info'}
                    </span>
                    {snackbar.message}
                </div>
            );
        };

        // Main Firebase App with Material Design
        const MaterialFirebaseApp = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [items, setItems] = useState([]);
            const [users, setUsers] = useState([]);
            const [checkoutHistory, setCheckoutHistory] = useState([]);
            const [activeTab, setActiveTab] = useState('shop');
            const [cart, setCart] = useState([]);
            const [connectionStatus, setConnectionStatus] = useState('connecting');
            const [notifications, setNotifications] = useState([]);

            // Form states for Add New Item
            const [newItemForm, setNewItemForm] = useState({
                name: '',
                price: '',
                quantity: '',
                asin: '',
                category: ''
            });
            const [isCreatingItem, setIsCreatingItem] = useState(false);

            // Form states for Add New User
            const [newUserForm, setNewUserForm] = useState({
                firstName: '',
                lastName: '',
                costCode: '',
                email: '',
                department: ''
            });
            const [isCreatingUser, setIsCreatingUser] = useState(false);

            // CSV and bulk operation states
            const [csvOperations, setCsvOperations] = useState({
                importingItems: false,
                importingUsers: false,
                exportingItems: false,
                exportingUsers: false
            });

            const { isDarkMode, toggleDarkMode } = useTheme();
            const { snackbar, showSnackbar } = useSnackbar();

            // Initialize Firebase with existing data if empty
            const initializeDataIfEmpty = async () => {
                try {
                    // Check if collections are empty
                    const itemsSnapshot = await db.collection('items').limit(1).get();
                    const usersSnapshot = await db.collection('users').limit(1).get();

                    if (itemsSnapshot.empty || usersSnapshot.empty) {
                        showSnackbar('Initializing database with inventory data...', 'info');

                        // Load and populate items
                        if (itemsSnapshot.empty) {
                            const itemsResponse = await fetch('./data/items.json');
                            if (itemsResponse.ok) {
                                const itemsData = await itemsResponse.json();
                                const batch = db.batch();

                                itemsData.forEach(item => {
                                    const docRef = db.collection('items').doc(item.id);
                                    batch.set(docRef, {
                                        ...item,
                                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                                        createdBy: 'auto-migration'
                                    });
                                });

                                await batch.commit();
                                showSnackbar(`Loaded ${itemsData.length} items`, 'success');
                            }
                        }

                        // Load and populate users
                        if (usersSnapshot.empty) {
                            const usersResponse = await fetch('./data/users.json');
                            if (usersResponse.ok) {
                                const usersData = await usersResponse.json();

                                // Process in smaller batches due to Firestore 500 doc limit
                                const batchSize = 400;
                                for (let i = 0; i < usersData.length; i += batchSize) {
                                    const batch = db.batch();
                                    const usersBatch = usersData.slice(i, i + batchSize);

                                    usersBatch.forEach(user => {
                                        const docRef = db.collection('users').doc(user.id);
                                        batch.set(docRef, {
                                            ...user,
                                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                            createdBy: 'auto-migration',
                                            active: true
                                        });
                                    });

                                    await batch.commit();
                                    showSnackbar(`Loaded ${Math.min(i + batchSize, usersData.length)} / ${usersData.length} users`, 'info');
                                }

                                showSnackbar(`Loaded ${usersData.length} users`, 'success');
                            }
                        }

                        // Optionally load checkout history (limit to recent records due to size)
                        const historySnapshot = await db.collection('checkoutHistory').limit(1).get();
                        if (historySnapshot.empty) {
                            const historyResponse = await fetch('./data/checkoutHistory.json');
                            if (historyResponse.ok) {
                                const historyData = await historyResponse.json();

                                // Only load most recent 500 records to avoid quota issues
                                const recentHistory = historyData
                                    .sort((a, b) => new Date(b.dateEntered) - new Date(a.dateEntered))
                                    .slice(0, 500);

                                const batchSize = 400;
                                for (let i = 0; i < recentHistory.length; i += batchSize) {
                                    const batch = db.batch();
                                    const historyBatch = recentHistory.slice(i, i + batchSize);

                                    historyBatch.forEach(record => {
                                        const docRef = db.collection('checkoutHistory').doc(record.id);
                                        batch.set(docRef, {
                                            ...record,
                                            dateEntered: record.dateEntered ? new Date(record.dateEntered) : firebase.firestore.FieldValue.serverTimestamp(),
                                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                            createdBy: 'auto-migration'
                                        });
                                    });

                                    await batch.commit();
                                }

                                showSnackbar(`Loaded ${recentHistory.length} recent checkout records`, 'success');
                            }
                        }

                        showSnackbar('Database initialization complete!', 'success');
                    }
                } catch (error) {
                    console.error('Data initialization error:', error);
                    showSnackbar(`Data initialization failed: ${error.message}`, 'error');
                }
            };

            // Real-time data listeners
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    setUser(user);
                    setLoading(false);

                    if (user) {
                        try {
                            setConnectionStatus('connecting');

                            // Check if data needs to be initialized
                            await initializeDataIfEmpty();

                            // Set up real-time listeners
                            const itemsUnsubscribe = db.collection('items')
                                .onSnapshot((snapshot) => {
                                    const itemsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                    setItems(itemsData);
                                    checkLowStock(itemsData);
                                });

                            const usersUnsubscribe = db.collection('users')
                                .limit(100)
                                .onSnapshot((snapshot) => {
                                    const usersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                    setUsers(usersData);
                                });

                            const historyUnsubscribe = db.collection('checkoutHistory')
                                .orderBy('dateEntered', 'desc')
                                .limit(50)
                                .onSnapshot((snapshot) => {
                                    const historyData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                    setCheckoutHistory(historyData);
                                });

                            setConnectionStatus('connected');

                            return () => {
                                itemsUnsubscribe();
                                usersUnsubscribe();
                                historyUnsubscribe();
                            };

                        } catch (error) {
                            console.error('Firebase connection error:', error);
                            setConnectionStatus('error');
                            showSnackbar('Connection error: ' + error.message, 'error');
                        }
                    }
                });

                return unsubscribe;
            }, []);

            const checkLowStock = (itemList) => {
                const lowStockItems = itemList.filter(item =>
                    item.quantity <= (item.minThreshold || 5)
                );

                setNotifications(lowStockItems.map(item => ({
                    id: item.id,
                    type: 'warning',
                    message: `Low stock: ${item.name} (${item.quantity} remaining)`
                })));
            };

            const addToCart = (item, quantity = 1) => {
                const existingIndex = cart.findIndex(cartItem => cartItem.id === item.id);

                if (existingIndex >= 0) {
                    const newCart = [...cart];
                    newCart[existingIndex].cartQuantity += quantity;
                    setCart(newCart);
                } else {
                    setCart(prev => [...prev, { ...item, cartQuantity: quantity }]);
                }

                showSnackbar(`Added ${item.name} to cart`, 'success');
            };

            const removeFromCart = (itemId) => {
                setCart(prev => prev.filter(item => item.id !== itemId));
            };

            const clearCart = () => {
                setCart([]);
            };

            // Handle creating new item
            const handleCreateItem = async (e) => {
                e.preventDefault();
                if (!newItemForm.name.trim()) {
                    showSnackbar('Item name is required', 'error');
                    return;
                }

                setIsCreatingItem(true);
                try {
                    const itemData = {
                        name: newItemForm.name.trim(),
                        price: parseFloat(newItemForm.price) || 0,
                        quantity: parseInt(newItemForm.quantity) || 0,
                        asin: newItemForm.asin.trim(),
                        category: newItemForm.category.trim() || 'Uncategorized',
                        minThreshold: 5,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                        createdBy: auth.currentUser?.email || 'unknown'
                    };

                    await db.collection('items').add(itemData);

                    // Reset form
                    setNewItemForm({
                        name: '',
                        price: '',
                        quantity: '',
                        asin: '',
                        category: ''
                    });

                    showSnackbar(`Item "${itemData.name}" created successfully!`, 'success');
                } catch (error) {
                    console.error('Error creating item:', error);
                    showSnackbar(`Failed to create item: ${error.message}`, 'error');
                } finally {
                    setIsCreatingItem(false);
                }
            };

            // Handle creating new user
            const handleCreateUser = async (e) => {
                e.preventDefault();
                if (!newUserForm.firstName.trim() || !newUserForm.lastName.trim()) {
                    showSnackbar('First name and last name are required', 'error');
                    return;
                }

                setIsCreatingUser(true);
                try {
                    const userData = {
                        firstName: newUserForm.firstName.trim(),
                        lastName: newUserForm.lastName.trim(),
                        name: `${newUserForm.firstName.trim()} ${newUserForm.lastName.trim()}`,
                        costCode: newUserForm.costCode.trim() || `${Date.now()}-5770`,
                        email: newUserForm.email.trim(),
                        department: newUserForm.department.trim(),
                        status: 'active',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        createdBy: auth.currentUser?.email || 'unknown'
                    };

                    await db.collection('users').add(userData);

                    // Reset form
                    setNewUserForm({
                        firstName: '',
                        lastName: '',
                        costCode: '',
                        email: '',
                        department: ''
                    });

                    showSnackbar(`User "${userData.name}" created successfully!`, 'success');
                } catch (error) {
                    console.error('Error creating user:', error);
                    showSnackbar(`Failed to create user: ${error.message}`, 'error');
                } finally {
                    setIsCreatingUser(false);
                }
            };

            // CSV Export Functions
            const exportItemsToCSV = async () => {
                setCsvOperations(prev => ({ ...prev, exportingItems: true }));
                try {
                    const csvHeader = 'Item Name,Category,Quantity,Price,ASIN,Min Threshold\n';
                    const csvRows = items.map(item =>
                        `"${(item.name || '').replace(/"/g, '""')}","${(item.category || '').replace(/"/g, '""')}",${item.quantity || 0},${item.price || 0},"${(item.asin || '').replace(/"/g, '""')}",${item.minThreshold || 5}`
                    ).join('\n');

                    const csvContent = csvHeader + csvRows;
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `inventory-items-${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();

                    showSnackbar(`Exported ${items.length} items to CSV`, 'success');
                } catch (error) {
                    showSnackbar(`Export failed: ${error.message}`, 'error');
                } finally {
                    setCsvOperations(prev => ({ ...prev, exportingItems: false }));
                }
            };

            const exportUsersToCSV = async () => {
                setCsvOperations(prev => ({ ...prev, exportingUsers: true }));
                try {
                    const csvHeader = 'First Name,Last Name,Full Name,Cost Code,Email,Department,Status\n';
                    const csvRows = users.map(user =>
                        `"${(user.firstName || '').replace(/"/g, '""')}","${(user.lastName || '').replace(/"/g, '""')}","${(user.name || '').replace(/"/g, '""')}","${(user.costCode || user.cost_code || '').replace(/"/g, '""')}","${(user.email || '').replace(/"/g, '""')}","${(user.department || '').replace(/"/g, '""')}","${user.status || 'active'}"`
                    ).join('\n');

                    const csvContent = csvHeader + csvRows;
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `inventory-users-${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();

                    showSnackbar(`Exported ${users.length} users to CSV`, 'success');
                } catch (error) {
                    showSnackbar(`Export failed: ${error.message}`, 'error');
                } finally {
                    setCsvOperations(prev => ({ ...prev, exportingUsers: false }));
                }
            };

            // CSV Import Functions
            const handleItemsImport = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setCsvOperations(prev => ({ ...prev, importingItems: true }));
                const reader = new FileReader();

                reader.onload = async (e) => {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());

                        let successCount = 0;
                        let errorCount = 0;

                        for (let i = 1; i < lines.length; i++) {
                            if (!lines[i].trim()) continue;

                            try {
                                const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
                                const item = {};

                                headers.forEach((header, index) => {
                                    switch(header.toLowerCase()) {
                                        case 'item name':
                                        case 'name':
                                            item.name = values[index];
                                            break;
                                        case 'category':
                                            item.category = values[index] || 'Uncategorized';
                                            break;
                                        case 'quantity':
                                            item.quantity = parseInt(values[index]) || 0;
                                            break;
                                        case 'price':
                                            item.price = parseFloat(values[index]) || 0;
                                            break;
                                        case 'asin':
                                            item.asin = values[index];
                                            break;
                                        case 'min threshold':
                                            item.minThreshold = parseInt(values[index]) || 5;
                                            break;
                                    }
                                });

                                if (!item.name) {
                                    errorCount++;
                                    continue;
                                }

                                item.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                                item.lastUpdated = firebase.firestore.FieldValue.serverTimestamp();
                                item.createdBy = auth.currentUser?.email || 'csv-import';

                                await db.collection('items').add(item);
                                successCount++;
                            } catch (itemError) {
                                errorCount++;
                                console.error('Error importing item:', itemError);
                            }
                        }

                        showSnackbar(`Import completed: ${successCount} items added, ${errorCount} errors`, successCount > 0 ? 'success' : 'warning');
                    } catch (error) {
                        showSnackbar(`Import failed: ${error.message}`, 'error');
                    } finally {
                        setCsvOperations(prev => ({ ...prev, importingItems: false }));
                        event.target.value = ''; // Reset file input
                    }
                };

                reader.readAsText(file);
            };

            const handleUsersImport = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setCsvOperations(prev => ({ ...prev, importingUsers: true }));
                const reader = new FileReader();

                reader.onload = async (e) => {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());

                        let successCount = 0;
                        let errorCount = 0;

                        for (let i = 1; i < lines.length; i++) {
                            if (!lines[i].trim()) continue;

                            try {
                                const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
                                const user = {};

                                headers.forEach((header, index) => {
                                    switch(header.toLowerCase()) {
                                        case 'first name':
                                        case 'firstname':
                                            user.firstName = values[index];
                                            break;
                                        case 'last name':
                                        case 'lastname':
                                            user.lastName = values[index];
                                            break;
                                        case 'cost code':
                                        case 'costcode':
                                            user.costCode = values[index];
                                            break;
                                        case 'email':
                                            user.email = values[index];
                                            break;
                                        case 'department':
                                            user.department = values[index];
                                            break;
                                    }
                                });

                                if (!user.firstName || !user.lastName) {
                                    errorCount++;
                                    continue;
                                }

                                user.name = `${user.firstName} ${user.lastName}`;
                                user.status = 'active';
                                user.costCode = user.costCode || `${Date.now()}-${Math.floor(Math.random() * 1000)}-5770`;
                                user.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                                user.createdBy = auth.currentUser?.email || 'csv-import';

                                await db.collection('users').add(user);
                                successCount++;
                            } catch (userError) {
                                errorCount++;
                                console.error('Error importing user:', userError);
                            }
                        }

                        showSnackbar(`Import completed: ${successCount} users added, ${errorCount} errors`, successCount > 0 ? 'success' : 'warning');
                    } catch (error) {
                        showSnackbar(`Import failed: ${error.message}`, 'error');
                    } finally {
                        setCsvOperations(prev => ({ ...prev, importingUsers: false }));
                        event.target.value = ''; // Reset file input
                    }
                };

                reader.readAsText(file);
            };

            // Bulk Operations
            const handleResetAllQuantities = async () => {
                if (!confirm('Are you sure you want to reset ALL item quantities to zero? This cannot be undone.')) {
                    return;
                }

                try {
                    const batch = db.batch();
                    items.forEach(item => {
                        const itemRef = db.collection('items').doc(item.id);
                        batch.update(itemRef, {
                            quantity: 0,
                            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });

                    await batch.commit();
                    showSnackbar(`Reset quantities for ${items.length} items`, 'success');
                } catch (error) {
                    showSnackbar(`Bulk reset failed: ${error.message}`, 'error');
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900">
                        <div className="text-center">
                            <div className="mat-spinner w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"></div>
                            <p className="text-gray-600 dark:text-gray-400">Loading Firebase App...</p>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <>
                        <AuthComponent />
                        <MaterialSnackbar snackbar={snackbar} />
                    </>
                );
            }

            const tabs = [
                { id: 'shop', name: 'Shop', icon: 'storefront', count: cart.length },
                { id: 'scanner', name: 'Scanner', icon: 'qr_code_scanner' },
                { id: 'inventory', name: 'Inventory', icon: 'inventory_2', count: items.length },
                { id: 'users', name: 'Users', icon: 'people', count: users.length },
                { id: 'admin', name: 'Admin', icon: 'admin_panel_settings' },
                { id: 'shipment', name: 'Process Shipment', icon: 'local_shipping' },
                { id: 'history', name: 'History', icon: 'history', count: checkoutHistory.length }
            ];

            return (
                <div className="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
                    <AuthComponent />

                    {/* Connection Status */}
                    <div className={`px-4 py-2 text-center text-sm transition-colors duration-300 ${
                        connectionStatus === 'connected'
                            ? 'bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300'
                            : connectionStatus === 'error'
                            ? 'bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300'
                            : 'bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300'
                    }`}>
                        <div className="flex items-center justify-center space-x-2">
                            <span className="material-icons text-sm">
                                {connectionStatus === 'connected' ? 'cloud_done' :
                                 connectionStatus === 'error' ? 'cloud_off' : 'cloud_sync'}
                            </span>
                            <span>
                                {connectionStatus === 'connected' ? 'Firebase Connected - Real-time sync active' :
                                 connectionStatus === 'error' ? 'Firebase Connection Error' :
                                 'Connecting to Firebase...'}
                            </span>
                        </div>
                    </div>

                    {/* Low Stock Notifications */}
                    {notifications.length > 0 && (
                        <div className="bg-amber-50 dark:bg-amber-900/20 border-l-4 border-amber-400 p-4">
                            <div className="flex items-start">
                                <span className="material-icons text-amber-400 mr-3">warning</span>
                                <div>
                                    <p className="text-amber-700 dark:text-amber-300 font-medium">
                                        Low Stock Alert: {notifications.length} item(s) need attention
                                    </p>
                                    <div className="text-sm text-amber-600 dark:text-amber-400 mt-1">
                                        {notifications.slice(0, 3).map(notif => notif.message).join(' â€¢ ')}
                                        {notifications.length > 3 && ` â€¢ +${notifications.length - 3} more`}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Material Design Navigation */}
                    <nav className="bg-white dark:bg-gray-800 mat-elevation-2 transition-colors duration-300">
                        <div className="max-w-7xl mx-auto">
                            {/* Desktop Navigation */}
                            <div className="hidden lg:flex justify-between items-center">
                                <div className="flex mat-tab-nav">
                                    {tabs.map(tab => (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`mat-tab flex items-center space-x-2 ${
                                                activeTab === tab.id
                                                    ? 'active text-blue-600 dark:text-blue-400'
                                                    : 'text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white'
                                            }`}
                                        >
                                            <span className="material-icons text-sm">{tab.icon}</span>
                                            <span className="font-medium">{tab.name}</span>
                                            {tab.count !== undefined && tab.count > 0 && (
                                                <div className={`px-2 py-1 text-xs rounded-full ${
                                                    tab.id === 'shop'
                                                        ? 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200'
                                                        : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300'
                                                }`}>
                                                    {tab.count}
                                                </div>
                                            )}
                                        </button>
                                    ))}
                                </div>

                                <div className="flex items-center space-x-4 px-4">
                                    <MaterialButton
                                        onClick={toggleDarkMode}
                                        variant="text"
                                        className="!p-2 !min-w-0"
                                    >
                                        <span className="material-icons">
                                            {isDarkMode ? 'light_mode' : 'dark_mode'}
                                        </span>
                                    </MaterialButton>

                                    <div className="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400">
                                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <span>Real-time</span>
                                    </div>
                                </div>
                            </div>

                            {/* Mobile Navigation */}
                            <div className="lg:hidden">
                                {/* Mobile Header */}
                                <div className="flex justify-between items-center p-4">
                                    <h2 className="font-semibold text-gray-900 dark:text-white">
                                        {tabs.find(t => t.id === activeTab)?.name || 'IT Inventory'}
                                    </h2>
                                    <div className="flex items-center space-x-2">
                                        <MaterialButton
                                            onClick={toggleDarkMode}
                                            variant="text"
                                            className="!p-2 !min-w-0"
                                        >
                                            <span className="material-icons text-sm">
                                                {isDarkMode ? 'light_mode' : 'dark_mode'}
                                            </span>
                                        </MaterialButton>
                                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    </div>
                                </div>

                                {/* Mobile Tab Scrollable */}
                                <div className="overflow-x-auto">
                                    <div className="flex space-x-1 px-4 pb-2">
                                        {tabs.map(tab => (
                                            <button
                                                key={tab.id}
                                                onClick={() => setActiveTab(tab.id)}
                                                className={`flex-shrink-0 flex items-center space-x-1 px-3 py-2 rounded-full text-sm transition-all ${
                                                    activeTab === tab.id
                                                        ? 'bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400'
                                                        : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
                                                }`}
                                            >
                                                <span className="material-icons text-sm">{tab.icon}</span>
                                                <span className="font-medium whitespace-nowrap">{tab.name}</span>
                                                {tab.count !== undefined && tab.count > 0 && (
                                                    <div className={`px-2 py-1 text-xs rounded-full ${
                                                        tab.id === 'shop'
                                                            ? 'bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200'
                                                            : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'
                                                    }`}>
                                                        {tab.count}
                                                    </div>
                                                )}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto p-3 sm:p-6">
                        {activeTab === 'shop' && (
                            <div className="grid grid-cols-1 xl:grid-cols-3 gap-4 lg:gap-6">
                                {/* Shop Items */}
                                <div className="xl:col-span-2 space-y-4 lg:space-y-6 order-2 xl:order-1">
                                    {/* Barcode Scanner */}
                                    <MaterialBarcodeScanner
                                        items={items}
                                        onItemScanned={(item, quantity) => {
                                            console.log(`Scanned: ${item.name} +${quantity}`);
                                        }}
                                    />

                                    {/* Items Grid */}
                                    <div>
                                        <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                            <span className="material-icons mr-2">storefront</span>
                                            Shop Items
                                        </h2>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-3 lg:gap-4">
                                            {items.slice(0, 24).map(item => (
                                                <MaterialCard key={item.id} elevation={1} className="!p-3 lg:!p-4 hover:mat-elevation-4">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <h3 className="font-medium text-sm text-gray-900 dark:text-white line-clamp-2">
                                                            {item.name}
                                                        </h3>
                                                        <div className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                            item.quantity <= (item.minThreshold || 5)
                                                                ? 'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300'
                                                                : 'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300'
                                                        }`}>
                                                            {item.quantity}
                                                        </div>
                                                    </div>
                                                    <div className="text-xs text-gray-600 dark:text-gray-400 mb-4">
                                                        <div className="flex items-center">
                                                            <span className="material-icons text-xs mr-1">category</span>
                                                            {item.category}
                                                        </div>
                                                        {item.price > 0 && (
                                                            <div className="flex items-center mt-1 text-green-600 dark:text-green-400 font-medium">
                                                                <span className="material-icons text-xs mr-1">attach_money</span>
                                                                ${item.price}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <MaterialButton
                                                        onClick={() => addToCart(item)}
                                                        disabled={item.quantity === 0}
                                                        variant="contained"
                                                        color="primary"
                                                        className="w-full !py-2"
                                                    >
                                                        {item.quantity === 0 ? (
                                                            <>
                                                                <span className="material-icons mr-2 text-sm">block</span>
                                                                Out of Stock
                                                            </>
                                                        ) : (
                                                            <>
                                                                <span className="material-icons mr-2 text-sm">add_shopping_cart</span>
                                                                Add to Cart
                                                            </>
                                                        )}
                                                    </MaterialButton>
                                                </MaterialCard>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Shopping Cart - Mobile First, Desktop Sticky */}
                                <div className="order-1 xl:order-2">
                                    <div className="xl:sticky xl:top-6">
                                        <MaterialShoppingCart
                                            cart={cart}
                                            addToCart={addToCart}
                                            removeFromCart={removeFromCart}
                                            clearCart={clearCart}
                                            users={users}
                                            onCheckout={() => {
                                                showSnackbar('Checkout completed successfully!', 'success');
                                            }}
                                        />
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'scanner' && (
                            <div className="max-w-2xl mx-auto">
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">qr_code_scanner</span>
                                    Barcode Scanner
                                </h2>
                                <MaterialBarcodeScanner
                                    items={items}
                                    onItemScanned={(item, quantity) => {
                                        showSnackbar(`Scanned: ${item.name} +${quantity}`, 'success');
                                    }}
                                />
                            </div>
                        )}

                        {activeTab === 'inventory' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">inventory_2</span>
                                    Inventory Management
                                </h2>
                                <MaterialCard elevation={1}>
                                    <div className="mb-4 flex justify-between items-center">
                                        <p className="text-sm text-gray-600 dark:text-gray-400">
                                            Showing {Math.min(items.length, 50)} of {items.length} total items
                                        </p>
                                        <div className="flex items-center space-x-2">
                                            <span className="material-icons text-green-500">trending_up</span>
                                            <span className="text-sm text-gray-600 dark:text-gray-400">Real-time sync</span>
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">inventory</span>
                                                            Item
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">numbers</span>
                                                            Quantity
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">category</span>
                                                            Category
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">attach_money</span>
                                                            Price
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                {items.slice(0, 50).map(item => (
                                                    <tr key={item.id} className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                        <td className="px-6 py-4">
                                                            <div className="font-medium text-gray-900 dark:text-white">{item.name}</div>
                                                            <div className="text-sm text-gray-500 dark:text-gray-400">{item.asin}</div>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${
                                                                item.quantity <= (item.minThreshold || 5)
                                                                    ? 'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300'
                                                                    : 'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300'
                                                            }`}>
                                                                {item.quantity}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                                            {item.category}
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            {item.price > 0 ? (
                                                                <span className="text-green-600 dark:text-green-400 font-medium">
                                                                    ${item.price}
                                                                </span>
                                                            ) : (
                                                                <span className="text-gray-400">-</span>
                                                            )}
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <MaterialButton
                                                                onClick={() => addToCart(item)}
                                                                variant="text"
                                                                color="primary"
                                                                className="!p-2"
                                                            >
                                                                <span className="material-icons text-sm">add_shopping_cart</span>
                                                            </MaterialButton>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </MaterialCard>
                            </div>
                        )}

                        {activeTab === 'users' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">people</span>
                                    Users Management
                                </h2>
                                <MaterialCard elevation={1}>
                                    <div className="mb-4">
                                        <p className="text-sm text-gray-600 dark:text-gray-400">
                                            Showing {users.length} of 1,000+ total users (first 100 loaded for performance)
                                        </p>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">person</span>
                                                            Name
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">badge</span>
                                                            Cost Code
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">business</span>
                                                            Department
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                {users.map(user => (
                                                    <tr key={user.id} className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                        <td className="px-6 py-4">
                                                            <div className="font-medium text-gray-900 dark:text-white">
                                                                {user.name || `${user.firstName || ''} ${user.lastName || ''}`.trim()}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <code className="text-sm bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">
                                                                {user.costCode || user.cost_code}
                                                            </code>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                                            {(user.costCode || user.cost_code || '').split('-')[0] || 'Unknown'}
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300">
                                                                <span className="material-icons mr-1 text-xs">check_circle</span>
                                                                Active
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </MaterialCard>
                            </div>
                        )}

                        {activeTab === 'admin' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">admin_panel_settings</span>
                                    Administration
                                </h2>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6">
                                    {/* Add New Item */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-blue-600">add_box</span>
                                            Add New Item
                                        </h3>
                                        <form onSubmit={handleCreateItem} className="space-y-4">
                                            <MaterialInput
                                                label="Item Name"
                                                value={newItemForm.name}
                                                onChange={(e) => setNewItemForm(prev => ({ ...prev, name: e.target.value }))}
                                                required
                                            />
                                            <div className="grid grid-cols-2 gap-4">
                                                <MaterialInput
                                                    label="Price"
                                                    type="number"
                                                    step="0.01"
                                                    value={newItemForm.price}
                                                    onChange={(e) => setNewItemForm(prev => ({ ...prev, price: e.target.value }))}
                                                    placeholder="0.00"
                                                />
                                                <MaterialInput
                                                    label="Quantity"
                                                    type="number"
                                                    value={newItemForm.quantity}
                                                    onChange={(e) => setNewItemForm(prev => ({ ...prev, quantity: e.target.value }))}
                                                    placeholder="0"
                                                />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <MaterialInput
                                                    label="ASIN"
                                                    value={newItemForm.asin}
                                                    onChange={(e) => setNewItemForm(prev => ({ ...prev, asin: e.target.value }))}
                                                    placeholder="Optional product identifier"
                                                />
                                                <div className="mat-input">
                                                    <select
                                                        value={newItemForm.category}
                                                        onChange={(e) => setNewItemForm(prev => ({ ...prev, category: e.target.value }))}
                                                    >
                                                        <option value="">Choose category...</option>
                                                        <option value="Electronics">Electronics</option>
                                                        <option value="Accessories">Accessories</option>
                                                        <option value="Cables">Cables</option>
                                                        <option value="Office">Office</option>
                                                        <option value="Hardware">Hardware</option>
                                                        <option value="Software">Software</option>
                                                        <option value="Supplies">Supplies</option>
                                                    </select>
                                                    <label>Category</label>
                                                </div>
                                            </div>
                                            <MaterialButton
                                                type="submit"
                                                variant="contained"
                                                color="primary"
                                                className="w-full"
                                                disabled={isCreatingItem}
                                            >
                                                {isCreatingItem ? (
                                                    <>
                                                        <div className="mat-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                                        Creating...
                                                    </>
                                                ) : (
                                                    <>
                                                        <span className="material-icons mr-2">add</span>
                                                        Create Item
                                                    </>
                                                )}
                                            </MaterialButton>
                                        </form>
                                    </MaterialCard>

                                    {/* Add New User */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-green-600">person_add</span>
                                            Add New User
                                        </h3>
                                        <form onSubmit={handleCreateUser} className="space-y-4">
                                            <div className="grid grid-cols-2 gap-4">
                                                <MaterialInput
                                                    label="First Name"
                                                    value={newUserForm.firstName}
                                                    onChange={(e) => setNewUserForm(prev => ({ ...prev, firstName: e.target.value }))}
                                                    required
                                                />
                                                <MaterialInput
                                                    label="Last Name"
                                                    value={newUserForm.lastName}
                                                    onChange={(e) => setNewUserForm(prev => ({ ...prev, lastName: e.target.value }))}
                                                    required
                                                />
                                            </div>
                                            <MaterialInput
                                                label="Cost Code"
                                                value={newUserForm.costCode}
                                                onChange={(e) => setNewUserForm(prev => ({ ...prev, costCode: e.target.value }))}
                                                placeholder="e.g., 1-10-100-5770 (auto-generated if empty)"
                                            />
                                            <MaterialInput
                                                label="Email (Optional)"
                                                type="email"
                                                value={newUserForm.email}
                                                onChange={(e) => setNewUserForm(prev => ({ ...prev, email: e.target.value }))}
                                                placeholder="user@company.com"
                                            />
                                            <MaterialInput
                                                label="Department"
                                                value={newUserForm.department}
                                                onChange={(e) => setNewUserForm(prev => ({ ...prev, department: e.target.value }))}
                                                placeholder="e.g., IT, Finance, Operations"
                                            />
                                            <MaterialButton
                                                type="submit"
                                                variant="contained"
                                                color="success"
                                                className="w-full"
                                                disabled={isCreatingUser}
                                            >
                                                {isCreatingUser ? (
                                                    <>
                                                        <div className="mat-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                                                        Creating...
                                                    </>
                                                ) : (
                                                    <>
                                                        <span className="material-icons mr-2">person_add</span>
                                                        Create User
                                                    </>
                                                )}
                                            </MaterialButton>
                                        </form>
                                    </MaterialCard>

                                    {/* CSV Import/Export */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-purple-600">import_export</span>
                                            CSV Import/Export
                                        </h3>
                                        <div className="space-y-4">
                                            <div>
                                                <h4 className="font-medium mb-2">Import Data</h4>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div>
                                                        <input
                                                            type="file"
                                                            accept=".csv"
                                                            onChange={handleItemsImport}
                                                            className="hidden"
                                                            id="items-csv-import"
                                                        />
                                                        <MaterialButton
                                                            onClick={() => document.getElementById('items-csv-import').click()}
                                                            variant="outlined"
                                                            color="primary"
                                                            className="w-full"
                                                            disabled={csvOperations.importingItems}
                                                        >
                                                            {csvOperations.importingItems ? (
                                                                <>
                                                                    <div className="mat-spinner w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full mr-2"></div>
                                                                    Importing...
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <span className="material-icons mr-2">upload_file</span>
                                                                    Import Items
                                                                </>
                                                            )}
                                                        </MaterialButton>
                                                    </div>
                                                    <div>
                                                        <input
                                                            type="file"
                                                            accept=".csv"
                                                            onChange={handleUsersImport}
                                                            className="hidden"
                                                            id="users-csv-import"
                                                        />
                                                        <MaterialButton
                                                            onClick={() => document.getElementById('users-csv-import').click()}
                                                            variant="outlined"
                                                            color="primary"
                                                            className="w-full"
                                                            disabled={csvOperations.importingUsers}
                                                        >
                                                            {csvOperations.importingUsers ? (
                                                                <>
                                                                    <div className="mat-spinner w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full mr-2"></div>
                                                                    Importing...
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <span className="material-icons mr-2">upload_file</span>
                                                                    Import Users
                                                                </>
                                                            )}
                                                        </MaterialButton>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="border-t dark:border-gray-600 pt-4">
                                                <h4 className="font-medium mb-2">Export Data</h4>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <MaterialButton
                                                        onClick={exportItemsToCSV}
                                                        variant="outlined"
                                                        color="secondary"
                                                        className="w-full"
                                                        disabled={csvOperations.exportingItems}
                                                    >
                                                        {csvOperations.exportingItems ? (
                                                            <>
                                                                <div className="mat-spinner w-4 h-4 border-2 border-gray-600 border-t-transparent rounded-full mr-2"></div>
                                                                Exporting...
                                                            </>
                                                        ) : (
                                                            <>
                                                                <span className="material-icons mr-2">download</span>
                                                                Export Items ({items.length})
                                                            </>
                                                        )}
                                                    </MaterialButton>
                                                    <MaterialButton
                                                        onClick={exportUsersToCSV}
                                                        variant="outlined"
                                                        color="secondary"
                                                        className="w-full"
                                                        disabled={csvOperations.exportingUsers}
                                                    >
                                                        {csvOperations.exportingUsers ? (
                                                            <>
                                                                <div className="mat-spinner w-4 h-4 border-2 border-gray-600 border-t-transparent rounded-full mr-2"></div>
                                                                Exporting...
                                                            </>
                                                        ) : (
                                                            <>
                                                                <span className="material-icons mr-2">download</span>
                                                                Export Users ({users.length})
                                                            </>
                                                        )}
                                                    </MaterialButton>
                                                </div>
                                            </div>
                                            <div className="text-xs text-gray-600 dark:text-gray-400 mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                                <p className="font-medium mb-1">ðŸ“‹ CSV Format Tips:</p>
                                                <p><strong>Items:</strong> Item Name, Category, Quantity, Price, ASIN, Min Threshold</p>
                                                <p><strong>Users:</strong> First Name, Last Name, Cost Code, Email, Department</p>
                                            </div>
                                        </div>
                                    </MaterialCard>

                                    {/* Bulk Operations */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-orange-600">batch_prediction</span>
                                            Bulk Operations
                                        </h3>
                                        <div className="space-y-4">
                                            <div>
                                                <h4 className="font-medium mb-2">Inventory Management</h4>
                                                <div className="space-y-3">
                                                    <MaterialButton
                                                        onClick={exportItemsToCSV}
                                                        variant="outlined"
                                                        color="primary"
                                                        className="w-full"
                                                    >
                                                        <span className="material-icons mr-2">edit</span>
                                                        Bulk Edit via CSV Export/Import
                                                    </MaterialButton>
                                                    <MaterialButton
                                                        onClick={() => showSnackbar('Price bulk update: Export CSV, edit prices, then import back', 'info')}
                                                        variant="outlined"
                                                        color="primary"
                                                        className="w-full"
                                                    >
                                                        <span className="material-icons mr-2">attach_money</span>
                                                        Update Prices via CSV
                                                    </MaterialButton>
                                                    <MaterialButton
                                                        onClick={handleResetAllQuantities}
                                                        variant="outlined"
                                                        color="error"
                                                        className="w-full"
                                                    >
                                                        <span className="material-icons mr-2">restore</span>
                                                        Reset All Quantities to Zero
                                                    </MaterialButton>
                                                </div>
                                            </div>
                                            <div className="text-xs text-gray-600 dark:text-gray-400 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg">
                                                <p className="font-medium mb-1">âš ï¸ Bulk Operations:</p>
                                                <p><strong>Edit/Prices:</strong> Use CSV export â†’ edit â†’ import workflow</p>
                                                <p><strong>Reset:</strong> Sets ALL item quantities to zero (permanent!)</p>
                                            </div>
                                        </div>
                                    </MaterialCard>

                                    {/* System Stats */}
                                    <MaterialCard elevation={2} className="lg:col-span-2">
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-indigo-600">analytics</span>
                                            System Statistics
                                        </h3>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div className="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                                <div className="text-2xl font-bold text-blue-600 dark:text-blue-400">{items.length}</div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">Total Items</div>
                                            </div>
                                            <div className="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                                <div className="text-2xl font-bold text-green-600 dark:text-green-400">{users.length}+</div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">Active Users</div>
                                            </div>
                                            <div className="text-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                                <div className="text-2xl font-bold text-purple-600 dark:text-purple-400">{checkoutHistory.length}</div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">Recent Checkouts</div>
                                            </div>
                                            <div className="text-center p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg">
                                                <div className="text-2xl font-bold text-amber-600 dark:text-amber-400">{notifications.length}</div>
                                                <div className="text-sm text-gray-600 dark:text-gray-400">Low Stock Alerts</div>
                                            </div>
                                        </div>
                                    </MaterialCard>
                                </div>
                            </div>
                        )}

                        {activeTab === 'shipment' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">local_shipping</span>
                                    Process Shipment
                                </h2>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* PDF Upload */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-blue-600">upload_file</span>
                                            Upload Receipt PDF
                                        </h3>
                                        <div className="space-y-4">
                                            <div className="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 transition-colors">
                                                <span className="material-icons text-4xl text-gray-400 mb-2">picture_as_pdf</span>
                                                <p className="text-gray-600 dark:text-gray-400 mb-4">
                                                    Drop PDF receipt here or click to upload
                                                </p>
                                                <input
                                                    type="file"
                                                    accept=".pdf"
                                                    className="hidden"
                                                    id="pdf-upload"
                                                />
                                                <MaterialButton
                                                    onClick={() => document.getElementById('pdf-upload').click()}
                                                    variant="outlined"
                                                    color="primary"
                                                >
                                                    <span className="material-icons mr-2">file_upload</span>
                                                    Choose PDF File
                                                </MaterialButton>
                                            </div>
                                            <div className="text-sm text-gray-600 dark:text-gray-400">
                                                <p className="font-medium mb-2">Supported formats:</p>
                                                <ul className="list-disc list-inside space-y-1">
                                                    <li>PDF receipts from vendors</li>
                                                    <li>Purchase orders with itemized costs</li>
                                                    <li>Invoices with line items</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </MaterialCard>

                                    {/* Processing Options */}
                                    <MaterialCard elevation={2}>
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-green-600">settings</span>
                                            Processing Options
                                        </h3>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                    Cost Allocation Method
                                                </label>
                                                <div className="space-y-2">
                                                    <label className="flex items-center">
                                                        <input type="radio" name="allocation" value="auto" className="mr-2" defaultChecked />
                                                        <span className="text-sm">Automatic - Match against checkout history</span>
                                                    </label>
                                                    <label className="flex items-center">
                                                        <input type="radio" name="allocation" value="manual" className="mr-2" />
                                                        <span className="text-sm">Manual - Review and assign costs</span>
                                                    </label>
                                                </div>
                                            </div>

                                            <div className="mat-input">
                                                <input type="date" />
                                                <label>Receipt Date</label>
                                            </div>

                                            <div className="mat-input">
                                                <input type="text" placeholder="Optional vendor name" />
                                                <label>Vendor Name</label>
                                            </div>

                                            <div className="mat-input">
                                                <textarea rows={3} placeholder="Processing notes or special instructions"></textarea>
                                                <label>Notes</label>
                                            </div>

                                            <MaterialButton
                                                variant="contained"
                                                color="success"
                                                className="w-full"
                                                disabled={true}
                                            >
                                                <span className="material-icons mr-2">process</span>
                                                Process Receipt
                                            </MaterialButton>
                                        </div>
                                    </MaterialCard>

                                    {/* Recent Processing */}
                                    <MaterialCard elevation={1} className="lg:col-span-2">
                                        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                                            <span className="material-icons mr-2 text-purple-600">history</span>
                                            Recent Shipment Processing
                                        </h3>
                                        <div className="text-center py-8 text-gray-500 dark:text-gray-400">
                                            <span className="material-icons text-6xl mb-4 opacity-50">receipt_long</span>
                                            <p className="font-medium">No shipments processed yet</p>
                                            <p className="text-sm">Upload a PDF receipt to get started</p>
                                        </div>
                                    </MaterialCard>
                                </div>
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
                                    <span className="material-icons mr-2">history</span>
                                    Checkout History
                                </h2>
                                <MaterialCard elevation={1}>
                                    <div className="mb-4">
                                        <p className="text-sm text-gray-600 dark:text-gray-400">
                                            Showing {checkoutHistory.length} most recent checkout records
                                        </p>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50 dark:bg-gray-700">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">inventory</span>
                                                            Item
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">person</span>
                                                            User
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">numbers</span>
                                                            Quantity
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">business</span>
                                                            Department
                                                        </div>
                                                    </th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                                        <div className="flex items-center">
                                                            <span className="material-icons mr-1 text-sm">schedule</span>
                                                            Date
                                                        </div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                {checkoutHistory.map(record => (
                                                    <tr key={record.id} className="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                                        <td className="px-6 py-4 font-medium text-gray-900 dark:text-white">
                                                            {record.itemName}
                                                        </td>
                                                        <td className="px-6 py-4 text-gray-600 dark:text-gray-400">
                                                            {record.userName}
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300">
                                                                {record.quantity}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                                            {record.departmentId || record.costCode || '-'}
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-600 dark:text-gray-400">
                                                            {record.dateEntered?.toDate?.()?.toLocaleDateString() ||
                                                             (typeof record.dateEntered === 'string' ? new Date(record.dateEntered).toLocaleDateString() : 'Unknown')}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </MaterialCard>
                            </div>
                        )}
                    </main>

                    {/* Material Design FAB */}
                    <button
                        onClick={() => setActiveTab('shop')}
                        className="mat-fab bg-blue-600 hover:bg-blue-700 text-white mat-elevation-8"
                    >
                        <span className="material-icons">add_shopping_cart</span>
                    </button>

                    {/* Snackbar */}
                    <MaterialSnackbar snackbar={snackbar} />
                </div>
            );
        };

        // Render the Material Design Firebase app using React 18 API
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ErrorBoundary>
                <MaterialFirebaseApp />
            </ErrorBoundary>
        );
    </script>
</body>
</html>